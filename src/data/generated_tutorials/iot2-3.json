{
  "title": "3",
  "slug": "iot2-3",
  "description": "Module from iot2.pdf: 3",
  "tags": [
    "iot2",
    "Elite"
  ],
  "content": "# 3\n\n\nDesign Principles for \n\nWeb Connectivity \n\nLearning Objectives \n\nLO 3.1 \nExtend the understanding of web communication protocols used by connected IoT/ \nM2M devices \nLO 3.2 \nIllustrate the usage of messaging protocols between connected devices and the web \nLO 3.3 \nOutline the usages of communication gateway protocols, such as SOAP, REST, RESTful \nHTTP and WebSocket by connected devices and the web \n\nRecall from Previous Chapters \n\nSection 1.1 described the suggested conceptual frameworks, reference models and architectures. \nEquation 1.1 of Adrian McEwen and Hakim Cassimally conceptualises the IoT framework and \nis given as \u201cPhysical Object + Controller, Sensor and Actuators + Internet = Internet of Things\u201d. \nEquation 1.2 conceptualises the Oracle IoT architecture and is given as \u201cGather + Enrich + Stream \n+ Manage + Acquire + Organise and Analyse = Internet of Things with connectivity to data \ncentre, enterprise or cloud server.\u201d Equation 1.1 tells that the Internet is an important element \nfor IoT/M2M. Equation 2.2 tells that streaming of data is a must-required element. The Internet \nconnects to the web. Streaming of data is to or from the web. IoT/M2M physical objects/devices \ntherefore need web connectivity. \n\nSection 2.1 described the network layer as one of the six layers in the IoT reference model. \nThe ITU-T reference model has one layer for network capabilities. ETSI suggested one of the two \ndomains in high-level architecture as a network domain. The domain includes CoRE and access \n\nDesign Principles for Web Connectivity \n75 \n\n3.1 \nINTRODUCTION \n\nAn IoT/M2M device network gateway needs connectivity to web servers. A communication \ngateway enables web connectivity, while IoT/M2M specific protocols and methods \nenable web connectivity for a connected devices network.  A server enables IoT device \ndata accumulation (storage). Application (reporting, analysis and control), collaboration, \nservice and processes (involving peoples and business processes) use this data. \n\nFollowing are some key terms, which need to be understood for learning web \nconnectivity and communication between the connected devices network and the web \nfor IoT: \n\nApplication or App refers to a software for applications such as creating and sending an \nSMS, measuring and sending the measured data, receiving a message from a specific \nsender etc. \n\nApplication Programming Interface (API) refers to a software component, which receives \nmessages from one end; for example, from an application or client or input. An API may \nconsist of GUIs (button, check box, text box, dialog box). An API may get input to or from \na server or a user. It then initiates actions and may send the messages, for example, to \napplication software,  server or a client at the other end etc. \n\nFor example, consider an API for a parcel tracking application. The API displays \nthe fields for the user inputs required for tracking, accepts the user inputs, displays a \n\u2018wait message\u2019 to the user and sends the input parameters to an application at a server. \nThe application in turn displays the response from the application or server. \n\nAn API also refers to software components, which enable easier development of an \napplication. An API defines the functionalities for a programmer, which puts the building \nblocks together to develop an application. A building block consists of the operations, \ninputs, outputs and underlying types. \n\nWeb service refers to a servicing software which uses web protocols, web objects or \nWebSockets; for example, weather reports service, traffic density reports, streetlights \nmonitoring and controlling service. \n\nObject refers to a collection of resources; for example, collection of data and methods \n(or functions or procedures) to operate on that data. Take for instance, Time_Date object \nwith second, minutes, hour, day, month and year fields and update methods. An object \ninstance can be just one or more than one for an object. An example of an object instance is \nbirth_date. Multiple object instances, abc_birth_date, pqr_birth_date, xyz_birth_date and \nmany instances can be created from birth_date object  in JavaScript. An example of object \ninstance is weather report object for reporting the rains. \n\nnetworks, management and service capabilities. Gateway connects to the network using which \ndata streams to or from the web. An IoT/M2M gateway needs connectivity to the web that uses \nthe Internet. \n\n76 \nInternet of Things: Architecture and Design Principles \n\nObject model is defined as the usage of objects for values, messages, data or resource \ntransfer, and creation of one or more object-instances. \nClass :  Java uses concept of class , which creates one or more object instances. \n\nCommunication gateway is one that functions as communication protocol translator \n(convertor) for provisioning communication capabilities. For example, the gateway for \ncommunication between ZigBee and IP networks. \n\nClient refers to a software object which makes request (or an API associated with it makes \nrequest) for data, messages, resources or objects. A client can have one or more object \ninstances. A client may also have an API or many APIs for enabling the communication \nto the server. A client can be at a device or application on a network or Internet connected \nweb, enterprise server or cloud. \n\nServer is defined as a software which sends a response on a request. The server also sends \nmessages, alerts or notifications. The server  has access to resources, databases and objects. \nA server can be on a device or can be on a separate computer system, not necessarily on \nInternet connected web. \n\nWeb object is the one that retrieves a resource from the web object at other end using a web \nprotocol. \n\nBroker denotes an object, which arranges the communication between two ends; for \nexample, between the message publisher and subscriber or for example taking the request \nfrom a source and sending the response received back for that source after arranging the \nresponse from another object, such as a server. \n\nProxy refers to an application which receives a response from the server for usage of a \nclient or application and which also receives requests from the client for the responses \nretrieved or saved at proxy. \n\nCommunication protocol defines the rules and conventions for communication between \nnetworked devices and between systems. The protocol includes mechanisms for \ndevices or systems to identify and make connections with each other. The protocol \nalso includes formatting rules that specify how data is packaged into sent and received \nmessages, 1 and header, its field and their meanings. \n\nWeb protocol is a protocol that defines the rules and conventions for communication between \nthe web server and web clients. It is a protocol for web connectivity of web objects, clients, \nservers and intermediate servers or firewalls. It includes mechanisms for a web object to \nidentify and make connections with other objects. The protocol also includes web object \nformatting rules that specify how that object packs into it the sent and received messages. \n\nFirewall is one that protects the server from unauthentic resources. \n\nA header consists of a set of words. The words contain the information and parameters \nabout the processing at a communicating layer. The words are placed over a data stack \n\n1 http://compnetworking.about.com/ \n\nDesign Principles for Web Connectivity \n77 \n\nreceived from a previous layer and create a new data stack for transmission to next \nlower layer. Header words are placed at the sending layer lower in the hierarchy during \ntransmission and removed at the receiving layer higher in hierarchy after using the \ninformation contained in the header. \n\nA state refers to an aspect related to someone or something, or a form at a particular time \n(Collins English Language Dictionary). State, in reference to data interchange between \nweb objects, refers to an aspect related to data or resource or object received at a particular \ninstance at the server or client end. \n\nResource denotes something that can be read (used), written (created or changed) or \nexecuted (processed). A path specification is also a resource. The resource is atomic (not- \nfurther divisible) information, which is usable during computations. A resource may \nhave multiple instances or just a single instance. Single instance example is a contact list. \nExamples of multiple instances of a contact are name, surname, city, address and email ID. \n\nEach resource instance has a resource ID . A resource is accessible using a resource \nidentifier. A resource identifier can be a path specification, such as a Universal Resource \nLocator (URL) or Universal Resource Identifier (URI). \n\nA resource may have resource registry , which means it is usable after a resource instance \nis registered at the registry, and unusable when not-registered or when de-registered. \n\nA resource can be updated. A resource can be used when an application uses resource \ndiscovery . \n\nA resource may have a resource repository . Repository refers to subfolder, folder or \ndirectory, which contains the resources and their instances. A resource can have a resource \ndirectory, which directs to resource repository. \n\nResource structure or resource directory refers to a structure or collection of resources, \napplications, containers and groups, which may each have an attribute, access right, \nsubscription and discovery. \n\nPath denotes a navigation path between two ends when accessing a resource. Path \nspecification can be of URI or URL type. The structure of URI is hierarchical. Entity after \nthe sign \u2018/\u2019 is a child of the parent before the sign \u2018/\u2019. \n\nUniversal Resource Identifier is generally used for saved resources, such as contacts or \naddress book. Example of a URI is /Contacts/First_Character_R/ for a set of resource \ndirectory contacts having resource repository First_Character_R for contacts with first \ncharacter R and resources giving information about a contact. Another example is URI \nsensorNetwork_J/sensorID_N/temperature for a temperature value. The value is at a \nresource directory sensorNetwork_J for a sensor network, which stores sensor data for a \nsensor of id sensorID_N. \n\nUniversal Resource Locator is generally used for retrieving a resource(s) by a client. The \nsaved resources may be at a document or at a remote server accessed using Internet \nprotocols. An example of a URL is http://www.mhhe.com/ for a set of resource directories, \nresource repositories and resources on the McGraw Hill Higher Education server. \n\n78 \nInternet of Things: Architecture and Design Principles \n\nDatagram refers to a limited size data (2 16 byte). It is used for stateless connectionless \ntransfer from a web object. Stateless means each single datagram transfer is independent of \nprevious data interchanges and connectionless means there is no need of pre-establishing \nthe connection for resource exchanges between the web objects and no connection closing \nafter finishing the resource exchanges. \n\nRepresentational State Transfer (REST) is a software architecture referring to ways of \ndefining the identifiers for the resources, methods, access methods and data transfer \nduring interactions. REST is a software architecture which also specifies the practices, \nconstraints, characteristics and guidelines for creating scalable web services. Scalable \nmeans can be used as per the size. The architecture is used during the design of web \nsoftware components, clients and web APIs . \n\nREST also refers to usage of defined resource types when transferring the objects between \ntwo ends\u2014URIs or URLs for representations of the resources. REST also refers to the \nusage of use verbs (commands), POST, GET, PUT and DELETE (Section 3.4.4) and files of \nMIME types. \n\nMultipurpose Internet Mail Extensions or MIME refers to the type of files that are widely \nused on the Internet by web objects, applications and services. \n\nRESTful refers to one which follows REST constraints and characteristics. \n\nUser Datagram Protocol (UDP) is a protocol at the transport layer for the web using Internet \nand Constrained RESTful Environment (CoRE). UDP specifies the way of enveloping \nthe datagram by header words, which just specifies the ports and addresses of two \nends between which the datagram transfers. UDP is described in detail in Chapter 4, \nSection 4.3.3. \n\nHypertext means text embedded with hyperlinks. HyperText Transfer Protocol (HTTP) \nmeans an application layer protocol for use of hypertext as app data transfer protocol. \nClients and servers use the URLs http://\u2026 . \n\nHyperlink refers to a specification of the URL for a resource path, so that a link can be \nestablished between two objects. For example, hyperlink URL specifications for the \nauthor\u2019s earlier book\u2019s supplementary web-resources at McGraw-Hill Higher Education \nserver are http://www.mhhe.com/kamal/emb3. Retrieval of a resource at a web object by \nthe other object uses the click at a link shown on a displayed text on browser. \n\nHyperText Markup Language (HTML) is a language for creating a hypertext which refers \nto text that embeds text, images, audio and video, image frames, forms, lists, tables, \nnavigation links (reference to resources), APIs, Java Script and other codes for dynamic \nactions. \n\nExtensible Markup Language (XML) is a language, which enables creation, sending and \nreceiving documents, messages, commands, query responses, queries, and creation of \nforms. The form data, response or message uses a new tag (not defined earlier in HTML) \nwith new data type definitions than the ones at HTML. HTML5 is the latest version \nof HTML which includes features of XML and many new features as well. A form, for \n\n\n![Image](/src/assets/generated_images/iot2_p105_i0.png)\nDesign Principles for Web Connectivity \n79 \n\nexample, has a number of fields such as, Name, Phone, Address, e-Mail ID. Form data \nmeans filled contents in the fields of a form. For example, one creates a new tag, \u2018name\u2019, \nand use in the XML line as follows: <name>Raj Kamal </name>, then name field of form \nhas data \u2018Raj Kamal\u2019. Sign \u2018/\u2019is for ending. \n\nBrowser is a client software which displays hypertext that enables navigation to the \nhypertext links shown on the user screen, and which displays GUIs of the apps, display \nform, display server responses, and so on. \n\nA WebSocket denotes an API for bidirectional communication that has much less \nheader size than HTTP communication and lower latency compared to HTTP approach of \nunidirectional communication at an instant  (Section 3.4.5). \n\nFramework refers to provisions for a number of software libraries, and a number of APIs \nincluding those that can be selectively changed by user codes in applications. An example \nof a framework is .NET framework. Advantages of frameworks are: easier to work with a \nset of discrete objects, software components, protocols, complex and different technologies; \nbinds these together into something highly useful; forces the programmers to implement \ncode in a way that promotes consistent coding, thus with fewer bugs, and provisioning \nmore flexibility in the  applications; and easy in testing and debugging of the code. \n\nThe following sections describe the design principles for web connectivity of connected \ndevices. Later in the chapters how connected devices use the CoAP, LWM2M, XML, \nmessage queues, MQTT, XMPP, SOAP, RESTful HTTP, WebSockets and other protocols \nfor the web connectivity to services, applications and processes has been discussed. \n\n3.2  WEB COMMUNICATION PROTOCOLS \n\nFOR CONNECTED DEVICES \n\nData of connected devices routes over the web in two types of \ncommunication environments. The environments are: \n\n\u25cf Constrained RESTful Environment (CoRE): IoT devices \nor M2M devices communicate between themselves in \na Local Area Network. A device typically sends or receives 10s of bytes. The data \ngathered after enriching and consolidating from a number of devices consists of 100s \nof bytes. A gateway in the communication framework enables the data of networked \ndevices that communicate over the Internet using the REST software architecture. \n\n\u274d Devices have the constraint in the sense that their data is limited in size compared \n\nto when data interchange between web clients and web servers takes place using \nHTTP, Transmission Control Protocol (TCP) and Internet Protocol (IP). \n\n\u274d Another constraint is data-routing when Routing Over a network of Low power \n\nand (data) Loss (ROLL). ROLL network is a wireless network with low power \ntransceiver. Another constraint is that the devices may sleep most of the time in \n\nExtend the \nunderstanding of \nweb communication \nprotocols used by \nconnected IoT/M2M \n\ndevices \n\nLO 3.1 \n\n80 \nInternet of Things: Architecture and Design Principles \n\nlow power environment and awaken on an event or when required (on client \ninitiative). Devices\u2019 connectivity may also break for long periods, have limited up \nintervals in loss environment, and have limited data size. \n\n\u25cf Unconstrained Environment: Web applications use HTTP and RESTful HTTP for web \nclient and web server communication. A web object consists of 1000s of bytes. Data \nroutes over IP networks for the Internet. Web applications and services use the IP and \nTCP protocols for Internet network and transport layers (Section 4.3). \nFigure 3.1 shows device\u2019s local area network connectivity, web connectivity in constrained \nand unconstrained RESTful environments and the protocols for communication. \n\n10s of Bytes \n\n10s of Bytes \n\n10s of Bytes \n\n10s of Bytes \n\n10s of Bytes \n\nDevice 1 \n\nDevice 2 \n\n10s of Bytes \n\nApplication Support \nand \nApplication Layers \n\nTransport \n\nLayer \nNetwork \n\nLayer \nApplication \n\nLayer \nPhysical/Data-link \n\nLayer \n\nDevice i \n\nIoT or M2M \n\nArea Local \nNetwork and \n\nGateway \n\nCoAP \n\n6LowPAN \n\nLWM2M \n\nZigBee IP \n\nBluetooth \nSmart IP \n\nZigBee NAN \n\nBluetooth \n(Low energy), ZigBee \nWireless or Wired \nTechnologies \n\n\u2026\u2026\u2026 \n\n\u2026\u2026\u2026 \n\nDevice \n(i\u20131) \n\nWeb \nConnectivity \n\ncoap://\u2026\u2026 \n\nWeb Object \nWeb Object \nRoll \n\nCoAP \nClient \n\nCoAP \nServer \n\n100s of \nBytes \n\n100s of Bytes \n\nDTLS \n\nDTLS \n\nUDP \n\nUDP \n\nCoAP \nServer \n\nCoAP \nClient \n\nHTTP \nServer \n\nHTTP \nClient \nTCP \n\nTLS \nIP \nhttp://\u2026\u2026 \n\nhttp://\u2026\u2026 \n\n[10s and 100s of Bytes Communication Framework \nConstrained RESTful Environment (CoRE)] \n\n[1000s of Bytes (Un- \n\nconstrained HTTP \n\nEnvironment)] \n\nFigure 3.1 IoT or M2M devices local network connectivity and web connectivity in constrained \n\n(above thick dotted line) and unconstrained RESTful HTTP (below thick dotted line) \nenvironments using communication protocols \n\nAssume that a web object refers to a web client or web server. \nThe web object communicates a request of the client or a response \nof the server. Communication is over the ROLL network or \nInternet. \n\nFigure 3.1 shows the following: \n\n\u25cf Assume i-devices (1, 2, \u2026 i th ) connected devices network, and local network having \n\nWeb objects refer to \n\nclient and server \n\nDesign Principles for Web Connectivity \n81 \n\nconnectivity between the devices at physical/data-link and adaptation layer (left-hand \nside) \n\n\u25cf Communication between web objects (right-hand side) \n\n\u25cf IETF CoRE specifications, which include CoAP and UDP \n\n\u25cf Web objects\u2019 protocols for sending a request or response; for example, RESTful CoAP, \nCoAP client and CoAP server communication over the network and transport layers \nto other end CoAP client and server. Client/server use the URIs coap://\u2026 in place of \nhttp://\u2026 . \n\n\u25cf Transport layer protocols used are Datagram Transport Layer Security (DTLS) and \nUDP.  Data between web objects route using ROLL network specifications of IETF. \n\n\u25cf 100s of bytes communicate between the IoT web objects \n\n\u25cf Web objects HTTP client and HTTP server communication over the Internet using the \nIP and client/server use the URLs http://\u2026 . \n\n\u25cf 1000s of bytes communicate between HTTP web objects using certain protocols for \nsending a request or response; for example, RESTful HTTP. IPv6 or IP is the network \nlayer protocol used. The transport layer protocols used are TLS and TCP. \nIoT device or machine applications need constrained environment protocols such as \nCoAP and LWM2M. \n\n3.2.1 \nConstrained Application Protocol \n\nIETF recommends Constrained Application Protocol (CoAP) which is for CoRE using \nROLL data network. Features of CoAP are: \n\n\u25cf An IETF defined application-support layer protocol \n\n\u25cf CoAP web-objects communicate using request/response interaction model. \n\n\u25cf A specialised web-transfer protocol which is used for CoRE using ROLL network. \n\n\u25cf It uses object-model for the resources and each object can have single or multiple \ninstances. \n\n\u25cf Each resource can have single or multiple instances. \n\n\u25cf An object or resource use CoAP, DTLS (security binding with PSK, RPK and Certificate) \nand UDP protocols for sending a request or response. \n\n\u25cf Supports the resource directory and resource-discovery functions \n\n\u25cf The resource identifiers use the URIs as follow coap://\u2026 . \n\n\u25cf Has small message header, 4 bytes are for ver (version), T (message type) [Types are \nconfirmable, non-confirmable, acknowledgement and reset], TKL (token length), \ncode (request method or response code), message ID 16-bit identifier, token (optional \nresponse matching token). Confirmable means server must send an acknowledgement, \nwhile non-confirmable means no acknowledgement is required. \n\n\u25cf CoRE communication is asynchronous communication over the ROLL. \n\n\u25cf Integrates easily with the web using CoAP application cross-protocol proxies. This is \nfacilitated because HTTP and CoAP, both share the REST model. A web client may not \neven be aware that it just accessed an IoT device sensor resource or sent data to an IoT \ndevice actuator resource. \n\n\u25cf Use of REST: The access by a CoAP object or its resource is thus using: \n\n82 \nInternet of Things: Architecture and Design Principles \n\n\u274d the URI \n\n\u274d a subset of MIME types \n\n\u274d a subset of response codes which are used for an HTTP object or resource. \nFigure 3.2 (a) shows direct and indirect accesses of CoAP client objects to a CoAP server. \nFigure 3.2 (b) shows a CoAP client access for lookup of object or resource using a resource \ndirectory. \n\nIoT \nDevices \n\nCoAP \nClient \n\nIoT Area \nLocal Network \n\nObject 1 \n\nObject i \n\n. \n. \n. \n. \n\nCoAP \nServer \n\nCoAP \nServer \nIoT App \n\nCoAP \nClient \n\n/ms \nMirror \nServer \n\nDirect Access \n\nUpdate \n\nIndirect Access \n\nLookup for object/Resources \nAccess \n\n(a) \n\nCoAP \nClient \n\n/rd \nResources \n\nDirectory \n\nCoAP \nClient \n\nCoAP \nServer \n\nIoT App \n\nIoT App \n\nHTTP \nServer \n\nHTTP Client \n\nIoT App \n\n(b) \n\n(c) \n\nCoAP Client \nCoAP-HTTP Proxy \n\nHTTP-CoAP Proxy \n\nFigure 3.2 (a) Direct and indirect accesses of CoAP client objects to a CoAP server, (b) CoAP client access \n\nfor lookup of object or resource using a resource directory, and (c) CoAP client and server \naccess using proxies \n\nCoAP Client Web Connectivity \n\nA proxy is an intermediate server, which accepts a request from a client and sends the \nresponse to the client using a protocol. It also passes the request to the server and accepts a \nresponse from the server using the same or an other protocol. HTTP-CoAP proxy accepts \nrequests from HTTP client using HTTP protocol and sends the request to the server \nusing CoAP protocol. CoAP-HTTP proxy accepts requests from CoAP client using CoAP \nprotocol and sends the request to the server using HTTP protocol. \n\nFigure 3.2 (c) shows CoAP client and server access using proxies. \nTransport Layer Security (TLS), earlier known as Secure Socket Layer (SSL) is the \n\nDesign Principles for Web Connectivity \n83 \n\nprotocol used for securing the TCP-based Internet data interchanges. DTLS is the TLS for \ndatagram. The features of DTLS are: \n\n\u25cf DTLS provisions for three types of security services\u2014integrity, authentication and \nconfidentiality. \n\n\u25cf DTLS protocol derives from TLS protocol and binds UDP for secured datagram \ntransport. \n\n\u25cf DTLS is well suited for securing applications; for example, tunnelling applications \n(VPN), applications that tend to run out of file descriptors or socket buffers or \napplications which are delay sensitive (and thus use UDP). \n\n\u25cf A part of DTLS is OpenSSL repository openssl-0.9.8 security based on PSK, RPK and \ncertificate. \n\nSecured Use of a Key for Client Authentication \n\nPSK stands for Pre-Shared Key and is a method of securing using a key to authenticate a \nclient. The key contains up to 133 characters in English. PSK method generates a unique \nencryption key for each client. A PSK is a symmetric key without forward secrecy (sender \nkey not secret from receiver). Symmetric key means both ends 1 and 2 use the same key, \nK12 for encryption and decryption. Encryption uses an algorithm. \n\nPrivate key refers to a key agreed for usage of data encryption (ciphering) between a \npair of sender and receiver. The key is kept private between the two. Sender and receiver \ncan be objects, applications, web services or processes. \n\nRPK stands for Random Pair-wise Keys, which also stands for Raw Public Key meaning \nonly the private/public key [means end 1 using RPK uses (K1 and Kp) and the other end \nusing RPK uses (K2 and Kp)] are asymmetric. \n\nPublic key refers to a key (for example, a set of 128 or 256 bits), Kp which an intermediate \nserver or trusted entity, such as a bank server (or object) provides to both the sender and \nreceiver. The sender communicates using its key; for example, K1 and the receiver uses \nits key K2 when it communicates to the server; the server uses Kp.  Messages exchange \nbetween sender and server using K1 and Kp. Messages exchange between receiver  and \nserver using K2 and Kp. The keys K1 and K2 are therefore kept secret between one \nanother, sender and receiver. When message or data communication takes place each uses \nits own secret key and Kp of an intermediate server or entity. The advantage is that one \ncommunicating end cannot use the other end\u2019s key or even misuse that key later. \n\nX.509 certificate is a certificate with a chain of trust based on an authorised Certification- \nAuthority (CA) and Public Key Infrastructure (PKI). The sender submits a document \nonce to the CA for digital signature, and the CA issues a certificate of verification of that \ndocument. Later, that document can be authenticated by the CA as same and from the \nsame source. Public key infrastructure means provisioning a trusted service for assigning \npublic keys. \n\n84 \nInternet of Things: Architecture and Design Principles \n\n3.2.2 Lightweight Machine-to-Machine Communication Protocol \n\nLightweight Machine-to-Machine Communication (LWM2M) \nprotocol is an application layer protocol specified by Open \nMobile Alliance (OMA) for transfer of service data/messages. It \nfinds applications in M2M. It enables functionalities for device \nmanagement in cellular or sensor networks. Communication \nprotocol \u2018light weight\u2019 means that it does not depend on call \nto the system resources during execution. Example of call to a \nsystem resource is calling an API for display menu or network \nfunction in the system software (OS). Lightweight presently means data transfer formats \nbetween client and server are binary and has Tag Length Value (TLV) or Java Script Object \nNotation (JSON) batches of object arrays or resource arrays and transfers up to 100s of \nbytes unlike the webpages of 1000s of bytes. \n\nThe protocol enables communication between LWM2M client at IoT device and an \nLWM2M server at the M2M application and service capability layer. The protocol is a \ncompact one, meaning small header. It has an efficient data model. It is generally used in \nconjunction with CoAP. \n\nFigure 3.3 shows M2M devices LAN connectivity. It shows constrained devices \nnetwork connectivity with M2M applications and services using LWM2M OMA standard \nspecifications of LWM2M. \n\nAssume i number of M2M devices. Figure 3.3 shows the following: \n\n\u25cf Local M2M constrained devices use, for example, the Bluetooth low energy, 6LowPAN \n(IPv6 over low power WPAN), CoRE, ROLL, NFC, ZigBee PAN, cellular, Wi-Fi or \nZigBee IP (left-hand side) network technologies. M2M area network functions as PAN \nfor connectivity between devices and the M2M gateway. \n\n\u25cf 10s of bytes communicate between a device and the PAN. \n\n\u25cf Communication between LWM2M objects (right-hand side). LWM2M client refers to \nobject instances as per the OMA standard LWM2M protocol. A client object sends \na request or receives a response of the LWM2M server over the access and CoRE \nnetworks. \n\n\u25cf CoRE network, for example, 3GPP or other networks for the IP connectivity \n\n\u25cf Communication from an object instance using interface functions. The functions are \nbootstrapping; registration, deregister or update a client and its objects; reporting the \nnotifications with new resource values; and service and management access through \nthe server. \n\n\u25cf Use of the CoAP, DTLS, and UDP protocols by the object or resource. \n\n\u25cf 100s of bytes communicate between objects at the client or server for plain text or \nJSON or binary TLV format data transfer. \nLWM2M specifications and features are as follows: \n\n\u25cf An object or resource use CoAP, DTLS, and UDP or SMS protocols for sending a \nrequest or response. \n\nConstrained \nenvironments \ncommunication with \nM2M apps and services \n\nusing connectivity of \nLWM2M objects and \n\nresources \n\nDesign Principles for Web Connectivity \n85 \n\n\u25cf Use of plain text for a resource or use of JSON during a single data transfer or binary \nTLV format data transfer for a package for a batch of resource representations in a \nsingle data transfer. \n\n\u25cf An object or its resource access using an URI. \n\n\u25cf Interface functions are for\u2014bootstrapping; registration, deregister or updating a client \nand its objects; reporting the notifications with new resource values; and service and \nmanagement access through the server. \n\n\u25cf Use of object model for resources and each object can have single or multiple instances. \nEach resource can have single or multiple instances. \n\n\u25cf OMA or other standard specifying organisation defines the LWM2M objects for \nusages in M2M communication. An LWM2M client has object instances as per OMA \nstandards. LWM2M client-server interactions are over the access and CoRE networks \nwhich generally use CoAP over ROLL. LWM2M device client and server, generally use \nCoAP client server interactions for data interchanges. Wi-Fi and WiMax are examples \nof access networks. Examples of CoRE network are GSM, GPRS, 3GPP and 4G LTE or \nother networks for IP connectivity as well as roaming. \n\n[Bluetooth (Low energy), ZigBee IP, \n6LowPAN, Cellular, Wi-Fi or other IP \nConstrained Devices and Network] \nM2M \nmanagement \n\nfunctions \n\nM2M app \n\nM2M app \n\nM2M app \n\nM2M \nservice \n\nM2M \nService \n\nLWM2M \n\nclient \n\nLWM2M \n\nserver \n\nM2M \nService \nCapabilities \n\nM2M \nApplications and \n\nManagement \n\nFunctions \n\nResources \n\nStack \n\nBootstrap \n\nRegistration \n\nReport \n\nObject/resource access \n\nStack \n\nResources \n\nCoAP \nserver \n\nCoAP \nclient \n\nUDP \nSMS \n\nDTLS \n\nUDP \nSMS \n\nDTLS \n\n100s of Bytes \n\nInterfaces \n\nObject i \n\nCoRE and \n\nAccess \nNetworks \nM2M Gateway \nM2M Devices \n\n10s of Bytes \n\n10s of Bytes \n\n10s of Bytes \n\n10s of Bytes \n\n10s of Bytes \n\nM2M Device \nPAN \n\nDevice 1 \n\nDevice 2 \n\n\u2026\u2026 \n\n\u2026\u2026 \n\nDevice \n\nDevice i \n\n100s of Bytes \n\nM2M Area \n\nLocal \nNetwork \n\nObject 1 \n\nLWM2M \n\nClient \n\nJSON \nbatches of \nObjects or \n\nResource \n\nTLV \n\nPlain \n\nText \n\n(i - 1) \n\nFigure 3.3 M2M devices local area network connectivity, and constrained devices network connectivity \n\nwith M2M applications and services using LWM2M OMA standard specifications of LWM2M \n\n86 \nInternet of Things: Architecture and Design Principles \n\n\u25cf Organisations can register the other LWM2M objects and resources with OMA or \nother standards organisations. \n\n\u25cf M2M management functions can be M2M Service Bootstrap Function (MSBF) for \ncredentials of the devices and gateway, and M2M authentication server (MAS) for \nsecurity, root key data store and device and data authentication. \nExample 3.1 gives the OMA specifications 2 for management objects, query resources, \nlocation resources and resource attributes, and response codes for M2M. \n\nExample 3.1 \n\nProblem \nGive examples of LWM2M objects and resources. \n\nSolution \n\nFollowing are OMP-specifications-based objects and resources: \n\nOMA Management Objects \n\nObjects assignments are: \n\n\u25cf Multiple instances case ID = 1 for LWM2M server, and 2 for access control (means rights granted yes \nor no). \n\n\u25cf Single instance case ID = 3 for device object, 4 for connectivity monitoring, 5 for firmware (installation, \nupdate or actions after update) and 6 for location object. \n\nQuery Parameter Codes \nThe assignment of parameters in the queries is: \n\n\u25cf h for end-point name, when registering in a domain \n\n\u25cf rt for end-point type \n\n\u25cf lt for life-time in second. \nLocations Object Resources \n\nLocations Object Resources have single instances. Each instance is specified by an ID as follows: \n\n\u25cf 0 for latitude, 1 for longitude, 2 for altitude (in decimal numbers), \n\n\u25cf 4 for velocity of non-static devices, \n\n\u25cf 5 for time stamp \n\n\u25cf 3 for uncertainty. \nResource Attributes \nAttributes assignment is using an id, which is an integer for resource id. Attributes used in auto-observation \nare specified as: \n\n\u25cf if (interface description at initiation at bootstrapping) \n\n\u25cf url (for path) \n\n\u25cf rl (for type) \n\n\u25cf ct (for CoAP content type convert ASCII MIME type) \n\n\u25cf obs (observable Boolean) \n\n\u25cf aobs (auto-observable Boolean) \n\n2 https://github.com/OpenMobileAlliance/OMA-LWM2M-DevKit/blob/master/objects/lwm2m-object-definitions.json \n\nDesign Principles for Web Connectivity \n87 \n\nResponse Codes \nSpecified for creating successful registration and maximum lifetime or 4.00 for a bad CoAP request (Example \n3.1). \n\n3.2.3 \nJSON Format \n\nFeatures of a JSON are: \n\n\u25cf JSON is an open-standard format used primarily to transmit data between a server \nand web application, as an alternative to XML. The text is human readable. It transmits \ndata objects as text to transmit. It consists of attribute\u2013value pairs. \n\n\u25cf Originally derived from the JavaScript scripting language, JSON, is now a language- \nindependent data format, the coding of which can be in Java or C or another \nprogramming language used for parsing and generating JSON data. \nExample 3.2 describes codes used for data transfer in JSON. \n\nExample 3.2 \n\nProblem \nGive a JSON object example in JavaScript using OMA object definitions. \n\nSolution \n\nFollowing are the codes as per OMA specifications for LWM2M objects 2 . The code is at: \n\n{ \n\n\u201c0\u201d: \n{ \n\n\u201cid\u201d: 0, \n\n\u201cname\u201d: \u201cLWM2M Security\u201d, \n\n\u201cinstancetype\u201d: \u201cmultiple\u201d, \n\n\u201cmandatory\u201d: true, \n\n\u201cdescription\u201d: \u201cThis LWM2M Object provides the objects and resources of Client appropriate to \naccess a specified LWM2M Server. The LWM2M Object Resources MUST only be changed by a LWM2M \nBootstrap Server or Bootstrap from Smart Sensor and MUST NOT be accessible by any other LWM2M \nServer. One Object Instance SHOULD address a LWM2M Bootstrap Server.\\n \u201c, \n\n\u201c0\u201d: \n\n\u201cresourcedefs\u201d: { \n\n{ \n\n\u201cid\u201d: 0, \n\n\u201cname\u201d: \u201cLWM2M  Server URI\u201d, \n\n\u201coperations\u201d: \u201c-\u201d, \n\n\u201cinstancetype\u201d: \u201csingle\u201d, \n\n\u201cmandatory\u201d: true, \n\n\u201ctype\u201d: \u201cstring\u201d, \n\n88 \nInternet of Things: Architecture and Design Principles \n\n\u201crange\u201d: \u201c0-255 bytes\u201d, \n\n\u201cunits\u201d: \u201c\u201d, \n\n\u201cdescription\u201d: \u201cUniquely identifies an LWM2M Server or LWM2M Bootstrap Server. Its form is: \n\\n\\\u201dcoaps://host:port\\\u201d, where port is the UDP port of the Server.host is an IP address or FQDN, \nand \u201c \n\n\u201c1\u201d: \n}, \n\n{ \n\n\u201cid\u201d: 1, \n\n\u201cname\u201d: \u201cBootstrap Server\u201d, \n\n\u201coperations\u201d: \u201c-\u201d, \n\n. \n\n. \n\n. \n\n} \n\n\u201c9\u201d: { \n\n\u201cid\u201d: 9, \n\n\u201cname\u201d: \u201cLWM2M Server SMS Number\u201d, \n\n\u201coperations\u201d: \u201c-\u201d, \n\n\u201cinstancetype\u201d: \u201csingle\u201d, \n\n\u201cmandatory\u201d: true, \n\n\u201ctype\u201d: \u201cinteger\u201d, \n\n\u201crange\u201d: \u201c\u201d, \n\n\u201cunits\u201d: \u201c\u201d, \n\n}, \n\n\u201cdescription\u201d: \u201cMSISDN used by the LWM2M Client  to send messages to the LWM2M Server via \nthe SMS binding. \\nThe LWM2M Client SHALL silently ignore any SMS not originated from unknown \nMSISDN\u201d \n\nExample 3.3 describes the codes used for data transfer in Java using JSON. \n\nExample 3.3 \n\nGive a JSON object example in Java. \n\nSolution \n\nJSON object is subclass of java.util.HashMap. Assume sensor name is SensTemp1, temperature is integer, \nand number of sensors is a double. is_newSensorAdded ( ) is a method which returns Boolean data type. \n\nFollowing is the code in Java: \n\nDesign Principles for Web Connectivity \n89 \n\n//import org.json.simple.JSONObject; \nJSONObject obj=new JSONObject(); \n\nobj.put (\u201cname\u201d,\u201dSensTemp1\u201d); \nobj.put (\u201ctemperature\u201d,new Integer(100)); \nobj.put (\u201cnumberOfSensors\u201d,new Double(1000.21)); \nobj.put (\u201cis_newSensorAdded\u201d,new Boolean(true)); \nStringWriter out = new StringWriter(); \n\nobj.writeJSONString(out); \nString jsonText = out.toString(); \nSystem.out.print (jsonText); \nResult: {\u201cName\u201d: \u201cSensTemp1\u201d: \u201cTemperature\u201d: 26\u201d \u201cnumberOfSensors\u201d:1000000, \u201cnewSensorAdded\u201d: null, } \n\n3.2.4 Tag Length Value Format \n\nIn a TLV format the first two bytes are used to identify the parameter. The first and fourth \nbytes indicate the length of the actual data which follows directly after these bytes. 3 \n\nFollowing is an example of codes used for data transfer in TLV format. \n\nExample 3.4 \n\nProblem \nGive examples of  TLV format messages. \n\nSolution \n\nAssume that an application service uses CoAP for which code is \u201c200\u201d (standard number allotted by OMA.) \nLet engine parameter rpm is assigned ID = 125 and velocity assigned ID = 126.  Format in TLV can be as \nfollows: \n\n</engine>;EngObj;id=\u201d20\u201d;ct=\u201d200\u201d, \n</engine/rpm>; EngObj;id=\u201d125\u201d, \n\n</engine/velocity>;EngObj;id=\u201d126\u201d \n\n3.2.5 MIME Type \n\nGeneric-type files are application/octet-stream; however, MIME-type files are used in web \napplications and services. 4 Features of MIME are: \n\n\u25cf An Internet standard which is for description of the contents of various files. \n\n\u25cf An Internet standard which extends the Simple Mail Transfer Protocol (SMTP) format \nof email to support the text in character set besides ASCII, and the non-text attachments \nsuch as  audio, video, images and application programs. \n\n\u25cf Supports messages with multiple parts and header information in non-ASCII character \nsets. \n\n3 https://en.wikipedia.org/wiki/Type-length-value \n4 https://en.wikipedia.org/wiki/Media_type \n\n90 \nInternet of Things: Architecture and Design Principles \n\n\u25cf Initially designed for mail, now it is used as Internet media type. Web client header \nspecifies the content types using a MIME type. \n\n\u25cf List of MIME type files is exhaustive. Few examples of MIME type files are\u2014doc \n(application/msword), html (text/html), htm (text/htm), gif (image/gif), js (application/ \nx-javascript), css (Application is text/css), mpeg (video/mpeg), pdf (application/pdf) \nand exe (application/octet-stream). HTML links, objects, and script and style tags, each \nhas a type attribute the value of which can be set equal to a MIME type. The MIME \ntype for HTML is text/html. \nAn associated file is also used which is called mime.types file. It associates filename \nextensions with MIME type. Such kinds of files allow one to use the extension in these \ncases. A mime.types file enables a web server to determine MIME type of a resource. This \nis because a file system may not store the MIME type information, but instead rely on the \nfilename extension. \n\nReconfirm Your Understanding \n\n\u25cf Meanings of important key terms\u2014API, service, state, object, resource, directory, repository, \nidentifier, discovery, representation, URI, URL, header, hypertext, hyper link, HTTP, HTML and XML \nhave been discussed. \n\n\u25cf REST is a software architecture. It refers to the practices and constraints to be followed. REST uses \nURIs/URLs for representations of the resources, uses access methods: POST, GET, PUT and DELETE. \nThe architecture is used during design of software components. \n\n\u25cf IETF recommended CoRE specifications for ROLL network. CoRE specifications include the CoAP and \nUDP. \n\n\u25cf CoRE objects use standard protocols for constrained environment when sending a request or response. \nCoAP client and CoAP server objects communicate over the network, transport layers to other end \nCoAP client and server. The objects connect to web using HTTP-CoAP and CoAP-HTTP proxy. A client/ \nserver object use the URIs coap://\u2026 in place of http://\u2026 . \n\n\u25cf CoAP client-server interactions use UDP and DTLS protocols. The HTTP client-server interactions use \nTCP/UDP and TLS protocols. \n\n\u25cf LWM2M client has specifications of the object instances as per OMA specifications.  LWM2M client- \nserver interactions are over the access and CoRE networks. LWM2M client and server generally use \nthe CoAP client server interactions over ROLL. Access network examples are Wi-Fi and WiMax. CoRE \nnetwork examples are GSM, GPRS, 3GPP, 4G LTE and other networks which enable IP connectivity \nand roaming. \n\n\u25cf An object instance communicates using the LWM2M  Interface functions that are bootstrapping; \nregistration, deregister or update a client and its objects; or reporting the notifications with new \nresource values; and service and management access through server. \n\n\u25cf An application exchanges the objects using Internet protocols. 100s of bytes communicate between \nthe objects at the client or server. The objects communicate plain text, XML, JSON, TLV or MIME type \nformats for communication on the Internet. \n\n\n![Image](/src/assets/generated_images/iot2_p117_i0.png)\nDesign Principles for Web Connectivity \n91 \n\nS elf-Assessment E xercise \n\n1. List the properties of constrained environments. Use examples of connected \n\ndevices, such as streetlights, RFIDs and ATMs with the Internet. \n2. Give the order of bytes which transmit or are received at the connected device, \n\ndevices local area network cum gateway and at the HTTP web object during \ninterchange of data between devices and network, and application and service \ndomains. \n3. List features of REST architectural style of designing software components. \n4. Create a table of comparison between constrained devices and unconstrained \n\nsystem environment, protocols, client and server characteristics. \n5. Consider Figure 3.1 and draw a data communication diagram for ZigBee IP \n\nconnected streetlights local network gateway connectivity and secured web \nconnectivity to streetlight monitoring and controlling server applications \nin the CoRE and unconstrained  environments using the CoAP and HTTP \nprotocols. \n6. List the features of CoAP. \n7. What are the functions of DTLS? \n8. Consider Figure 3.3 and draw a data communication diagram for RF links \n\nconnected RFID local network gateway connectivity and inventory application \nand tracking service using LWM2M and IP network. \n9. List OMA specifications for management objects, query resources, location \n\nresources and resource attributes and response codes for M2M. \n10. Write code for JSON object in Java. Assume sensor names are StreetLightN_I \n\nand StreetLightN_J for Nth streetlight. Ambient-light sensor N_I output \nis Boolean and  Street Traffic density  sensor N_J output is a Byte. The is_ \nSensorN_IAdded ( ) and is_SensorN_JAdded ( ) are methods which returns \nBoolean data type. \n11. Write the format in TLV for data interchange in LWM2M. Assume that an \n\napplication service uses CoAP for which code is \u201c200\u201d (Standard number \nallotted by OMA. Let traffic density parameter numPer100Meter is assigned \nID = 4038 and street length, m is assigned ID = 126). \n12. List 10 extensions in the list of MIME-type files. \n\n\u2605 \n\n\u2605 \n\n\u2605 \n\u2605 \n\n\u2605\u2605\u2605 \n\n\u2605\u2605 \n\n\u2605 \n\u2605\u2605 \n\n\u2605\u2605 \n\n\u2605\u2605\u2605 \n\n\u2605 \n\n3.3 \nMESSAGE COMMUNICATION PROTOCOLS \nFOR CONNECTED DEVICES \n\nA device/node/end-point/client/server sends and receives \nmessage(s). A communication module includes a protocol \nhandler, message queue and message cache. The protocol- \n\nIllustrate the \nusage of messaging \n\nprotocols between \nconnected devices and \n\nthe web \n\nLO 3.2 \n\nNote: \n\u2605 Level 1 & Level 2 category \n\n\u2605\u2605 Level 3 & Level 4 category \n\n\u2605\u2605\u2605 Level 5 & Level 6 category \n\n92 \nInternet of Things: Architecture and Design Principles \n\nhandler functions during transmission and reception of messages according to the \ncommunication protocols for these actions. Message queue forms to keep a message \nuntil it is transmitted towards its destination. Message cache keeps an incoming message \nuntil it is saved into the module. A device message-queue inserts (writes) the message \ninto the queue and deletes (reads) the message from the queue. Device message-cache \nstores the received messages. The following section explains the terms used by message- \ncommunication protocols. \n\n3.3.1 Terminology \n\nRequest/Response (Client/Server) \n\nA request/response message exchange refers to an object (client) requesting for resource(s) \nand an object (server) sending the response(s). The objects, for example, HTTP objects \nmay use the REST functions. When sending a request, a protocol adds the header words. \nEach header has fields. Each field interprets the request at the receiver object. \n\nPublish/Subscribe (pubsub) \n\nPublish/subscribe or PubSub message exchanges differ from request/response. A service \npublishes the messages; for example, a weather information service publishes the \nmessages of weather reports for the potential  receivers. A group controller publishes the \nmessages; for example, measured values of ambient light conditions, traffic density or \ntraffic presence (Example 1.2). \n\nA service can be availed by one or more clients or brokers. When a client subscribes to \nthe service, it receives messages from that service. A publish/subscribe messaging protocol \nprovisions for publication of messages and reception on subscription (PUT and GET \nmethods) by the registered or authenticated devices. \n\nPublication may be for measured values, for state information or resources of one or \nmore types. Subscription is for a resource-type (or for a topic) . A separate subscription is \nrequired for each resource-type or topic . \n\nAn example of resource type is measured values of ambient light condition in the smart \nstreetlights example. Another resource type is traffic presence or absence on the street. \nAnother resource type is lighting function report; functioning is proper or fault exists in \nthe light. \n\nResource Directory \n\nResource directory (RD) 5 maintains information and values for each resource type. A \nresource of a resource type accesses from the RD using URI for the resource. \n\nResource Discovery \n\nResource discovery service may advertise (publish) at regular intervals, the availability \nof the resources or types of the resources available and their states. A client discovers the \nresource type and registers for the RD service. \n\n5 https://tools.ietf.org/html/draft-koster-core-coapmq-00 \n\nDesign Principles for Web Connectivity \n93 \n\nRegistration/Registration Update \n\nRegistration means a receiver registers with a service, such as an a RD service. When \none or more endpoints or devices or nodes registers, then that device gets the access \nto the resources and receives published messages. Security considerations may require \nauthentication of both ends (service provider and receiver) before registration. A separate \nregistration is required for each endpoint (client or server). \n\nRegistration updates means updating for one or more endpoints or devices or nodes. It \nalso includes unregistering for one or more endpoints. \n\nPull (Subscribe/Notify) Data \n\nPull means pulling a resource, value, message or data of a resource-type by registering \nand subscribing. Pull may be using GET or on initiating OBSERVE. The server maintains \nstate information for a resource and notifies on change of state. Client pulls again the \nresource on the change. \n\nPolling or Observing \n\nPolling means finding from where new messages would be available or whether new \nmessages are available or updates are available or whether the information needs to \nbe refreshed or finding the status if the state information has changed or not. When \nmessages store at a database-server, then polling can be done by a client who uses the \nREST architecture GET method and server uses the POST. \n\nA state may refer to a connection or disconnection, sleep, awake, created, alive (not \ndeleted), old values persisting or updated with new values (GET + OBSERVE). Observing \nmeans looking for change, if any, of a state at periodic intervals (OBSERVE). \n\nPush (Publish/Subscribe) Data \n\nPush means a service that pushes the messages or information regularly. Interested device \nor endpoint or potential receiver receives these pushes. For example, a mobile service \nprovider pushes the temperature and location information regularly for the potential \nreceivers (registered mobile services subscribers) (PUT). \n\nPush is efficient compared to polling, particularly when notifying or sending alerts. \nThis is because there can be many instances when polling returns no data. Pull  is efficient \ncompared to polling or PUSH when certainty exists that within a reasonable time interval \nthe server returns no data. \n\nMessage Cache \n\nCache means storing when available and can be used later on when required. Messages \ncache is useful in an environment of short or prolonged disconnections of a service. A \nmessage can be accessed once or more times from a cache. \n\n94 \nInternet of Things: Architecture and Design Principles \n\nMessage Queue \n\nMessage queuing means storing the messages (data) in sequence from devices or endpoints \nso that when connection state changes then messages can be forwarded. Forwarding is \ndone using the first-in first-out method for a resource type. A message forwards only once \nfrom a queue. \n\nSeparate queues are formed for each resource type. The messages are forwarded to the \nregistered devices or endpoints and to the subscribed devices or endpoints. A separate \nregistered device or endpoint list and a separate subscription list is maintained and used \nfor each resource type. Forwarding takes place only after matching the subscription from \na list. \n\nInformation/Query \n\nThe method is that an object (client) requests information using a query while another \nend-object (server) responds by replying to the query. The responding application \nprocesses the query using the query optimiser and retrieval plan. The query processing \nuses a database or resource directory resources. \n\n3.3.2 \nCommunication Protocols \n\nFollowing are the protocols used in message communication. \n\nCoAP-SMS and CoAP-MQ \n\nM2M or IoT device uses SMS quite frequently. SMS is identified as the transport protocol \nfor transmission of small data (up to 160 characters). It is used for communicating with a \nGSM/GPRS mobile device. \n\nM2M or IoT device uses message queuing quite frequently due to ROLL environment \nand constrained devices (awake only when initiated) or connection-breaks for long \nperiods. CoAP-SMS and CoAP-MQ are two protocols drafted and recommended by IETF. \n\nCoAP-SMS \n\nCoAP-SMS is a protocol when CoAP object uses IP as well as cellular networks and uses \nSMS. It is an alternative to UDP-DTLS over ROLL for CoAP object messages and when \nusing cellular communication. \n\nSMS is used instead of UDP + DTLS by a CoAP client or server. A CoAP client \ncommunicates to a mobile terminal (MT) endpoint over the General Packet Radio Service \n(GPRS), High Speed Packet Access (HSPA) or Long Term Evolution (LTE) networks using \nCoAP-SMS protocol. \n\nFollowing is the IETF recommended terminology for use: \n\n\u25cf SMS-C: SMS service centre \n\n\u25cf SMS-SP SMS service provider \n\nDesign Principles for Web Connectivity \n95 \n\n\u25cf CIMD: Computer interface to message distribution \n\n\u25cf MS:  Mobile station at a cellular network functioning as CoAP client  or CoAP sever \n\n\u25cf MO: Machine or IoT device or mobile origin functioning as CoAP client \n\n\u25cf MT: Machine or IoT device or mobile terminal functioning as CoAP sever \n\n\u25cf SMPP: Short message peer-to peer for CoAP-Data. Peer-to-peer means sending \nrequests as well as receiving requests \n\n\u25cf SS7: Signalling Service Protocol \n\n\u25cf UCP/UMI: Universal computer interface protocol/machine interface for short message \ndelivery contained in a CoAP request or CoAP response \nThe CoAP-SMS features are as follows: \n\n\u25cf An URI used as coap+sms:// in place of coap://. For example, URI may be coap+sms:// \ntelNum/carLocatiobObject/latitude for latitude of location of  a car after  LocationObject \nmeasures location parameters using the GPS. URI is used when sending the SMS to \nthe specified telephone number\u2014telNum. \n\n\u25cf A CoAP message encodes with alphabets for SMS communication. An SMS message \nconsists of 160 characters in 7-bit encoding of a character. Maximum length for a CoAP \nmessage is thus 140 B (= 160 \u00d7 7 bits/8 bits) when an SMS-C supports 8-bit encoding. \nA CoAP message is thus 70 (= 160 \u00d7 7 bits/16 bits) when an SMS-C supports 16-bit \nencoding and multilingual alphabets. Concatenated short messages can be up to 255B, \nprovided the SMS-C supports this. \n\n\u25cf CoAP endpoints have to work with a Subscriber Identity Module (SIM) card for SMS in \ncellular networks. The points are addressed by using Mobile Station ISDN (MSISDN) \nnumber.  A TP-DATA-Coding-Scheme inclusion enables the CoAP client to find that \nthe short message contains a CoAP message. \n\n\u25cf Does not support multi-casting \n\n\u25cf Two additional options are Response-to-URI-Host (RUH) and Response-to-URI-Port \n(RUP) which make initiating CoAP client aware of the presence of the alternative \ninterface CIMD and SMPP and UCP/UMI. RUH is string of size 0 to 255B. RUP is \nof 2B with default port number 5683. IANA (Internet Assigned Number Authority) \nregistered TBD as CoAP Option Numbers for registry. \n\n\u25cf Data interchange sequences are as follows: An MS/CoAP client sends a SMS request \n(SMS-SUBMIT) to SMS-C; SMS-C reports using SMS-SUBMIT-REPORT; SMS-C sends \nSMS (SMS-DELIVER) to MS/CoAP server; the server reports using SMS-DELIVER- \nREPORT; and SMS-C sends SMS-STATUS-REPORT to the client. \n\n\u25cf Authentication of a client by the server provides the security. MSISDN of the MS and \nSIM based security is used during SMS data exchanges. \nFigure 3.4(a) shows a CoAP request or response communication to a machine, IoT \ndevice or MT. A CoAP client sends request to SMS-C which transmits the request to an \nMT. A CoAP server sends response to SMS-C which transmits the response to the client. \n\nFigure 3.4(b) shows a computer or machine interface using IP for sending request or \nreceiving the CoAP data or HTTP request (REQ) to a mobile service provider using SMPP \nor CIMD for data interchange. The service provider communicates using SS7 or CIMD or \n\n96 \nInternet of Things: Architecture and Design Principles \n\nSMPP with machine or IoT device or MT with an in-between node SMS-C. The terminal \nsends response to the origin using SMS-C and CoAP-MQ Broker. \n\nFigure 3.4(c) shows a CoAP request or response communication from a machine, IoT \ndevice or MO. A CoAP client sends request to SMS-C which transmits the request. A CoAP \nserver sends the response to SMS-C which transmits it to the client. \n\nFigure 3.4(d) shows a computer or machine interface using IP for receiving request or \nsending response (RES) as CoAP data or HTTP REQ mobile service provider using SMPP \nor CIMD for data interchange. The SMS-C communicates that to CoAP-MQ BROKER \nusing SS7 or CIMP or SMPP. SMS-SP receives request or sends response to machine or IoT \ndevice or mobile origin. \n\nCoAP-MQ \n\nCoAP-MQ is a message queue protocol using a broker and RD. Roles of CoAP endpoints \nhave roles as a client and server. \n\nCoAP \nRequest \n\nCoAP \nRequest \n\nMT \nMT \n140 B \nSMS-C/ \n\nHLR \nSPS-SP \nSPS-C \nIP \nCIMD or \nSMPP \n\nHTTP-REQ/ \nCoAP Data \n\nSS7/ \nCIMD/ \n\nSMPP \n\nCoAP \nRequest \n\nCoAP \nResponse \n\nCoAP \nResponse \nHTTP-REQ/ \n\nCoAP Data \nCoAP \nResponse \n(b) \n(a) \n\nCoAP \nRequest \nCoAP \nRequest \nHTTP-REQ/ \n\nCoAP Data \n\nIP \nCIMD or \n\nSMPP \n\nHTTP-RES/ \n\nCoAP Data \n\nSMS-SP \nSMS-C/ \n\nHLR \nMO \n\nCoAP \nResponse \nSS7/CIMD/SPMM \n\n(d) \n(c) \n\nSMS-C \n\nSMS-C \n\nMO: Mobile Originator \n\nCoAP \nResponse \n\nMO \n\nSMS-C: SMS \nService Centre \n\nMT: Mobile \n\nTerminator \n\nSMS-SP: SMS \nService Provider \n\nHLR: Home \nLocation Register \n\nFigure 3.4 (a) A CoAP request or response communication to a machine, IoT device or mobile terminal \n\n(MT), (b) A computer or machine interface using IP communication to a mobile service \nprovider for data interchange with terminal, (c) A machine or IoT device or mobile origin \n(MO) communication of CoAP request or response communication, and (d) An origin \ncommunication using SS7/CIMD/SMPP with  a computer or machine interface using IP \ncommunication \n\nDesign Principles for Web Connectivity \n97 \n\nFigure 3.5 shows data interchanges between CoAP-MQ endpoints, CoAP-MQ clients, \nCoAP-MQ servers through CoAP-MQ broker and its services. \n\nInterfaces \n\nWeb Objects \n\nUDP \nDTLS \n\nWeb Client \n\nCoAP-MQ Client \n\nCoAP-MQ Server \n\nCoAP-MQ \nFunction Set \n\nCoAP-MQ End \n\nPoint \n\nCoAP-MQ \nFunction Set \n\nNetwork and Device Network Domain \nDevice Network Domain \n\nProxy \nService \n\nStore and \n\nForward \n\nService \n\nResources \nDiscovery \n\nService \n\nSubscription \n\nMatch \nService \n\nResources \n\nDirectory \n\nService \n\nRD \nand CoAP-MQ \n\nBroker \n\nObject/Resources \n\nResources Directory \n\nRegistration \nUpdates \n\nRegistration \n\nRegistration \n\nPubSub \n\nPubSub \n\nState Information \n\nState Information \n\nDiscover \n\nPublications \n\nSubscription \n\nInterfaces \n\nCoAP-MQ \nFunction Set \n\nCoAP-MQ \n\nEnd Point \n\nCoAP-MQ \n\nClient \n\nCoAP-MQ \n\nServer \n\nFigure 3.5 Data interchanges between CoAP-MQ endpoints, CoAP-MQ clients, CoAP-MQ servers \n\nthrough CoAP-MQ broker and its services [PubSub means publication to RD and subscription \nto MQ] \n\nFigure 3.5 shows CoAP-MQ server provisioning for the resource-subscription, store \nfrom the publisher. The server also provisions for forwarding to the subscriber and proxy \nservices. The figure also shows that RD services are resource discovery, directory and \nobject registration services. The device objects communicate using the CoAP client and \nserver protocols and CoAP web objects using DTLS as security protocol and UDP for \nCoAP APIs. \n\nMQTT Protocol \n\nMessage Queuing Telemetry Transport (MQTT) is an open-source protocol for machine-to- \nmachine (M2M)/IoT connectivity . Word \u2018telemetry\u2019, in English dictionary, means measuring \nand sending values or messages to far off places by radio or other mechanism. \n\n98 \nInternet of Things: Architecture and Design Principles \n\nIBM first created it and then donated it to M2M \u2018Paho\u2019 project of Eclipse. A version \nis MQTT v3.1.1. MQTT has been accepted (2014) as OASIS (Organization for the \nAdvancement of Structured Information Standards) standard 6 MQTT protocol is used for \nconnectivity in M2M/IoT communication. \n\nA version is MQTT-SN v1.2. Sensor networks and non-TCP/IP networks, such as \nZigBee can use the MQTT-SN. MQTT-SN is also a publish/subscribe messaging protocol. \nIt enables extension of the MQTT protocol for WSNs, the sensor and actuator devices and \ntheir networks. \n\nRecall from Figure 1.3, IBM conceptual framework for the IoT, which showed MQTT \napplications for one of the communication management functions. Figure 3.6 shows \nmessages interchange between M2M/IoT device objects (publisher and subscriber) and \nweb objects (publisher and subscriber) using an MQTT broker. \n\nSSL/TLS \nPublisher \n\nSubscriber \n\nMQTT \nBroker \n\n\u2026\u2026. \n\nSubscription \n\nMatch \nService \n\nTopic \n\nTopic \n\nMessage \nRetention \n\nService \n\nKeep Msg. \n\nAlive \nService \n\nPublisher \n\nSubscriber \n\nPublisher \n\nSubscriber \n\nTCP \n\nSSL/TLS \n\nTCP \n\nIoT/M2M \nMQTT Java, C \n\nor JavaScript \n\nLibrary \nfunctions \n\nMQTT Java, \n\nC or \nJavaScript \n\nLibrary \nFunctions \n\nWeb Objects \nM2M/IoT \n\nObjects \n\nM2M/IoT \nNetwork \n\nStore \n\nand \nForward \n\nService \n\nFigure 3.6 Messages interchange between M2M/IoT device objects (publisher and subscriber) and web \n\nobjects (publisher and subscriber) using an MQTT Broker \n\n6 http://docs.oasis-open.org/mqtt/mqtt/v3.1.1/os/mqtt-v3.1.1-os.doc. \n\nDesign Principles for Web Connectivity \n99 \n\nFigure 3.6 shows MQTT-broker subscription, subscription match, store and forward, \nlast good message retention and keep message alive services. The figure also shows that \ndevice objects use MQTT Java, C or JavaScript library functions. The objects communicate \nusing the connected devices network protocols such as ZigBee. Web objects also use \nMQTT library functions and communicate using IP network and SSL and TLS security \nprotocols for subscribing and publishing web APIs. \n\nMQTT Broker (also referred simply as MQ) does the following: \n\n\u25cf Functions as a server node capable of storing messages from publishers and forwarding \nthem to the subscribing clients. \n\n\u25cf Receives topics from the publishers. Examples of topics are measured information of \nambient light conditions, traffic density, nearby parking space availability and waste \ncontainer status. \n\n\u25cf Performs a store-and-forward function, stores topics from publishers and forwards to \nsubscribers. \n\n\u25cf Receives subscriptions from clients on the topics , matches subscriptions and \npublications in order to route messages to right endpoints. \n\n\u25cf Recovers subscriptions on reconnect after a disconnection, unless the client explicitly \ndisconnected. \n\n\u25cf Acts as a broker between the publisher of the topics and their subscribers. \n\n\u25cf Finds client disconnection until DISCONNET message receives, keeps message alive till \nexplicit disconnection. \n\n\u25cf Retains the last-received message from a publisher for a new connected subscriber on \nthe same topic, when retain field in the header is set. \n\n\u25cf Authentication by Username/Password in connect message and client security is \nthrough SSL/TLS. Security considerations are same as of CoAP, web-linking and CoRE \nresource directory. \n\n\u25cf Support from Intelligent and business analyst server and other servers through a \nMQTT server with a gateway. \n\n3.3.3 \nXMPP (Extensible Messaging and Presence Protocol) \n\nXML \n\nXML is an open-source IETF recommended language. XML is widely used for encoding \nmessages and texts.  A text element in an XML document can correspond to the data, \nmessage, alert, notification object, command, method or  value of an entity. There is a way \nto tag in which text is featured between the tag and its associated end tag. \n\nAn XML tag specifies the type of encoded entity in an element. A tag may also associate \nan attribute(s) which is specified there itself. The interpretation and use of the text within \na tag pair (a tag and its associated end tag) depends on the parser and associate application . \nThe Parser uses XML file as input. The application uses the output from the parser. The \nparser and application can be in Java, C# or any other programming language. Following \nis an example of usage of XML tags and attributes in XML elements in a document. \n\n100 \nInternet of Things: Architecture and Design Principles \n\nExample 3.5 \n\nProblem \nGive the usages of XML tags and attributes in XML messages using an XML document (text file), assuming \nthat the XML messages are for a temperature sensor. Assume that more than one sensor measures the \ntemperature and put time of measurement stamp also. \n\nSolution \n\nAn XML message sent by a temperature sensor is as follows: <SensTemp> 22 degree C </SensTemp>. \n<SensTemp> can associate with the attributes as: \n\n<SensorTemp ID = \u2018250715\u2019 TimeDate = \u201819:28:33 Jul 17 2016\u2019>  22 </SensTemp>. \n\nA Java parser can read the file when it streams and in which the above text message is present. That parser \ncreates a database. The database may be a table with the columns: Sensor ID , Time , Date and Temperature . \nAn associated program ( application ) uses these results. For example, application sends a message for an \nactuator circuit to switch off Air Conditioner, again in XML. The message format from the Application with \nID = 241206 to Air conditioner of ID = 2075 can be: \n\n<ActuatorAirCond ID = \u20182075\u2019 AppId = \u2018241206\u2019  > SwitchOff < /ActuatorAirCond>. \n\nXMPP \n\nXMPP is an XML-based specification for messaging and presence protocols. XMPP is also \nan open-source protocol recommended specification which is accepted by IETF. RFC is \nan international organisation and stands for \u2019Recommended for Comments\u2019. RFC 6120 \ndocument specifies the XMPP for CoRE. Another recommendation, RFC 6121 XMPP \nspecifies the instant messaging (IM) and presence, and RFC 6122 XMPP specifies the \n(message) address format. \n\nMessages notify presence for the IMs to one or many at the same time. It enables chatting \nand Multi-User Chat (MUC) after creation of a chat room, where different users can do \nthe IMs. XMPP enables interoperable communication: for example, Google Talk. XMPP \nenables IMs between many users as it uses presence-notifications and chat features. \n\nChat room is an application, in which all those who have subscribed (meaning persons \nand objects initiating chatting and messaging to one another at the same time) are provided \na room-like view and use the IMs among themselves. \n\nXMPP is extensible\u2014XSF (XMPP standards foundation) develops and publishes the \nxeps (XMPP extension protocols). The xeps enable the addition of features and new \napplications. List of XMPP xeps for web objects is quite long. Examples of xeps are: \n\n\u25cf xep-DataForms Format \n\n\u25cf xep-XHTML-IM \n\n\u25cf xep-Service Discovery \n\n\u25cf xep-MUC \n\n\u25cf xep-Publsih-Subscribe and Personal Eventing Protocol \n\n\u25cf xep- File Transfer \n\n\u25cf xep-Jingle for Voice and video \n\nDesign Principles for Web Connectivity \n101 \n\nXMPP-IoT xeps extend the use of XMPP to IoT and machine-to-machine messaging. 7,8 \n\nList of extensions (xeps) is quite long. Examples of xeps are: \n\n\u25cf xep-0322 efficient XML interchange (EXI) format \n\n\u25cf xep-0323 Internet of Things-Sensor Data (http://xmpp.org/extensions/xep-0323.html) \n\n\u25cf xep-0324 Internet of Things-Provisioning \n\n\u25cf xep-0325 Internet of Things-Control (http://xmpp.org/extensions/xep-0325.html) \n\n\u25cf xep-0326 Internet of Things-Concentrators. \nThe xeps are the base for IEEE/ISO/IEC recommended \u201cSensei/IoT\u201d related standards, \nsensei/IoT ISO/IEC/IEEE P21451-1-4 and other standardizations. \n\nXMPP-IoT enables communication machine to web application and M2M interoperable. \nMany connected-devices-based business applications, processes, smart home, smart city, \nsmart energy saving and smart street lighting and traffic are possible using XMPP, XMPP- \nIoT and other servers communicating with XMPP servers. \n\nFigure 3.7 shows use of the XMPP and XMPP extension protocols for connected devices \nand web objects. The protocols are for messaging, presence notification, response-on- \ndemand and service discovery using XML streams. \n\nFigure 3.7 shows that XMPP-IoT server consists of xeps and services. XMPP services \nare extensible to publisher/subscriber, MUC and other services, devices and connected \ndevices area network which interact with XMPP-IoT services. The XMPP-IoT server, \nthrough a gateway between connected devices and IP networks, communicates with \nXMPP APIs in web objects. \n\nSimple Authentication and Security Layer (SASL) and TLS are security protocols for \nAPIs and web object messages using TCP/IP network. The XML streams in XMPP format \ncommunicate between the devices, devices to web objects and between the web objects. \n\nFeatures of XMPP are: \n\n\u25cf XMPP uses XML. \n\n\u25cf XML elements are sent in the open-ended stream within the tag <stream> and \ncorresponding end tag </stream>. \n\n\u25cf Three basic types of XMPP stanzas (elements) are: \n\n\u274d message \n\n\u274d presence \n\n\u274d iq (information/query, request/response) \n\n\u25cf Extensibility to constrained environment messaging and presence protocols as well as \nIP network messaging. \n\n\u25cf Extensibility of request-response (client-server) architecture to iq (information \nthrough querying), PubSub messaging, Chat room MUC messaging and other \narchitecture (where group of people exchange information when present in a chat \nroom), decentralised XMPP server. \n\n7 https://postscapes.com/internet-of-things-protocols/ \n8 http://www.xmpp.org/extensions.html \n\n102 \nInternet of Things: Architecture and Design Principles \n\nIoT/M2M Client \nand Server Objects \nXML \nStream \n\nXMPP-IoT \n\nServer \n\nDevice 1 \n\nDevice 2 \n\nDevice i \n\nDevice \n(i\u20131) \n\n\u2026\u2026 \n\n\u2026\u2026 \n\nIoT/M2M Publish/ \n\nSubscribe Objects \n\nXML \nStream \n\nxeps for \nIoT/ \nM2M \n\nSubscrip- \ntion \nService \n\nInstant \nMessage \n\nService \n\nPresence \n\nData \nService \n\nDemand \nResponse \n\nService \n\nDiscover \nService \n\nIoT \nor \nM2M \nArea \nNet- \nwork \n\nGateway \n\nIoT \n\nor \nM2M \n\nto IP \nNetwork \n\nWeb Objects \n\nClient \nApplication \n\nXMPP \n\nAPI \n\nXML \nStream \n\nXML \nStream \n\nSASL/TLS \n\nTCP \n\nSASL/TLS \n\nTCP \n\nSMPP \n\nAPI \n\nServer \nApplication \n\nWeb Objects \n\nFigure 3.7 Use of XMPP and XMPP extension protocols for connected devices and web objects for the \n\nmessaging, presence notifications, responses on demand and service discoveries using XML \nstreams \n\n\u25cf XMPP server set by anyone on the following standards recommended and using XSF \nxeps; for example, XMPP-IoT server, XMPP M2M server for messaging between the \nmachines. \n\n\u25cf Authentication by SASL/TLS, and support from intelligent and business analyst \napplications, and processing through XMPP server and gateway for connecting device \nnetwork with IP network. \nXMPP does the following: \n\n\u25cf Binary data is first encoded using base 64 and then transmitted in-band. Therefore, the \nfile first transmits out-of-band between nodes on messages from XMPP server but not \ndirectly like IMs. \n\n\u25cf No end-to-end encryption \n\n\u25cf Higher overhead being text based in place of binary implementations \n\n\u25cf No support for QoS like MQTT does \n\nDesign Principles for Web Connectivity \n103 \n\nReconfirm Your Understanding \n\n\u25cf CoAP-SMS is a protocol when CoAP object uses IP as well as cellular networks and SMSs. \n\n\u25cf SMS transport through a service centre is used instead of UDP + DTLS by a CoAP client or server. A \nCoAP client communicates to a mobile terminal endpoint. \n\n\u25cf Web objects use the Request/Response, Publish/Subscribe, Subscribe/Notify, Push or Pull and \nPolling, Message Queues, Instant Messaging, Presence notification for Multi-User Chat and instant \nmessaging modes for transfer of messages, resources, representations, objects and states.  APIs use \nmessaging protocols, CoAP-SMS, CoAP-MQ, MQTT and XMPP. \n\n\u25cf CoAP-MQ data interchanges between the CoAP-MQ endpoints, CoAP-MQ clients, CoAP-MQ servers \nthrough CoAP-MQ broker and its services. \n\n\u25cf MQTT is a protocol for the constrained environment. MQTT architecture is PubSub messaging in place \nof request-response client-server architecture. Publisher (message sender at the device domain or \nweb object at network and application domain) sends the messages on a topic. Subscriber (message \nreceiver at the device domain or web object at network and application domain) receives the \nmessages on a subscribed topic. \n\n\u25cf XMPP CoRE, instant messaging, presence and address format are IETF recommendations for the XMPP \nmessages server. The server notifies presence for the purpose of IMs (instant messaging) to one or \nmany at the same time. The server enables chatting and multi-user chat (MUC) after creation of a \nchat room, where different users after subscriptions do IMs. \n\nS elf-Assessment E xercise \n\n1. List IETF recommended terms and their usages in CoAP-SMS protocol. \n2. Recapitulate Example 1.1 for an umbrella connected to a web-based weather \n\nservice and to a mobile for messaging. Refer Figure 3.4 and draw data \ninterchange using (a) a CoAP request or response communication to a weather \ndata service and (b) an SMS from umbrella device using CoAP to the mobile \ndevice. \n3. List the functions of resource directory service by RD when using at the \n\nCoAP-MQ protocol. \n4. List comparisons between CoAP-MQ and MQTT features. \n5. Refer Figure 3.5 and draw a diagram for data interchanges for connected \n\ntemperature sensing devices using CoAP-MQ broker. Each published \ntemperature data using Bluetooth Smart Energy to the broker and gateway \npublishes using CoAP-MQ client to CoAP server, which in turn connects \nthrough proxies to a web service. The weather service publishes data for \nsubscribing web clients on the Internet and the web clients connect to \nsubscribing actuators controlling room temperatures through the broker. \n6. What are the functions of MQTT broker? \n7. Consider Figure 3.6 and draw a diagram for data interchanges for connected \n\nRFIDs using MQTT broker. Each device sends the ID publishes at two-hour \n\n\u2605 \n\u2605\u2605 \n\n\u2605 \n\n\u2605\u2605 \n\u2605\u2605\u2605 \n\n\u2605 \n\u2605\u2605 \n\n\n![Image](/src/assets/generated_images/iot2_p130_i0.png)\n104 \nInternet of Things: Architecture and Design Principles \n\ninterval using RF links to the broker and gateway messages using MQTT Java, \nC or JavaScript library functions to inventory monitoring web application. \n8. List five XMPP-IoT xeps which extend the use of XMPP to IoT and M2M \n\nmessaging. \n9. Refer Example 2.3 and Figure 3.7 and draw a data flow diagram showing \n\nthe use of XMPP protocol for connected ATMs and bank server web objects \nfor the messaging, presence notifications, responses on demand and service \ndiscoveries using XML streams. \n10. Write code for XML message from two streetlights connected to a streetlight \n\ngroup. Assume sensor names are StreetLightN_I and StreetLightN_J. Assume \nsensor N_I output is 1 and Street Traffic density output of sensor N_J output \nis a 24 per 10 m. \n\n\u2605\u2605\u2605 \n\n\u2605\u2605 \n\n3.4  WEB CONNECTIVITY FOR CONNECTED- \n\nDEVICES NETWORK USING GATEWAY, \nSOAP, REST, HTTP RESTFUL AND \nWEBSOCKETS \n\nThe following subsections describe the uses of gateway, \nSOAP, REST, RESTful HTTP and WebSockets for connecting \nweb objects. \n\n3.4.1 \nCommunication Gateway \n\nFigure 1.5 showed the gateway in the Oracle IoT architecture. The figure also showed \ngateway provisions for applications and IoT communication frameworks, management \nand proxy functions. \n\nCommunication gateway connects two application layers, one \nat sender and the other at receiver. The gateway also enables use \nof two different protocols, one at sender and the other at receiver \nends. The gateway facilitates the communication between web \nserver using the TCP/IP protocol conversion gateway and IoT \ndevices. It also facilitates communication between the devices \nusing CoAP client and server using HTTP. \n\nThe gateway provisions for one or more of the following functions: \n\n\u25cf Connects the sender and receiver ends using two different protocols. For example, IoT \ndevices network maybe ZigBee network for connecting the devices. The network then \nconnects to the web server through a gateway. The server posts and gets the data using \n\nOutline the \n\nusage of \ncommunication gateway \n\nprotocols, SOAP, \nREST, RESTful HTTP \n\nand WebSocket by \nconnected devices and \n\nweb \n\nLO 3.3 \n\nCommunication \ngateway can connect \na device using CoAP \nclient and server using \n\nHTTP facilitates the \n\ncommunication \n\nDesign Principles for Web Connectivity \n105 \n\nHTTP. A gateway facilitates the communication between IoT devices and web server. \nFor example, (i) ZigBee to SOAP and IP or (ii) CoAP protocol conversion gateway for \nRESTful HTTP (Section 3.4.4). \n\n\u25cf Functions as proxy between the system and server. \n\n3.4.2 \nHTTP Request and Response Method \n\nAn application uses a protocol. The application layer in TCP/IP suite of protocols for \nInternet uses HTTP, FTP, SMTP, POP3, TELNET and a number of other protocols. HTTP \nis most widely used application layer protocol for communication over TCP/IP. An HTTP \nclient connects to an HTTP server using TCP and then the client sends a resource after \nestablishing an HTTP connection. \n\nExample 3.6 \n\nProblem \nGive the request and response communication codes when (a) HTTP request message communicates to a \nserver and (b) message communicates a response to a client. \n\nSolution \n\n(a) Following code sends the request: \n\nPOST /item HTTP/1.1 \n\n\nHost: ii.jj.kk.mm \n\n\nContent-Type: text/plain \n\n\nContent-Length: 200 \n(b) The server first processes the request and then sends an HTTP response back to the client. The \n\nresponse also contains the status code and content information for that.: \n\n\n200 OK \n\n\nContent-Type: text/plain \n\n\nContent-Length: 200 \n\n200 is standard success code in an HTTP connection. 400 is standard failure code. The status returns \n\nas follows in that case. \n\n\n400 Bad Request \n\nContent-Length: 02 \n\nData Exchanges Between HTTP Web-Objects \n\nAn HTTP connection enables a one-way communication at an instance from client API to \na server or from server to the API. \n\nHTTP polling is a method for receiving new messages or updates from an HTTP server. \nPolling means finding whether new messages or updates are available and receiving them \nin case they are. \n\n106 \nInternet of Things: Architecture and Design Principles \n\nAn HTTP transfer is stateless which means each data transfer is an independent request. \nTherefore, header overhead information and meta-data of previous state need to be present \nwith each HTTP request. Metadata is data which describes the data for interpretation in \nfuture. Therefore, each data interchange needs large headers over 100s of byte, and thus \ngreater latency in request-response exchanges. \n\nWays of transferring both ways at the same instant are: \n\n\u25cf Multiple TCP connection \n\n\u25cf HTTP requests at short, regular intervals so that responses are nearly in real time \n\n\u25cf Polling at successive intervals \n\n\u25cf HTTP long polling means API sends a request to the server, which keeps the request \nopen for a set period \n\n\u25cf Stream hidden in iFrame \nPolling methods have high latencies and header sizes of 100s of bytes. An alternative to \nthis is using Java Applets, Silverlight or Flash plugins. \n\n3.4.3 SOAP \n\nApplications need to exchange objects on the Internet using protocols such as HTTP. \nApplications may be using different languages and platforms. Simple Object Access \n(SOAP) is a W3C approved open-source protocol. 9 \n\nSOAP is a protocol for exchange of objects between applications using XML. It is also a \nprotocol for access to a web service. SOAP specifies the formats and way of communicating \nthe messages. Its usage is independent of the application language and platform \n(OS and hardware). It is extensible and is also used for APIs for the web services and \nService-Oriented Architecture (SOA). \n\nSOAP enables development of applications and APIs. SOAP functions connect the \nGUI applications to web servers using the standards of the Internet\u2014HTTP and XML. \nMicrosoft\u2019s .NET architecture supports SOAP for Internet application development. \n\nW3C 10 recommended SOAP v1.2 second edition specifications\u2014Part 0 is a primer, part \n1 is a messaging framework and Part 2 is adjuncts. SOAP v1.2 specifications provision \nfor assertions and test collection, XML-binary Optimized Packaging, SOAP message \ntransmission optimisation mechanism and resource representation SOAP header block. \n\nSOAP uses a body element after the specifications in an envelope. The body element \ncontains the SOAP message intended for ultimate endpoint of the message. \n\nA SOAP request could be an HTTP POST or an HTTP GET \nrequest. The HTTP POST request specifies at least two HTTP \nheaders: content type and content length. A SOAP method uses \nHTTP request/response after the HTTP binding with the SOAP. \n\n9 http://www.w3schools.com/soap/default.asp \n10 https://www.w3.org/TR/soap/ \n\nWays of communication \n\nrequest using SOAP \nand obtaining SOAP \n\nresponse \n\nDesign Principles for Web Connectivity \n107 \n\nThe request and response complies with the SOAP encoding rules. Let\u2019s take an example \nto explain the structure and usage of SOAP. \n\nExample 3.7 describes the coding for SOAP request and response. \n\nExample 3.7 \n\nProblem \nRecall Example 1.1 and assume that a gateway sends requests for the weather service response and receives \nthe weather message from a weatherMsgService daily. (a) How does a SOAP request or response communicate \nbetween two applications: one at gateway weatherMsgG and the other at weatherMsgService using two web \nobjects www.weatherMsgG.com and www.weatherMsgService.com? (b) How is a SOAP message structured? \n(c)  Write the SOAP message for request from End1 to End2. (d) What can be the SOAP message formats for \nthe XML stream as response using HTPP 1.1 binding?  (e) How will the error communicate? \n\nSolution \n\n(a) Figure 3.8 (a) shows a SOAP request or response communication between weatherMsgG and \n\nweatherMsgService. SOAP sends request from End1 (URL www.weatherMsgG/ weatherMsgRequest to \nEnd2 (URL www. weatherMsgService.com/ weatherMsgID250715) for the weatherMsgID250715. The \nweatherMsgID250715 value will be received at End1. \n(b) Figure 3.8 (b) shows the SOAP message structure. \n\n(c) Assume that HTTP POST method is use to post the SOAP request message. Assume that Get Temperature \n\nResponse is a method for retrieving the weather message of the weatherMsgID250715 from resources \nat End2. SOAP sends request for the weather message. The weatherMsgID250715 value will be received \nat End1 from End2. Figure 3.8 (c) and (d) show SOAP message content and elements. \n\n(d) The response will be from End2 http://www.weatherService.com/weatherMsgResponse to the End1. \n\nEnd2 response for weatherMsgID250715 will have first line for status of message receipt. Next lines will \nbe HTTP binding and then the response message. Fig. 3.8(e) shows SOAP response from weatherMsgG \nto weatherMsgService using the Internet and HTTP binding \n\n(e) An error message from a SOAP message is carried inside a Fault element. The element has child \n\nelements as follows: <faultcode>, <faultstring>, <faultactor> and <detail>.  Error can be version \nmismatch or MustUnderstand or client or server. \n\n3.4.4 \nREST and RESTful HTTP Web Applications \n\nW3C Technical Architecture Group (TAG) developed the \nRepresentational State Transfer (REST) architectural style. 11 The \ngroup worked in parallel with HTTP 1.1. REST is a coordinated set of constraints which \nare used during design of software components in a distributed hypermedia, and the \ndesign depends on the characteristics of stateless, client-server, cacheable communication \nusing a protocol. World Wide Web uses REST practices and constraints. REST is a simpler \nalternative for SOAP and Web Services Description Language (WSDL). REST style web \nresources and Resource-Oriented Architecture (ROA) have increasingly replacing SOAP. \n\n11 https://www.w3.org/2001/sw/wiki/REST \n\nRESTful APIs \n\n108 \nInternet of Things: Architecture and Design Principles \n\nSOAP \nRequest \n\nSOAP \nResponse \n\nwww.weatherMsoG. \n\ncom/ \nweatherMsgRequest \n\nwww.weatherService. \n\ncom/ \nweatherMsgResponse \n\n(a) \n(d) \n\n<soap:Body> \n\n<msg: GetweatherMsgResponse \nxmlns: msg=\u201chttp://www. \nweatherMsgG.com/ \nweatherMsgRequest\u201d> \n\n<msg:MsgID> \nweatherMsgID250715 \n</msg:MsgID> \n\n</soap:Body> \n\n<?xml version=\u201c1.0\u201d?> \n<soap:Envelope \n\nxmlns:soap=\u201chttp:www.w3.org/ \n2001/12/soap-envelope\u201d \nsoap:encodingStyle=\u201chttp://www. \nw3.org/2001/12/soap-encoding\u201d> \n\n<soap:Header> \n\u2026 \n\n\u2026 \n\n</soap:Header> \n\n<soap:Body> \n\n<soap:Fault> \n\u2026 \n</soap:Fault> \n</soap:Body> \n\n</soap:Envelope> \n\n(b) \n\nPOST / \nweatherServiceRequest \nHTTP/1.1 \nHost:www. \nweatherMsgG.com \nContent-Type: \nEnd1/soap+xml; charse t=utf-8 \n\nContent-Length: nnn \n<?xml version=\u201c1.0\u201d?> \n<soap:Envelope \nxmlns:soap=\u201chttp://www.w3. \norg/2001/12/soap-envelope\u201d \nsoap:encodingStyle=\u201chttp://w \nww.w3org/2001/12/soap- \nencoding\u201d> \n\n(c-1) \n(e) \n\nHTTP/1.1 200 OK Content-Type: \nEnd2/soap+xml;charset=utf-8 \nContent-Length: nnn \n<?xml version=\u201c1.0\u201d?> \n<soap:Envelope \nxmlns:soap=\u201chttp://www.w3.org/2001/1 \n2/soap-envelope\u201d \nsoap:encodingStyle=\u201chttp://www.w3.org \n\n/2001/12/soap-encoding\u201d? \n\n<soap:Body xmlns:msg=\u201chttp:/www. \nweatherService.com/ \nweatherMsgResponse\u201d? \n\n<msg: GetweatherMsgID250715 ? \n\n<msg: Rains>\u201dExpectedon \n250715\u201d</msg:Rains> \n\n</msg:GetweatherMsgResponse> \n</soap:Body> \n</soap:Envelope> \n\nFigure 3.8 (a) A SOAP request or response communication between gateway weatherMsgG and \n\nweather service weatherMsgService, (b) SOAP message structure, (c) SOAP POST from \nweatherMsgG, (d) Request Get weatherMsgG, and (e) SOAP response weatherMsgID250715 \nat weatherMsgService to weatherMsgG using Internet and HTTP binding \n\nThe architectural properties of REST are realised by applying \nspecific interaction constraints to data elements, components, \nconnectors and objects. An architectural property of REST is \nseparation of concern which means data storage at server is not \na concern for the client, and client components can port on other \nobjects. \n\nAlso, user interface and user state are of no concern to the server. REST\u2019s client-server \nseparation of concerns simplifies the component implementation, increases the scalability \n\nREST is a simpler \nalternative for SOAP \n\nand Web Services \nDescription Language \n\n(WSDL) \n\nDesign Principles for Web Connectivity \n109 \n\nof pure server components, reduces the complexity of connector semantics and improves \nthe effectiveness of performance tuning. \n\nThe resources themselves are conceptually separate from the representations that are \nreturned to the client. For example, the server may send data HTML, XML, TLV or JSON \nfrom its database which can have other distinct internal representation at a connected \ndatabase server. \n\nREST software architecture style provisions for the use of specific practices, such as \nclient-server mode of communication and layered system architectural approach. \n\nClient-server interactions have characteristics of performance and creation of scalable web \nobjects and services. Scalability means ability to support greater number of interactions \namong components and greater number of components. \n\nLayered system refers to  a client which can connect through an intermediate layer \n(proxy, firewall, gateway, proxy or intermediary server). REST enables intermediate layer \nprocessing by constraining the messages such that the interactions at each layer are self- \ndescriptive. A client may not ordinarily be made aware whether it is connected directly \nto an end-server. Intermediate layers may render assistance in transcoding and enabling \nusages of different protocols at two ends. Use of the intermediate system improves \nperformance when using bigger scales and shared caches. Shared caches means caches \nshared between two layers; for example intermediate layer and server or proxy and server. \n\nRepresentation of each application state contains links that may be used for a next-time \ninteraction when the client selects those links and initiates a new state transition. \n\nRESTful \n\nWhen all interactions used in the applications conform fully to the REST constraints then \nthese are called RESTful. RESTful APIs comply with these constraints and thus conform \nto the REST architectural style. Web services with RESTful APIs adhere to the REST \narchitectural constraints. \n\nREST architectural style can be used for HTTP access by GET, POST, PUT and DELETE \nmethods for resources and building web services. \n\nRESTful HTTP APIs \n\nStandard HTTP methods are GET, PUT, POST and DELETE. HTTP based RESTful APIs \nuse the following: \n\n\u25cf URIs/URLs, such as http://weatherMsgService.com/weatherMsg/ and hypertext links \nto reference state and reference related resources, and JSON, TLV or an Internet media \ntype (MIME type) hypertext links \n\n\u25cf REST-based web objects communicate typically, but not always, over the HTTP. The \nWorld Wide Web itself represents the largest implementation of a system conforming \nto the REST architectural style. RESTful HTTP system feature is that communication is \nover the HTTP and use verbs (commands) same as in HTTP, namely GET, POST, PUT \nand DELETE. \n\n110 \nInternet of Things: Architecture and Design Principles \n\nRESTful HTTP Verbs \n\nREST interfaces usually involve resource repositories with identifiers. For example, / \ndeviceNetwork/device or /TemperatureApp, which can be operated upon using standard \nverbs as follows: \n\n\u25cf GET command is to get a list of the URIs for resource repository of the resources and \nperhaps other details of the members in the repository . GET retrieves a representation \nof the resource item (means addressed member) of the repository . Representation is \nexpressed in an appropriate Internet media type. \n\n\u25cf POST command creates a new entry in the resource repository for the resources. The new \nentry\u2019s URI is assigned automatically and is usually returned by the operation. An \noption which is not generally used considers the resource item as a repository on its \nown right and create a new entry in it (not generally used). \n\n\u25cf PUT command which replaces the entire resource repository with another resource \nrepository or replaces the resource item of the repository (or if it does not exist, then create \nit). \n\n\u25cf DELETE command from client retrieves web objects and sends data to remote servers. \n\n3.4.5 \nWebSocket \n\nRFC 6455 describes the specifications of the web protocol 12 . \nWebSocket is an IETF accepted protocol. WebSocket API (WSAPI) \nW3C standard is Web Interface Definition Language (Web IDL) 13 . \n\nInstant messaging and many applications need bidirectional \ndata exchanges over the same connection. WebSocket enables \nbidirectional communication over a single TCP connection. \n\nFigure 3.9 (a) shows Opcode and other fields at a WebSocket Frame. Figure 3.9 (b) shows \nWebSocket API provisions for events , attributes and functions . Event means occurrence of \nnew condition, occurrence of which is listened by an event-listener function, and as soon \nas listening takes place, an event handling function executes. The handling function is also \ncallback action . Figure 3.9 (c) shows data bidirectional communication using WebSocket \nAPIs between the web objects and also the browsers and servers. \n\nThe WebSocket-protocol-based design usage now supersedes the existing bidirectional \ncommunication technologies that use HTTP at application layer. WSAPI  attributes are \nurl , protocol , readystate , buffered amount and are extendable. The API functions are send \n(frame) and close  (socket). A frame contains header plus data. WebSocket frame contains \n2 B header extended to 0, 2 or 4 B plus data bytes. Client side adds 4 B mark; for example, \nfor identifying a frame. The WebSockets enable easier usage of existing infrastructure, \nauthentication, filtering and proxies. Number of popular browsers support the protocol. \nHTTP case polling at periodic intervals are not required due to no-wait feature of \nWebSocket. \n\n12 www:/tools.ietf.org/html/rfc6455 \n13 http://www.w3.org/TR/WebIDL/ \n\nBidirectional \ncommunication request \n\nusing WebSocket at \n\nclient and obtaining \n\nresponse from \nWebSocket at server \n\nDesign Principles for Web Connectivity \n111 \n\n2-6 Byte \n(Typical) \n2-6 Byte \n(Typical) \n\n2-6 Byte \n(Typical) \n2-6 Byte \n(Typical) \n\n(a) \n(b) \n(c) \n\nServer \nApplication \n\nWS \nAPI \n\nTCP \n\nSASL/TLS \n\nClient \nApplication \n\nWS \nAPI \n\nWeb Objects using WebSockets \nWebSocket \n\nAPI \n\nEvents \nonopen, \nonmessage \nand onerror \n\nAttributes \n\nurl, \nprotocol , \nreadystate, \nbufferd Amo \nunt and \nextensions \n\nFunctions \n\nSend and \n\nClose \n\nopcode and \n7-bit length \n\n2Byte \n\nExtended \n\nLength \n4/2/0 Byte \n\nMark \n(at Client) \n\n4 Byte \n\nData \nn Byte \n\n2-6 Byte \n(Typical) \n\nWebSocket Frame \n\nFigure 3.9 (a) Opcode and other fields at a WebSocket frame, (b) WebSocket API events, attributes and \n\nfunctions, and (c) Data bidirectional communication using WebSocket between web objects \n\nFeatures of WebSocket are: \n\n\u25cf Small header size (2B extended to 6 byte and above compared to 100s B and above for \nan HTTP header which results in high latency \n\n\u25cf No new connection which will need a new header and thus no new latency period \n\n\u25cf WSAPIs, because of very low connection latencies, facilitate live content and the \ncreation of real-time games. \n\n\u25cf Protocol is an independent TCP-based protocol. Its only relationship to HTTP is that \nits handshake is interpreted by HTTP servers as an upgrade request. \n\n\u25cf Protocol uses default port 80 for regular WebSocket connections using ws:// and port \n443 when using wss:// for WebSocket connections tunnelled over Transport Layer \nSecurity (TLS). \n\n\u25cf Protocol is intended to be compatible with HTTP-based server-side software and \nintermediaries, so that a single port can be used by both HTTP clients talking to that \nserver and WebSocket clients talking to that server. Therefore, WebSocket client\u2019s \nhandshake is an HTTP upgrade request. Response from the server is also as an HTTP \nupgrade (Example 3.7). \n\n\u25cf Protocol specifies six frame types and leaves ten reserved for future use (version 13). \n\n\u25cf Clients and servers exchange the \u2018messages\u2019 after a successful handshake. A WebSocket \nmessage does not necessarily correspond to a particular network layer framing. A \nframe has an associated type.  Each frame belonging to the same message contains the \n\n112 \nInternet of Things: Architecture and Design Principles \n\nsame type of data.  Six types are (i) textual data (UTF-8) and (ii) binary data (whose \ninterpretation is left up to the application). \n\n\u25cf Extensibility of request-response (client-server) architecture to iq (information through \nand querying) chat and super chat extensibility to cloud services. \n\n\u25cf Support from intelligent and business analyst applications and processing through \nweb server or XMPP server and gateway for connecting the device network with the \nIP network. \n\nReconfirm Your Understanding \n\n\u25cf A communication gateway connects the sender and receiver ends using two different protocols. The \ngateway can function as a proxy between two ends, such as HTTP-CoAP proxy. \n\n\u25cf Web objects communicate using HTTP methods, such as POST, GET, PUT, DELETE, SOAP and WebSockets. \n\n\u25cf REST is a software architecture specifying practices and constraints which are used during design \nof software components in a distributed hypermedia. Designing based on REST depends on the \ncharacteristics of stateless, client-server, cacheable communication using a protocol. \n\n\u25cf RESTful means components designed with constraints specified in REST. For example, separation of \nconcerns, use of layered system, defining cache ability or not between client, server and intermediate. \n\n\u25cf Web objects communicate using WebSockets. Instant messaging and many applications need the \nbidirectional, very low latency, real time data exchanges over the same (without initiating new) \nconnection. WebSocket enables bidirectional communication over a single TCP connection. \n\nS elf-Assessment E xercise \n\n1. What are the functions of GET, POST, PUT and DELETE? \n2. How will a weather service send the weather data probability of rain at a \n\nlocation using HTTP? Using HTTP post message, assume host is iii.jjj.kkk. \ncom/, content type is text and length is 10 B. What can be the possible responses \nfrom the other end? \n3. How is a SOAP message structured? \n4. Assume that an ATM gateway sends requests for the banking service response \n\nand receives the account information from a BankMsgService. How does a \nSOAP request or response communicate between two applications, viz. one \nat Gateway ATM_G and other at BankMsgService using two web objects, viz. \none at www.ATMG.com and other www.BankService.com? \n\n\u2605 \n\u2605\u2605 \n\n\u2605 \n\u2605\u2605\u2605 \n\nDesign Principles for Web Connectivity \n113 \n\n5. List the characteristics in interfaces designed using REST. \n6. List WebSocket API events, attributes and functions, and the usage of each. \n7. Give five examples when you need bidirectional data exchanges over the \n\nsame TCP connection? \n8. List the features of a WebSocket. How do these differ from those of HTTP \n\nRequest/Response and HTTP polling? \n\n\u2605 \n\u2605\u2605 \n\n\u2605 \n\n\u2605\u2605\u2605 \n\nKey Concepts \n\n\u25cf Client \n\n\u25cf CoAP \n\n\u25cf CoAP-MQ \n\n\u25cf CoAP-SMS \n\n\u25cf Communication gateway \n\n\u25cf Content \n\n\u25cf CoRE \n\n\u25cf DTLS \n\n\u25cf Header \n\n\u25cf HTTP \n\n\u25cf Hypertext \n\n\u25cf Instant messaging \n\n\u25cf Local area devices network \n\n\u25cf LWM2M protocol \n\n\u25cf Message broker \n\n\u25cf Message queue \n\n\u25cf MQTT \n\n\u25cf Multi user chat room \n\n\u25cf Object \n\n\u25cf Proxy \n\n\u25cf Publish/subscribe \n\n\u25cf Push/pull \n\n\u25cf Request/response \n\n\u25cf REST \n\n\u25cf RESTful HTTP \n\n\u25cf Resource \n\n\u25cf Resource directory \n\n\u25cf Resource discovery \n\n\u25cf Resource repository \n\n\u25cf Registration \n\n\u25cf Representation \n\n\u25cf ROLL \n\n\u25cf Server \n\n\u25cf SMS \n\n\u25cf SOAP \n\n\u25cf State \n\n\u25cf Stateless \n\n\u25cf Subscribe/notify \n\n\u25cf Subscription \n\n\u25cf Topic \n\n\u25cf TLS \n\n\u25cf UDP \n\n\u25cf URI/URL \n\n\u25cf WebSocket \n\n\u25cf XML \n\n\u25cf XMPP \n\nLearning Outcomes \n\nLO 3.1 \n\n\u25cf Devices generally have a constraint that they sleep most of the time in low power environment \nand wake when required (client initiates). Devices may have constraints that their connectivity \nbreaks for long periods, has limited up intervals in lossy environment and limited data in size. \n\n\u25cf IoT/M2M devices connect using the CoAP and LWM2M protocols in the constrained RESTful \nenvironment (CoRE) and the data routes over a low power lossy network (ROLL). Client/ \nserver communication uses UDP and DTLS layers. \n\n\u25cf CoRE objects use standard constrained environment protocols for sending a request or \nresponse. The CoAP-client and CoAP-server communication takes place over the network and \ntransport layers to the other-end CoAP client and server. An HTTP-CoAP proxy connects an \n\n114 \nInternet of Things: Architecture and Design Principles \n\nHTTP client with the CoAP object.  A CoAP-HTTP proxy connects a CoAP client with an HTTP \nobject. A CoAP Client/server use the URIs coap://\u2026 HTTP Client/server use the URLs http:// \n\n\u25cf An LWM2M client has object instances as per the OMA standard. An LWM2M client\u2013server \ninteraction takes place over the access and CoRE networks. \n\nLO 3.2 \n\n\u25cf IoT/M2M objects and applications use the Request/Response, Publish/Subscribe, Subscribe/ \nNotify, Push or Pull, Polling, Message Queues, Instant Messaging, Presence notification \nfor Multi-User Chat and instant messaging methods for transfer of messages, resources, \nrepresentations, objects and states. \n\n\u25cf The APIs for messaging use CoAP-SMS, CoAP-MQ, MQTT and XMPP as the messaging \nprotocols in constrained environment and ROLL network. \n\n\u25cf CoAP-SMS is a protocol when CoAP object uses IP as well as cellular networks and an SMS \n(Short Message Service). \n\n\u25cf A CoAP client communicates to a mobile-terminal end-point (MT). \n\n\u25cf MQTT is a protocol for the constrained environment PubSub messaging. A Subscriber receives \nthe messages on a subscribed topic. \n\n\u25cf XMPP CoRE, Presence and Address format are IETF recommendations for the XMPP Messages \nserver. The server notify presence to the subscribers/registered clients (users) for the purpose \nof IMs (instant messaging) to one or many users at the same time. The server enables Instant \nMessaging (IM), chatting and multi-user chat (MUC) after the creation of a chat room, where \ndifferent users after subscriptions do IMs. \n\nLO 3.3 \n\n\u25cf APIs in connected-devices network communicate with the web using the communication \ngateway, SOAP, REST, RESTful HTTP and Web Sockets. \n\n\u25cf A communication gateway connects the sender and receiver ends and can also function in \nproxy between the two ends, such as HTTP-CoAP proxy. \n\n\u25cf Web objects communicate using HTTP methods such as POST, GET, PUT, DELETE, SOAP, and \nWebSockets are used for web communication. \n\n\u25cf RESTful components provide simplicity and uniformity. The features are separation of \nconcerns, use of layered systems, defining cache ability or not between client, server and an \nintermediate such as firewall or proxy. \n\n\u25cf An HTTP connection enables one-way communication at an instance from client the API to a \nserver or from the server to the API. HTTP transfer is stateless. A client polls the resources at \nthe server and finds the changes in their states. When a state exhibits a change then the client \nretrieves that resource. \n\n\u25cf SOAP is protocol for exchange of objects between applications using XML SOAP body elements. \nSpecifications are in an envelope. \n\n\u25cf WebSockets are used for bidirectional communication and instant messaging and chatting \nover a single TCP connection. WebSockets use the URIs ws://\u2026 and use the URIs wss://\u2026 \nwhen using the TLS. \n\nDesign Principles for Web Connectivity \n115 \n\nExercises \n\nObjective Questions \n\nSelect one correct option out of the four in each question. \n\n1. CoRE environment constraints are: (i) data is limited in size around 1000 B, \n\n(ii) web clients and web servers use HTTP (Hyper Text Transfer Protocol), TCP \n(Transmission Control Protocol) and IP (Internet Protocol), (iii) data routes as in an \nROLL network, (iv) devices sleep most of the time, (v) wake when required (client \ninitiates), (vi) connectivity for long periods, (vii) can have long up intervals. \n(a) (i) and (ii) true \n(b) All true except (vii) \n\n(c) (i)  to (iv) true \n(d) (iii) true \n2. CoAP features are: \n\n(a) W3C defined CoAP web-objects \n(b) A specialised web transfer protocol used for CoRE using ROLL network. \n\n(c) Use of object model for resources and each object can have single instance. \n(d) Object or resource use CoAP-TLS (security binding with RSA and Certificate), \n\nand TCP protocols for sending a request or response. \n3. LWM2M specifications and features are as follows: (i) An object or resource use \n\nCoAP, DTLS, TLS, TCP and UDP or SMS protocols for sending a request or response, \n(ii) use of plain text for a resource or use of JSON (Java Script Object Notation) during \na single data transfer  or binary TLV format data transfer for a package for a batch of \nresource-representations in a single data transfer, (iii) objects or its resource access \nusing URLs or file names, (iv) use of object model for resources and each object can \nhave single instance, (v) LWM2M client-server interactions are over the access and \nCoRE networks which generally use CoAP over ROLL, and (vi ) M2M management \nfunctions can be MSBF (M2M Service Bootstrap Function) for credentials of the \ndevices and gateway, and MAS (M2M Authentication Server) for security, root key \ndata store and device and data authentication. \n(a) (i), (iii), (iv) not true \n(b) All true \n\n(c) Only (v) and (vi) true \n(d) All true except (ii) \n4. CoAP-SMS protocol specifies as follows: \n\n(i) Computer or machine interface using IP receiving request or sending response as \n\nCoAP data to a mobile service provider using SMPP for data interchange. \n(ii) The SMS-C communicates that to MO using SS7. SMS-SP receives request or \n\nsends response to machine or IoT device or mobile origin. \n(iii) Computer or machine interface using IP receiving request or sending response as \n\nHTTP request to a mobile service provider using CIMD for data interchange. \n\n\u2605 \n\n\u2605 \n\n\u2605\u2605 \n\n\u2605\u2605 \n\n116 \nInternet of Things: Architecture and Design Principles \n\n(iv) The SMS-C communicates that to Mo using CIMP or SMPP. SMS-SP receives \n\nrequest or sends response to machine or IoT device or mobile origin. \n(a) (i) not true \n(b) (ii) not true \n\n(c) (iii) not true \n(d) All true \n5. CoAP-MQ Broker (MQ) does the following: (i) functions as a server node capable of \n\nstoring messages to and from other nodes, (ii) performs a store, compact, re-format \nand forward function between web clients and the CoAP-MQ capable endpoints, \n(iii) matches subscriptions and publications in order to route messages to right \nendpoints, (iv) does not send state of an endpoint when endpoint or a web client \nsubscribes to the state of the endpoint, (v) enables the web client publishing of \nupdates to the endpoint state through the MQ, (vi) returns the last published value \nto web clients or other endpoints on behalf of endpoints that are sleeping, and \n(vii) acts as a firewall. \n(a) (i) to (v) true \n(b) (ii), (iv) and (vii) not true \n\n(c) All true \n(d) Only (vii) not true \n6. MQTT features are as follows: (i) M2Mqtt library set of functions for coding in \n\nvisual C++ need just 100 kB and in Java just 30 kB, (ii) permits maximum number of \nexchanges, (iii) broker-based subscribe/notify messaging protocol, (iv) don\u2019t notify \non an abnormal disconnection of a client, (v) does not have specifications for the \nfinal action to be taken on failure to send messages, (vi) UDP connectivity for the \nbasic network, (vii) synchronous communication for real-time messaging at regular \nintervals. \n(a) All true \n(b) All true except (iv) and  (v) \n\n(c) None true \n(d) (i) and (vii) not true \n7. XMPP-IoT server: (i) consists of xeps and services, (ii) extensible to publisher- \n\nsubscriber, (iii) does not support multi-user chat, (iii) supports devices and connected \ndevices area network, (iv) support through a gateway between connected devices \nand IP networks communicates with XMPP APIs in web objects, (v) support SASL \nand TLS security protocols for the APIs and web object messages using TCP, (vi) \nHTML request/response, (vii) XML streams in XMPP format communicates. \n(a) All are true \n(b) (iii) and (vi) not true \n\n(c) (iii) and (v) not true \n(d) (iii) not true \n8. Gateway does one or more actions as followings: (i) CoAP protocol conversion for \n\nRESTful HTTP client, (ii) HTTP-CoAP proxy, (iii) provisions RESTful interfaces \nbetween client and server, (iv) connectivity between ZigBee devices and IP \n\n\u2605\u2605 \n\n\u2605\u2605 \n\n\u2605\u2605 \n\n\u2605\u2605 \n\nDesign Principles for Web Connectivity \n117 \n\nnetwork, (v) forwarding of HTTP requests/responses, (vi) functions as firewall, and \n(vii) connects WebSockets. \n(a) (i) to (v) true \n(b) (ii) and  (vi) not true \n\n(c) (iii), (v) to (vii) not true \n(d) (i) to (v) and (vii) true \n9. (i) SOAP message structure has the following tags: envelope, encoding style, header, \n\nbody and fault (ii) dot net support SOAP for internet application development SOAP, \n(iii) object exchange could be through HTTP request/response when HTTP binding \nspecified, and (iv) SOAP support the REST-style web resources. \n(a) All except (iv) true \n(b) Encoding style and fault tags not present \n\n(c) (ii) not true \n(d) (iii) not true \n10. Simplicity of REST interfaces is because of: (i) modifiability of components, \n\n(ii) visibility of communication between components by service agents, (iii) portability \nof components by moving the objects, (iv) reliability, (v) scalability, and (vi) separation \nof concerns between interacting components. \n(a) Only (v) true \n(b) All except (iii) true \n\n(c) All except (i) and (ii) true \n(d) All except (vi) true \n11. HTTP objects can transfer both ways at the same instant using (i) polling, \n\n(ii) Multiple TCP connection, (iii) HTTP requests at short regular intervals so that \nresponses are nearly in real time, (iv) polling at successive intervals, (v) HTTP long \npolling means API sends a request to the server, server keeps the request open for a \nset period, and (vi) stream hidden in iframe. \n(a) All except (i) true \n(b) All except (i) and (iv) true \n\n(c) cannot transfer simultaneously \n(d) All except (i) and (vi),  and (vi) true \n12. WebSocket can include at a higher sublayer, the: (i) XMPP web object APIs, (ii) XMPP \n\nserver and gateway for connecting device network with IP network, (iii) can extend \nmessaging and presence protocol, (iv) can include JMS (Java Message Service) for \nmessaging and PubSub messaging, (v) FTP (File Transfer Protocol) for file transfer, \n(vi) other protocols supported at the client and server, (vii) extensibility of request- \nresponse (client-server) architecture to iq (Information through querying), (viii) chat, \n(ix) super chat, (x) extensibility to cloud services, (xi) support from intelligent and \nbusiness analyst applications, and (xii) support from business processing \n(a) All true \n(b) All except (v), (vi) and (x) true \n\n(c) All except (x) to (xii) true \n(d) All except (i), (ii), (x) to (xii)  true \n\n\u2605\u2605 \n\n\u2605 \n\n\u2605\u2605 \n\n\u2605\u2605\u2605 \n\n118 \nInternet of Things: Architecture and Design Principles \n\nShort-Answer Questions \n\n1. What does constrained environment mean for IoT/M2M? \n[LO 3.1] \n2. What are the features of REST architectural style? \n[LO 3.1] \n3. How will a CoAP client send a request to an HTTP server using intermediate \n\ncomponents? \n[LO 3.1] \n4. What are the additional features in LWM2M over CoAP? \n[LO 3.1] \n5. Show diagrammatically how a device sends an SMS to a mobile terminal and how a \n\nmobile origin sends a message to an actuator device. \n[LO 3.2] \n6. List the features of MQTT. \n[LO 3.2] \n7. How do the connected devices connect to server-end functions in IoT for business \n\nprocesses? \n\n[LO 3.2] \n8. Specify functions of CoAP, RESTful HTTP, MQTT and XMPP (Extensible Messaging \n\nand Presence Protocol) in IoT apps. \n[LO 3.2] \n9. What are the protocols needed in web connectivity in IoT applications? \n[LO 3.2] \n10. How do the actions of PSK, RPK and certification protocols compare? \n[LO 3.2] \n11. How does XMPP-IoT apply in IoT applications? \n[LO 3.2] \n12. What are the functions of a communication gateway? \n[LO 3.2] \n13. Compare the use of an HTTP request response and a SOAP object transfer. [LO 3.2] \n\n14. How can an HTTP request/response be used for bidirectional data transfers? \n[LO 3.3] \n15. What are features in WebSocket that enable extensibility to cloud services, support \n\nfrom intelligent and business analyst applications, and support from business \nprocessing? \n[LO 3.3] \n\nReview Questions \n\n1. Why do constrained environment and data ROLL network need a distinct set of \n\nprotocols? \n[ LO 3.1 ] \n2. Show diagrammatically and explain the communication gateway and proxies \n\nbetween CoAP objects and web applications. \n[ LO 3.1 ] \n3. Show diagrammatically and explain the features of LWM2M. \n[LO 3.1] \n4. Show diagrammatically and explain the SMS communication between MO and CoAP \n\nobject, CoAP object and MT, CoAP object and Mobile service provider. \n[LO3.1] \n5. Show by a diagram the object exchanges between devices, CoAP-MQ Broker and \n\nweb applications. \n[ LO 3.2 ] \n6. Draw message exchanges between devices, MQTT broker and web applications. \n\n[ LO 3.2 ] \n7. Explain REST architectural style of coding for client/server interactions. \n[ LO 3.3 ] \n8. What are the applications of SOAP? How does the SOAP message code and sent? \n\n[LO 3.3] \n9. Describe the features of object exchanges using HTTP request/response and \n\nWebSockets. \n[ LO 3.3 ] \n\nPractice Exercises \n\n1. List the protocols behind M2M communication with applications and service \n\ncapabilities. \n[LO 3.1] \n2. Explain when CoAP-MQ and MQTT are used. \n[LO 3.1] \n\n\u2605 \n\u2605\u2605 \n\u2605\u2605\u2605 \n\n\u2605\u2605 \n\u2605\u2605 \n\n\u2605 \n\u2605\u2605\u2605 \n\n\u2605\u2605 \n\n\u2605 \n\u2605\u2605\u2605 \n\n\u2605\u2605 \n\n\u2605 \n\u2605\u2605 \n\n\u2605 \n\u2605\u2605\u2605 \n\n\u2605 \n\n\u2605\u2605 \n\n\u2605\u2605 \n\u2605\u2605\u2605 \n\n\u2605\u2605 \n\n\u2605\u2605 \n\n\u2605\u2605\u2605 \n\n\u2605 \n\n\u2605\u2605 \n\n\u2605 \n\n\u2605\u2605 \n\nDesign Principles for Web Connectivity \n119 \n\n3. Draw an architectural view of IDs data transfer for web applications in Internet of \n\nRFIDs (Example 2.2). \n[LO 3.1] \n4. Recall Example 1.1. Draw an architectural view of data exchanges between the \n\numbrella, web service for forecasting of rain and hot sunny days and mobile. \n\n[LO 3.2] \n5. How is XMPP used for IoT applications? \n[LO 3.2] \n6. How is HTTP POST method used for publishing weather service data? \n[LO 3.3] \n7. Develop an architecture for bidirectional data exchanges between the CoAP client \n\nand WebSocket. \n[LO 3.3] \n\n\u2605\u2605\u2605 \n\n\u2605\u2605 \n\n\u2605\u2605 \n\n\u2605 \n\u2605\u2605\u2605 \n\n",
  "createdAt": "2026-02-17"
}