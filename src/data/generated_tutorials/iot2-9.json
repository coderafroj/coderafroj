{
  "title": "9",
  "slug": "iot2-9",
  "description": "Module from iot2.pdf: 9",
  "tags": [
    "iot2",
    "Elite"
  ],
  "content": "# 9\n\nPrototyping and Designing the \n\nSoftware for IoT Applications \n\nLearning Objectives \n\nLO 9.1 Develop the codes, design and test the embedded devices for IoT and M2M using IDEs and development platforms LO 9.2 Analyse and program the devices, gateways, Internet connectivity, web and cloud applications using the open-source implementations of Eclipse IoT stack LO 9.3 Describe prototyping methods of the online components for IoT application APIs \n\nRecall From Previous Chapters \n\nSection 1.4 listed the following five entities for the technology behind IoT systems: \n\n1. Device platform consists of device hardware and software using a microcontroller (or SoC \n\nor custom chip), and software for the device APIs and web applications 2. Connecting and networking (Connectivity protocols and circuits) enabling the internetwork \n\nof devices and physical objects, called \u2018things\u2019; enabling Internet connectivity to remote servers \n\n3. Server and web programming enabling web applications and web services 4. Cloud platform enabling storage, computing,  prototyping and product development \n\nplatforms 5. Online transactions processing, online analytics processing, data analytics, predictive \n\nanalytics and knowledge discovery enabling large number of  applications of an IoT system. \n\nPrototyping and Designing the Software for IoT Applications 327 \n\nThe previous chapter defined embedding as a process of embedding software into a computing hardware to enable system functioning for the specific dedicated application(s). A device- platform embeds software into computing and communication hardware, and it functions for specific  application(s). The chapter covered the hardware and prototype development using a device platform, such as, Arduino, Galileo, Edison, Raspberry Pi, BeagleBone,  mBed. The chapter described basics of designing the embedded devices. The descriptions included the following: \n\n\u25cfUses of embedded software functions, device APIs and middleware; the middleware enables a device to perform the functions of the computing and communication. \n\n\u25cfConnectivity interfaces consist of processing units, device interfaces and APIs for communication. They perform the computing and communication functions. \n\n\u25cfIntegrated Development Environment (IDE) enables the coding on a computer connected with the embedding platform, downloading of the codes from the computer and development of error free codes using a number of edit test-run, and debug cycles (Section 8.2). \n\n9.1 INTRODUCTION \n\nFigures 1.3 to 1.5 showed that in order to develop the IoT software five levels are needed: (i) Gather + Consolidate, (ii) Connect, (iii) Collect + Assemble, (iv) Manage and Analyse and (v) Applications and Services. This chapter will explain the five levels and required software in detail. \n\nThe present chapter focuses on methods of developing software, which are used at levels of IoT devices, gateways, Internet connectivity and web and cloud applications. \n\nRecall the meaning of the key terms, such as app, application, framework, XML, API, script, java script, object, client, server, URL, HTTP, HTML5, web service, WebSocket and bootloader, Application Programming Interface (API) Operating System (OS), Real-Time OS (RTOS), process, task, thread, IDE and library from Chapters 3 and 8. Some of these key terms are re-explained along with new terms. The understanding of these terms will enable the reader ease in learning the development processes for software including the APIs: \n\nComponent is an abstraction for a core set of frameworks, services or software functions that can be reused after reconfiguring them for providing solutions. \n\nSoftware framework is an abstraction which provides reusable software environment and software with generic functionalities. A framework helps a user to selectively change and add new functionalities when reusing the functions that create new applications, services, products and solutions. For example, assume a framework which provides generic functionalities for graphics and drawing the objects. A drawing application developer selects and reuses the framework functions, selecting the drawing and visualising functions, like ellipse or circle and adding the required ellipse or circle parameters such as size, position, colour, shading and fill patterns. An application runs and draws the object \n\n328 Internet of Things: Architecture and Design Principles \n\nas per the parameters and uses the generic functions provided in the drawing framework. The analogy can be taken from a candle building framework which is used in the candle making industry. Putting the threads in appropriate holes and filling of molten wax makes a bundle of candles. \n\nApplication framework is a framework that supports a fundamental structure and provides a skeleton which leads to development of applications, and provides reusable development environment with generic functionalities. The framework helps a user to selectively change, add new functionalities and build the application. \n\nWeb-application framework is a framework which supports the fundamental structure and skeleton, which leads to the development of web-applications including, web APIs and resources. The framework provides reusable web-application development-environment with generic functionalities. The framework helps user of framework selectively change and add new functionalities and build web application or web service and APIs. \n\nCommunity is a software development initiative or model, which uses collective efforts for software development. A community forms on initiative of universities, organisations and institutions for an open source project. The community is an approved open-source independent foundation for distribution, like OSGi. A foundation or community may also hold copyright and commit to follow distribution practices, contributor agreements and licensing, for example, Apache foundation, for the Apache server. \n\nOSGi (Open Service Gateway Initiative) is a development framework for Java that is used for deploying modular software programs, libraries and bundles. \n\nOSGi  bundle refers to a tightly coupled collection of classes, jars, and configuration files. A bundle is dynamically loadable. The external dependencies are explicitly declared, when existing. \n\nSoftware stack is a set of frameworks and services that is minimum need for an intended complete solution. Examples are Eclipse IoT Stack for IoT and Berkeley Data Analytics Stack (BDAS) for analytics solutions. A stack may be community supported. For example, Open Services Gateway initiative (OSGi) supports Eclipse IoT Stack. Stack provides a set of software functions, frameworks, packages, modules or subsystems. The stack creates a complete platform to support the applications or services when installed and configured on individual systems or added to the templates for automatic installation. \n\nSandbox server1 is a server with data from the source code distributions and other collections of contents, data or sets of the codes, proprietary or public, and is protected from changes intentional or unintentional. The server functions as a working directory, test server or development server. A sandbox is also used for testing a developed application. Sandbox client uses the server\u2019s minimal functionalities, same environment variables or access to an identical database of the server for the development of specific functionalities and application(s). \n\n1 https://en.wikipedia.org/wiki/Sandbox_(software_development) \n\nPrototyping and Designing the Software for IoT Applications 329 \n\nLinux distribution means a package or set of software functions and modules of Linux, bundled together for specific functions or for specific hardware, and distributed for wider usages and applications. \n\nBootloader is system software which loads or embeds into a microcontroller chip or computing platform to let the system start its functions. \n\nOS is system software. It manages the processes, memory, IOs, network subsystems and devices. It enables prioritisation, multitasking, concurrent running of multiple threads and many system functions using given computing device hardware. An OS may be open source, for example, Linux or its distribution. A Linux-based OS distribution is Debian Squeeze Arch Linux Fedora for Raspberry Pi or BeagleBone using an ARM processor. \n\nMultitasking or multithreading means execution of multiple tasks or threads, according to some plan, such as active or unblocked tasks run according to a sequence or one after one in allotted time slices or according to the priorities assigned for each or run first called task first. The OS supervises the running of the tasks and threads. \n\nReal-time Operating System (RTOS) is also a system software and is an OS that enables running of real-time processes on computing and communication hardware. \n\nScript is a piece of code in text form, which runs using an Interpreter, which interprets them at the runtime. Examples of the scripting languages are JavaScript, JSON, Perl and PHP. \n\nC is a high-level programming language, used for coding the embedded platforms. The codes compile and generate the executable codes for that platform or computer. C is a procedure-oriented language. \n\nFunction (method) is a named entity with arguments in between the brackets () and has the statements in C or other programming language. The arguments are specified within the brackets or quotes. The arguments associate with the function, pass the initial values and return the results. For example, assume a function chocolates_Sold() for calculating the chocolates sold during the specific interval using a sales table.  Then three arguments are start and end dates, annual sales table that will be passed in the function for the execution of the statements and fourth argument returns the value = total number of chocolates sold during the interval after the calculations. \n\nData values are passed from a (calling) function to a called function and the results after executing the statements can be sent (returned) for use by a function needing those results. Each language has some element similar to C function. For example, a function is called a method in Java for the similar purpose. \n\nException is a signal or object which represents occurrence of an event, exceptional condition or conditions on which another set of codes need to run. This set of codes may be at a callback() or catch() function. Exception is thrown (sent to the system) on the occurrence. It is thrown when an exceptional condition arises during the execution of a function or a set of statements. \n\n330 Internet of Things: Architecture and Design Principles \n\nCatch is a method (function) which runs only once on the occurrence of an event. A thrown exception is said to be caught by the catch(), also called callback() method. The event object resets or removes (points to null) at start of the catch(). \n\nC++ is a high-level object-oriented programming language, which includes classes, objects as well as C codes. C++ codes also compile and generate executable codes. A modified version of standard C/C++ used at the device platforms includes additional software libraries, and that may subtract certain functions. Subtracting may be due to need of limiting the usages of system memory in small memory platforms or due to no necessity of them for specific problems or hardware. For example, Arduino platform C++ compiler uses avr-gcc, which does not provide for handling of exceptional conditions and try-catch blocks which are used in standard C++. Examples of additional libraries are specific programs for distinct actions, which provide for programs, such as sending data to a USB port for onward transmission onto the Internet, and for the usages of protocols, ports, serial ports, USB ports, GPIO pins, timers, Ethernet and hardware units at a device platform. The avr stands for AVR\u00ae microcontroller at the Arduino boards. The gcc stands for GNU C/C++/Objective C compiler. The avr.gcc enables usage of codes, which run on the AVR. \n\nCompiler is the software for debugging and listing errors, if any, and then converting the codes into running executable codes on a specific computing platform and environment. Languages, such as C, C++ need compilers to enable running the codes on a computing platform and run-time environment. \n\nCompiled virtual-machine language refers to a language such as Java or C# that compiles codes, which are platform and runtime environment independent. The codes need a Virtual Machine (VM) or a framework that enables running on a computing platform and run-time environment. \n\nApplication Programming Interface (API) is a software which enables access to an app, application or service. An API runs on a local or remote computing platform, which sends messages from the client (user) end for the server (application) end, and receives server messages for the client. \n\nMessage is a general term, which refers to communicating data, request, query or response during communication from one end, say a client, server, script, function, method or API to the other end. \n\nGraphic User Interfaces (GUIs) refers to computer screen display tools, such as status bar, task bar, buttons, check-boxes, menus and dialog boxes which enable easy interactions of APIs between the user and app, application or service software. \n\nGraphical software means software with the GUIs. \n\nCross-platform software refers to software which can be developed on one system, such as a computer for another computing platform, such as Arduino. \n\nPrototyping and Designing the Software for IoT Applications 331 \n\nLightweightsoftwarefunction denotes a function which requires limited additional resources, and is not dependent on the OS functions or functional resources of another source. \n\nClient is a piece of code which makes a request. Example is a CoAP client sending request to a CoAP server or an HTTP client sending request to an HTTP server. \n\nServer is one which generates the response to client request or which publishes messages or responses for the clients, which send the requests or subscriptions. \n\nBroker is an intermediate server which receives the published data, message, a client request or subscription from one end and which also functions as a server to send the messages/responses for another client at the other end. For example, MQTT broker receives data/messages published from the device platform using node.js MQTT client running an application and sends response to the other end Java MQTT client at the application running at a computing system or phone using subscription. \n\nJava is a widely used object-oriented, high-level programming language with large open source libraries, communities and distributions. Java compiles into byte codes. The codes can run anywhere on a computing platform, provided the platform includes a JVM (Java Virtual Machine). A JVM is a software to translate the byte codes into native machine codes. Java is thus a compiled VM language. Machine means a computing platform consisting of hardware, OS and Software. \n\nC# is an object-oriented high-level programming language and a compiled VM language that compiles CIL (common runtime language) codes, which are called the managed codes. The managed codes are CPU neutral and platform independent, and therefore can run anywhere on a computing platform provided the platform has the runtime environment and framework, such as dot Net. \n\nPerl, a scripting language, the usages of which are for handling and parsing the XML, and parsing of the strings of character data and messages of the client for the server and the messages of server for the client (Section 3.3). Perl also has vast libraries. Perl enables easy coding of the scripts, even for big websites. A set of script codes execution is slower than C++ and need greater runtime memory for parsing. \n\nPython, a high-level language in which codes are interpreted at runtime, expresses code in fewer lines compared to Java or C++, and supports big libraries and open source codes on a computing platform or computer.2 A version is Cpython, which is a community, Python software foundation manages. \n\nRaspberry Pi, BeagleBone or other platforms also run Python. There are many advantages of using Python. Examples are easy sending requests and receiving responses from the Internet services, regular expression coding for short expressions for easy handling and parsing of the strings of character data, such as weather data (Example 1.1), message strings to or from a server or cloud, self-memory management and easy connecting and querying of databases. The codes execute little slower than C++ and need greater memory. \n\n2 https://en.wikipedia.org/wiki/Python_(programming_language) \n\n332 Internet of Things: Architecture and Design Principles \n\nRuby is a programming language which is used for development of a web application and service. \n\nEvent model enables the functions, methods, scripts or APIs run on eventing. The scripts can run in multitasking mode on multiple events. Assume, if four events occur then for each event a script or function runs and four tasks, each executing multiple scripts which run on eventing. \n\ncallback() is a method (function) which runs on the event. For example, on receiving a message or the data or a request or a change in a parameter value behind a set-limit or on occurrence of certain action or exception. A callback() runs on the event and therefore, an eventListner() function need to run (explicitly or implicitly in background) for listening the occurrence of that event and finding the need of running callback(). \n\nNode.js is a framework for creating the JavaScript codes for running on a cross platform environment, including browser, such as Chrome. The framework enables faster creation of the scalable network applications for distributed devices using a browser. The code development is fast when compared to creating that from JavaScript directly. Scalable means can be made big or small. \n\nNode.js programming is based on the event model for running of scripts in an application. The scripts at the callback() functions run at the multiple distributed devices on the events. Node.js framework thus enables development of real time web applications and games using the browsers where input-output needs to be processed fast. \n\nProcessing language is a programming language for a development environment. Processing is open source. A computer programmer can download the environment from the website for the processing language.3 The language also enables creation of an elegant GUI-based programming interface. \n\nWiring,4 an open source module consists of a set of hardware and software which is similar to Arduino and has programming environment for an Arduino like device platform. \n\nSketch in Arduino means an open source unit of code (a program unit), which uploads on the device platform/board and runs. An example is blink sketch, which is the code for blinking at the board when run. Another example of sketch is for analog reading and serial printing (or displaying on serially connected computer) at successive intervals or RFID tag ID reading or I2C device data reading. \n\nFirmware refers to software permanently residing at a circuit Read Only Memory (ROM) or flash.  Firmware provides specific functionalities of that circuit, such as bootloader, a start-up program on power on and ROM BIOS (basic input-output system) functions. \n\nLua extension language/scripting language, is a dynamic type language for a number of host platforms. Lua has features of co-routines (multiple tasks running at distributed applications, dynamic loading of the modules, usages of first class functions (supporting \n\n3 http://www.processing.org 4 http://www.wiring.org.co \n\n\n![Image](/src/assets/generated_images/iot2_p359_i0.png)\n\nPrototyping and Designing the Software for IoT Applications 333 \n\npassing functions as arguments to other functions, returning them as the values from other functions or assigning the values to the variables or values in data structure).5 \n\nSection 9.2 describes the ways of developing software for the embedded device platforms using the IDE. Section 9.3 describes the ways of developing gateway software for communication between the devices and applications and services at a cloud or server using  Eclipse IoT stack. Section 9.4 describes ways of developing the online component APIs, web APIs and WebSocket APIs for message exchanges between embedded devices and applications and services at  the server or cloud. \n\n9.2 PROTOTYPING EMBEDDED DEVICE SOFTWARE \n\nThe previous chapter described prototyping and development boards\u2014Arduino, Intel Galileo, Edison, Raspberry Pi, BeagleBone and mBed. Prototype development of the programs requires bootloader, OS and IDE. Software embeds into a device platform. \n\nFirst level in IoT architectural concept is gathering (data from devices/sensors) + consolidating (enriching). Second level is connection to the Internet. An IDE enables development of software for functions at first and second levels. IDE may also enable usages of the OS or RTOS functions at an embedded device. \n\nBootloader firmware stores at flash/ROM of a microcontroller in a device and enables communication with a computer having an IDE. The IDE, in general, consists of the APIs, libraries, compilers, RTOS, simulator, editor, assembler, debugger, emulators, logic analyser, code burner, and other software for integrated development of the system. An IDE may be an open source. For example, Arduino has an open source IDE which is downloadable from the Arduino website. \n\nIDE enables the development of codes on a computer, and later on downloading (pushing) of codes on to embedded device, such as Arduino or microcontroller board. The code-burner places codes into flash memory or EEROM or EPROM. The specific application codes are thus embedded into the device. \n\n9.2.1  Programming Embedded Device Arduino Platform \n\nusing IDE \n\nArduino board can be programmed using avr-gcc tools.6 The Arduino board has a pre-installed bootloader embedded into the firmware. \n\n5 https://en.wikipedia.org/wiki/First-class_function 6 http://www.nongnu.org/avr-libc \n\nDevelop the codes, design and test the embedded \n\ndevices for IoT and M2M using the IDEs \n\nand development \n\nplatforms \n\nLO 9.1 \n\nIDE enables development of software at first level \n\nand second level for embedding into device \n\nplatform \n\nArduino IDE open source from http:// \n\nwww.arduino.cc provides multitasking simplicity and enables \n\nthe development of the codes, their simulation and upload (embedding) on to the \n\ndevice \n\n334 Internet of Things: Architecture and Design Principles \n\nArduino programmer develops the codes using a graphical cross-platform IDE. Arduino provides simplicity. IDE of Arduino board also has simplicity, is based on processing language and makes the programming easy. The board connects to a computer which runs the IDE. The bootloader program hand overs the control and enables running of the loader, which loads the required OS functions and software into the system hardware and networking capabilities into the board. \n\nThe Arduino bootloader provisions for multitasking by the usage of interrupt (analogous to eventing) handing functions for each task. Multitasking is done by assigning multiple values of a number n for the tasks (n > 0). When an instruction for interrupt; for example, INT n executes, then interrupt-handing function n is called for execution. Each task or thread can have the number n associated with it. Interrupt-handing function, similar to a callback(n) executes on event n or similar to catch function on exception n. \n\nThe IDE consists of a set of software modules, which provide the software and hardware environment for developing and prototyping the software for a specific device platform. First, a computer downloads an appropriate IDE version, as per the computer OS. A computer usually runs Windows or Mac OS X or Linux. \n\nThe bootloader enables the computer to push the developed codes into a board using the Arduino IDE through a USB cable or a labelled serial port. Arduino bootloader need not initiate the upload of OS, as done in a computer where bootloader loads the OS from the secondary disk. \n\nThe Arduino IDE is available from the website of Arduino.7 A programmer downloads the required IDE version. IDE runs on the computer and enables the development of the codes, their simulation and upload (embedding) on to the device platform. \n\nThe Arduino IDE includes a C/C++ library. The library is called Wiring for a project of the same name with open source module at a website.4 The Wiring library functions make coding easy for the Arduino IO operations. \n\nDevelopment of the Codes \n\nArduino IDE functions as a file editor for the codes using the Processing environment and library functions. The editor provides automatic indentation, highlights the syntax of the codes and matches braces. The edited file compiles, checks and lists errors, if no errors, enables pushing of codes for embedding onto the board through serial or USB port. \n\nSimplicity of Arduino is clear from the fact that only two functions are necessary to define executable program functions for the board, namely, setup() and loop(). The function setup() runs at the start and is used for initialising settings, and function loop() has a program in endless loop using statement  \u2018while (true) {statements ;}\u2019 which runs till power off. \n\nA serial monitor at the IDE enables messages from the embedded software for the microcontroller into the computer screen where the IDE is setup. The messages are required during testing and debugging the downloaded software during test stages. \n\n7 http://www.arduino.cc \n\nPrototyping and Designing the Software for IoT Applications 335 \n\nUsing GPIO Pins \n\nAssume that a programmer is well versed in C/C++ programming. Example 9.1 shows how to program GPIO pins and serial monitor at the IDE (for computer screen display) using Arduino IDE C/C++. The example is for switching on only of north and south pathways TLs. Next example will describe full control of traffic lights for all four pathways sequentially and also use of an internal LED for testing the successful running of the program. \n\nExample 9.1 \n\nProblem Programming for Arduino controlled traffic-control lights (TLs) at a road junction: Assume Arduino Uno board as an embedded device platform (Section 8.4.1) for the following project: three TLs\u2014Red, Yellow and Green needs to be controlled on each of the four north, east, south and west clockwise pathways. Let twelve GPIO pins on Uno connect twelve number externally connected LEDs, R0, Y0, G0, R1, Y1, G1, R2, Y2, G2, R3, Y3, and G3, (four sets of three R, G, Y LEDs each). The port LEDs represents the TLs during the prototype-development and testing-stage. \n\nHow can the port LEDs be On-Off programmed so that north and south pathways directed roads and traffic is switched on and east and west pathways traffic switched off? \n\nSolution \n\nFirst step is declaring the data types, constants, variables and functions used. Second and third steps are coding for setup() and loop(). Example of program codes, which embeds onto Uno are as follows: \n\n/*Assume twelve digital IO ports assigned to external LEDs are port 2 to 12 and port 14. The ports are programmed according to TLs switching ON or OFF./ \n\n/* Pin 13 connects the board LED, and be used for indicating successful running of the developed codes during testing phases.*/ \n\nint internalLED = 13; \n\n/* Variables are written using a lower case first character */ \n\nint ledR0, ledY0, ledG0, ledR1, ledY1, ledG1, ledR2, ledY2, ledG2, ledR3, ledY3, ledG3; \n\nAssign the pins to the respectively connected LEDs */ \n\nledR0 = 2; ledY0 = 3; ledG4 = 4; ledR1 = 5; ledY1 = 6;ledG1 = 7; ledR2 = 8; ledY2 = 9; ledG2 = 10; ledR3 = 11; ledY3 = 12; ledG3 = 14; \n\n/* Declare Functions for sequences of traffic lights ON-OFF as follows: */ \n\nvoid north_south_Green() { \n\ndigitalWrite (ledR0, LOW); digitalWrite (ledY0, LOW); digitalWrite (ledG0, HIGH); \n\ndigitalWrite (ledR2, LOW); digitalWrite (ledY2, LOW); digitalWrite (ledG2, HIGH); \n\n}; \n\n/* Function Switch RED ON for East and West pathways*/ \n\nvoid east_west_Red() { \n\n336 Internet of Things: Architecture and Design Principles \n\ndigitalWrite (ledR1, HIGH); digitalWrite (ledY1, LOW);digitalWrite (ledG1, LOW); \n\ndigitalWrite (ledR3, HIGH); digitalWrite (ledY3, LOW); digitalWrite (ledG3, LOW); \n\n}; \n\n/**********************************************************/ \n\nvoid setup ( ) { \n\n/* GPIO pins 2 to 12 and 14 are thus assigned port numbers corresponding to 12 external LEDs, R0, Y0, G0, R1, Y1, G1, R2, Y2, G2, R3, Y3, and G3.*/ \n\n/* Assign mode of each pin as output */ \n\npinmode (ledR0, OUTPUT); // Constants are written in Upper Cases \n\npinmode (ledY0, OUTPUT); \n\n. \n\npinmode (ledY3, OUTPUT); \n\npinmode (ledG3, OUTPUT); \n\n/* Let Pin 13 be used for indicating successful running of the developed codes during testing phases. Initialise internal Port 13 Digital IO Pin LED for test.*/ \n\npinmode (internalLED, OUTPUT); \n\n/* Initialise start of the Board and Sequences. */ \n\ndigitalWrite (internalLED, HIGH); \n\n/* Display the settings of Digital IO pins at serial display-monitor on the computer where IDE is setup. */ \n\n/*Let UART mode baud rate = 9600*/ \n\nSerial.begin (9600); \n\nSerial.println (\u201cArduino project.Program for controlling three traffic signals- Red, Yellow and Green at four pathways\u201d); \n\nSerial.println (\u201cArudino board LED glows when cycle starts for the sequences of lights turning high and turns off for brief interval in order to indicate the successful completion of the cycle\u201d); \n\nSerial.println (\u201cTwelve 12 external LEDs, R0, Y0, G0, R1, Y1, G1, R2, Y2, G2, R3, Y3, and G3 corresponds to 12 traffic lights at north, east, south, west four pathways\u201d) \n\n} \n\n/***********************************************************************/ \n\nStep: Loop function which endlessly runs \n\nvoid loop () { \n\n/* Assume no right turn from pathways or left turn from pathways permitted, just for simplicity and for learning the basics. */ \n\n/*Switch Green ON for North and South pathways */ \n\n/*Switch RED ON for East and West pathways*/ \n\n// Run Functions \n\nPrototyping and Designing the Software for IoT Applications 337 \n\nnorth_south_Green(); \n\neast_west_Red (); \n\n} \n\nExample 9.2 is for a complete program for switching on and off of north and south pathways and east and west pathways, after intervals of 10 s each. The LEDs in ON states remain so for 30 s period. Function delay() provides the period of 30 s and also the intervals of 10 s between switching on of traffic along north and south pathways and switching on of traffic along east and west pathways. Test LED switch off for 6s between the successive repeat cycles. \n\nExample 9.2 \n\nProblem Programming for Arduino controlled traffic-control lights (TLs) at a road junction with control of on intervals: Assume the same set up and LEDs with the same connection as described in Example 9.1.  Assume that setup remains the same as before. Therefore, the steps 1 and 2 of Example 9.1 are same in the present example as well. How can the port LEDs be on-off programmed codes for Step 3: Function loop ( ). The new codes are for signalling and lights control of all four pathways. Assume delays of 10 s each between successive states of LEDs and steady state for 30 s for a pair of pathways. Write the Function test ( ) to find that the software is functioning as programmed on the board. Assume that test function uses on-board LED at GPIO pin 13 during the period of running of codes. \n\nSolution \n\nProgram codes in Step 1 for pre-processing declarations, which embeds onto Uno, are same as in Example 9.1. \n\n/*  Assume twelve digital IO ports assigned to external LEDs are port 2 to 12 \n\n. \n\nledY2 = 9; ledG2 = 10; ledR3 = 11; ledY3 = 12; ledG3 = 14; \n\n/* Declare Functions for sequences of traffic lights ON-OFF as follows: */ \n\nvoid north_south_Green() { \n\ndigitalWrite (ledR0, LOW); digitalWrite (ledY0, LOW); digitalWrite (ledG0, HIGH); \n\ndigitalWrite (ledR2, LOW); digitalWrite (ledY2, LOW); digitalWrite (ledG2, HIGH); \n\n}; \n\n/* Function Switch RED ON for East and West pathways*/ \n\nvoid east_west_Red() { \n\ndigitalWrite (ledR1, HIGH); digitalWrite (ledY1, LOW);digitalWrite (ledG1, LOW); \n\ndigitalWrite (ledR3, HIGH); digitalWrite (ledY3, LOW); digitalWrite (ledG3, LOW); \n\n}; \n\n338 Internet of Things: Architecture and Design Principles \n\n/* Function Switch Yellow ON for North and South  pathways forbrief interval before change of state */ \n\nvoid north_south_Yellow (){ \n\ndigitalWrite (ledR0, LOW); digitalWrite (ledY0 HIGH); digitalWrite (ledG0, LOW); \n\ndigitalWrite (ledR2, LOW); digitalWrite (ledY2, HIGH); digitalWrite (ledG2, LOW); \n\n}; \n\n/* Function Switch Green ON for East and West pathways*/ \n\nvoid east_west_Green (){ \n\ndigitalWrite (ledR1, LOW); digitalWrite (ledY1, LOW);digitalWrite (ledG1, HIGH); \n\ndigitalWrite (ledR3, LOW); digitalWrite (ledY3, LOW);digitalWrite (ledG3, HIGH); \n\n}; \n\n/* Function Switch RED ON for North and South pathways*/ \n\nvoid north_south_Red (){ \n\ndigitalWrite (ledR0, HIGH); digitalWrite (ledY0, LOW); digitalWrite (ledG0, LOW); \n\ndigitalWrite (ledR2, HIGH); digitalWrite (ledY2, LOW);digitalWrite (ledG2, LOW); \n\n}; \n\n/* Function Switch Yellow ON for East and West pathways */ \n\nvoid east_west_Yellow  () { \n\ndigitalWrite (ledR1, LOW); digitalWrite (ledY1, HIGH);digitalWrite (ledG1, LOW); \n\ndigitalWrite (ledR3, LOW); digitalWrite (ledY3, HIGH); digitalWrite (ledG3, LOW); \n\n}; \n\n/******************************************************************/ \n\nProgram codes in Step 2 for setup() same as in Example 9.1 as setting is unchanged. \n\nvoid setup ( ) { \n\n/* GPIO pins 2 to 12 and 14 are thus assigned port numbers corresponding  */ \n\n. \n\nSerial.println (\u201c Twelve 12 external LEDs, R0, Y0, G0, R1, Y1, G1, R2, Y2, G2, R3, Y3, and G3 corresponds to 12 traffic lights at north, east, south, west four pathways\u201d) \n\n} \n\n/****************************************************************/ \n\nPrototyping and Designing the Software for IoT Applications 339 \n\nModification in Step 3 function loop() are as follows: \n\nvoid loop () { \n\n/*Assume no right turn from pathways or left turn from pathways permitted, just for simplicity and for learning the basics*/ \n\n/*Function Switch Green ON for North and South pathways */ \n\nnorth_south_Green(); \n\n/*Function Switch RED ON for East and West pathways*/ \n\neast_west_Red(); \n\n//Function delay (30000) \n\ndelay (30000); //Wait for 30 secomd \n\n/*Function Switch Yellow ON for North and South  pathways forbrief interval before change of state */ \n\nnorth_south_Yellow (); \n\n//Function delay (10000); \n\ndelay (10000); //Wait for 10 secomd \n\n/*Function Switch Green ON for East and West pathways*/ \n\neast_west_Green (); \n\n/*Function Switch RED ON for North and South pathways*/ \n\nnorth_south_Red (); \n\n//Function delay  (30000); \n\ndelay (30000); //Wait for 30 secomd \n\n/*Function Switch Yellow ON for East and West pathways */ \n\neast_west_Yellow  (); \n\n//Function delay  (10000); \n\ndelay (10000); //Wait for 10 secomd \n\n/*Testing to show completion of one cycle of traffic light \n\nLet internal board LED flash OFF for 6s before the sequences of lights repeat */ \n\n//Statements for  test; \n\ndigitalWrite (internalLED, LOW); delay (6000); // Wair 6 s \n\nSerial.println (\u201c One Sequence completed\u201d ); \n\ndigitalWrite (internalLED, HIGH); \n\n} \n\nEmulator and Debugging of Software \n\nEmulation means to do the actions similar to a real entity. Emulator software emulates the running of an embedded device platform, known as target board. Software emulates the embedded device platform onto the computer. The developer observes the actions on the computer. \n\nEmulating and debugging of software ensures reliable, tested \n\nand bug-free software \n\n340 Internet of Things: Architecture and Design Principles \n\nIn-circuit Emulation (ICE) means hardware debugging by emulation after connecting the target board to the computer. The computer sets the break points in the embedded software. The results at the end of each break point enable a programmer to find the bug (erroneous code or code-section). Computer can initiate single stepping through the codes. The screen displays the registers in the microprocessor or microcontroller, the variables values at the end of each step or at the end of a specified section of codes. Computer display also displays the contents of memory addresses at each break point. \n\nWhen embedded Linux is used on the board, then the developer can use a utility, called gdb (GNU debugger), which is open source at GNU website.8 Connection of target board is through a serial or USB port of computer. Ethernet is also used for device platforms, which support networking. \n\nJTAG (Joint Test Action Group) standard enables testing of the target board onto the computer when JTAG software embeds into hardware, and JTAG connector connects the hardware to computer. \n\n9.2.2 Reading from the Sensors and Devices \n\nUsing ADC Analog Input \n\nAssume a temperature sensor is used for measuring between 0 degree and 100 degree Celsius. A sensor sends analog output at an analog input of a 10 bit ADC (Section 7.2.1). An ADC output converts to serial by a parallel input to serial-output (PISO) converter. The serial output connects to the serial SPI input pin at Arduino Uno board.  An RH% sensor can also be used in a similar manner where measured value is in RH% in place of degree Celsius (Section 7.2.2). \n\nThe ADC output for a sensor at 100 degrees is decimal 1023 (=binary 1111111111) and decimal 0 (=0000000000) for 0 degree. Example 9.3 explains the usage of analog read functions for the Arduino. \n\nExample 9.3 \n\nProblem Programming of Arduino for usages of analog sensor devices at SPI port: A temperature sensor analog output is given to an SPI at Arduino through a 10-bit ADC and PISO. How will the data be read from the SPI input every hour into an Arduino board from the sensor? \n\nHow will the one hour wait loop be programmed and how does the test performed by LED on-off states using a blinking program blink at each 3 s interval? \n\nSolution \n\nStep 1 is declaring the data types, constants, variables and functions used. Second and third steps are coding for setup() and loop(). Example of program codes, which embeds onto Uno are as follows: \n\n#include <SPI.h> /*Include the Serial IO functions between Arduino SPI port and serial input from ADC. */ \n\n8 http://www.gnu.org/software/gdb \n\nPrototyping and Designing the Software for IoT Applications 341 \n\n#include <util.h> /*IO utility functions. Includes UART interface, which connects to computer for display of messages on computer-screen. IDE software provides the functions for display using serial interface output of board. */ \n\n/* Sensed parameter, say, temperature Sensor Input at A0 pin. Define initial input  = 0. */ \n\n#define TempSensorADCinput 0 \n\n/*calibCoeff = output change in parameter per unit rise in temerature by 1 degree Celsius.  For example, calibCoeff  = temperature change per unit change in converted digital value of Vinput from the Sensor.*/ \n\n/* Define calibCoeff = 0.097752. */ \n\n#define calibCoeff 0.097752 /*The calibCoeff is 100/1023 = 0.097752 when sensed parameter analog value is between 0 degree Celsius to 100 degree Celsius and observed digital value is from 0 to 1023 from 10-bit ADC*/ \n\nfloat observedV, parameter; /*observedV = Vinput from Sensor. The parameter = sensed parameter value 0\u2026.1023*/ \n\n/*Let internal LED at digital IO Pin 13 be used for indicating successful measurement and  wait for next reading */. \n\nint internalLED = 13; /* initialise internal Port 13 Digital IO Pin LED for test Function. */ \n\n/* Name the unit, whether degree Celsius or RH% */ \n\nchar [ ] unit; \n\nunit = \u201cdegree Celsius\u201d; /* Declare the unit of sensed parameter unit*/ \n\n/*****************************************************************/ Step 2 is as follows for setup() statements of the program for setting the board and parameters for measurement of sensed V. \n\nvoid setup() { \n\n/* Declare the unit of sensed parameter initial value and initial observed V*/ \n\nparameter = 0.0; // Declare the initial value of the parameter \n\nobservedV= 0.0; // Declare the observedV = 0 at minimum \n\nSerial.begin (9600); //Let UART mode baud rate = 9600. \n\nSerial.println (\u201cArduino Program for input for ADC input at the board\u201d); \n\nSerial.println (\u201cCheck that Arduino pin A0 connects ADC input from the sensor \u201d); \n\nSerial.println (\u201cCheck that Arduino 3.3 V pin connects ADC reference pin at the sensor\u201d); \n\npinMode (internalLED, OUTPUT); \n\n// Indicate start of the Board and Sequences \n\ndigitalWrite (internalLED, HIGH); \n\n// Display the results at serial display monitor on computer where IDE is setup Serial.println (\u201c Arudino board LED glowing starts when hourly cycle starts for the sequences of LED lights turning high and turns off for successive 3s intervals in order to indicate that system is waiting for the next hourly reading\u201d); \n\n342 Internet of Things: Architecture and Design Principles \n\n} /*******************************************************************/ Step 3 is as follows for loop() statements of the program for measuring the ADC input and parameters for the measurement of sensed V at successive interval. \n\nvoid loop () { // ADC uses analog reference voltage and it is internally set. \n\n//A reference voltage is 3.3V at the Uno. // The value is used to convert the acquired value into appropriate reading, // for example, temperature value in degree Celsius units or into RH% \n\n//10-bit ADC means analog voltage resolution is (Vref/ 1024) \n\nobservedV = analogRead (TempSensorADCinput); \n\n//parameter is found from the calibration coefficient \n\nparameter = calibCoeff*obesrvedV *1023/3.3; \n\nSerial.print (\u201cTemperature =\u201d); //Assume sensed parameter is temperature \n\nSerial.println (parameter, unit); \n\ntest ( ); \n\n} \n\n/*****************************************************************/ Step 4 includes a test(). The statements for test function are as follows: \n\nvoid test ( ){ //Start blinks every three second /* One Hour wait for next reading. Run the loop 600 times. Each wait for 3+ 3 second. 6 s \u00d7 600 = 1 hour and LED blinks at 3s ON-OFF intervals*/ digitalWrite (internalLED, HIGH);} \n\nfor ( int i = 1, i<=600) , i++) { \n\ndelay (3000); \n\ndigitalWrite (internalLED, LOW); \n\ndelay (3000); // Wair 6 s \n\ndigitalWrite (internalLED, HIGH); \n\n} \n\nUsing the Libraries \n\nSections 7.5 described software serial libraries and their usages for data communication using serial bus protocols, UART, I2C, USB and CAN. Section 8.3.6 described mBed device platform libraries. The library functions can directly be used during coding. \n\nUsing the Timers \n\nTimer functions are required in a number of applications. A number of timer libraries are available. A set of timer functions library is available online.9 MsTimer stands for millisecond timers with two states. It holds a simple usage (Example 9.4). It has two \n\n9 http://www.arduino.cc/playground/Main/MsTimer2 \n\nPrototyping and Designing the Software for IoT Applications 343 \n\nfunctions set() and start(). First one sets the timer for interrupt after a preset interval and second one to start running the timer. \n\nExample 9.4 \n\nProblem Programming of Arduino for uses of timer library functions: \n\nHow will you use the Mstimer2 library to call a function action() after successive intervals which are preset at 3 s? \n\nSolution \n\nFollowing are the statements which calls action() every 3s using Mstimer2. Step 1: Statements for preprocessor commands, declarations of data types and functions and inclusion of required library files. \n\n#include <MsTimer2.h> \n\nvoid action ( ) { \n\n/* Write statements for actions on preset time over, for example change of output at an IO pin*/ \n\n} \n\n/*****************************************************************/ Step 2: Statements are for pin configuring and initial set up statements as in Examples 9.1 to 9.3. A statement specifies a preset value for the interval after which timer MsTimer2 will interrupt and call interrupt handing function. Let function be specified and named action(). \n\nvoid setup ( ) { \n\n/* Write pins and initial setup statements. */ \n\n/* Set the millisecond timer to execute the function action ( ) after 3000 ms*/ \n\nMsTimer2: : set (3000, action); \n\n/* Start the millisecond timer*/ \n\nMsTimer2: : start ();} \n\n/******************************************************************/ Step 3: Statements are for codes for actions during 3s and which are repeatedly done, if stop condition not defined inside the loop. \n\nloop ( ){ \n\n} \n\nUsing Software Serial Library \n\nA serial interface library has functions to read and write as per serial protocols. A protocol- based communication first transmits the header bits. These may include the address of the device or registers (control, data, status or other registers). The data bits transmit after header bits and control bits, if any. End-bits transmit in the end. Each serial protocol has specific ways of formatting and sequencing during communication. \n\n344 Internet of Things: Architecture and Design Principles \n\nUART protocol based communication uses two signals, denoted by Tx or TxD (for serial transmission of header, data and other bits) and Rx or RxD (for serial reception). Assume that baud rate is 2400. Then, 240 times a new set of 8-bits data transmits in one second. 10 bits transmit for each set for data, character, command or address. A byte represents a character in a string, a sensed data and command for receiving device or address of destined or receiving device. \n\nArduino board has pins 0 (Rx) and 1 (Tx) for UART serial communication. A computer connects to the board using these pins. Software serial library has functions, which read and write serial data using Arduino\u2019s board. The data input-outputs can be at two pins of digital IO pins, other than 0 and 1, viz. pin 2 and pin 3 as the Rx and Tx, respectively. \n\nUART functions in software serial library set the pins modes as Tx and Rx. The communication initiates RFID Rx and Tx pins at the RFID IC, whenever RFID pins connect to digital IO Tx and Rx pins, respectively. The IC TX becomes low from high when communication initiates from Arduino. RFID IC detects that and first sends a header, which represent a preset address of the device. \n\nThe Arduino serial interface reads the header before accepting the tag ID. ID is of 10 characters and the IC sends an end-character from the RFID at the end. End character ASCII code is 13. \n\nSoftware serial library enables data communications using simple uses of serial read and write functions. Example 9.5 explains the serial read of an RFID tag using UART with the help of the library functions. \n\nExample 9.5 \n\nProblem Programming of Arduino for usages of RFID ID serial-data reading using UART port: \n\nAn RFID Integrated circuit (IC) sends serial data to an Arduino board using UART protocol Tx and Rx inputs at the RFID tag pins. How will serial data be read at pins 2 and 3 as Rx and Tx, respectively using Arduino board? \n\nSolution \n\nFollowing is a program for reading serial data for the sensed value and stored 16-bit coefficients at IC. \n\nStep 1: Preprocessor commands, declarations of data types, functions and constants \n\n/* UART communication has 1 start bit. The first serial bit becomes LOW from HIGH for a period equal to baud interval. Then, 8 serial bits transmit in 8 successive baud intervals. A stop bit then transmits for 1 baud interval. Total 10-bits communicate for each serial write or read.*/ \n\n#include <UARTSerial.h> /*Serial IO functions for Arduino UART Serial Interface*/ \n\n#include <util.h> /*IO utility functions*/ \n\n/* Assume that IC uses address 0x08 for device header which includes address. Let the IC send 12 bytes, one for the header (address), ten bytes for the sensed data or RFID tag or ID and one byte for the end character. (Data sheet of the \n\nPrototyping and Designing the Software for IoT Applications 345 \n\ndevice specifies the actual address and format of header bits and tag or ID bits.)*/ \n\n#define UARTDEVICE_HEADER 0x08 \n\nint nID 10 /* number of characters in the string for the ID or number of bytes of sensed data from the device*/ \n\nchar [ ] ID_characters \u201c\u201d //A String Variable for ID_characters \n\nint header //Variable for the header received from the device \n\nint end // Variable for end character received \n\n/*Declare internalLED digital IO pin number which shows status of the running of the Board*/ \n\nint internalLED = 13 \n\n/*Declare Arduino IO pin numbers which the IC uses to transmit or receive serially from the board*/ \n\nint SerialRxPin 3 \n\nint SerialTxPin 4 \n\nclass SerialRxRequest { \n\nprotected: bool loop ( ); \n\nprivate: bool serialRx_request; \n\n} \n\nSerialRxRequest : : SerialRxRequest (bool serialRx_request) { \n\n/* Set the serialRx_request. Assign true to the request to serial reception of sensed data or RFID tag*/ \n\nthis -> serialRx_request = true; } \n\n/*****************************************************************/ Step 2: Setup statements to declare the modes of pins and initial states. \n\nvoid setup ( ) { \n\n/* Read data from UART DEVICE. An IC used as RFID tag or IC based sensor may be using UART communication. */ \n\npinmode (SerialRxPin, INPUT); \n\npinmode (SerialTxPin, OUTPUT); \n\npinMode (internalLED, OUTPUT); \n\ndigitalWrite (internalLED, HIGH); \n\ndigitalWrite (SerialTxPin, LOW);//enable Serial reception \n\n} \n\n/******************************************************************/ Step 3: Continuously running loop till stop condition encounters. \n\nbool SerialRxRequest : : loop () { \n\n/*Serial Reception of characters as long as SerialTxPin = = LOW or SerialRx_ request = = true*/ \n\nif (SerialTxPin = = HIGH || serialRx_request = = false) ( \n\nSerialRx.stop ( ); serialTxPin = HIGH; } \n\n346 Internet of Things: Architecture and Design Principles \n\nIf (SerialTxPin = = LOW || SerialRx_request = = true) { \n\nSerialRx.begin (4800); /*Assume it communicates at baud rate = 4800. */ \n\nID_characters [0] = SerialRx.read (); // Reader Header character \n\n/*Check header character = 0x08, if match then read sensed data ten bytes and end character*/ \n\nIf (ID_characters [0] = = UARTDEVICE_HEADER) { \n\nfor (int i= 1; i< nID +2); i++) { \n\nID_characters [i] = SerialRx.read (); \n\nSerialTxPin = HIGH} \n\n// Statements for Serial Print of the result at Serial Monitor \n\n. \n\n/* Statements for communicating ID Characters or sensed characters on to Internet or Ethernet or USB*/ \n\n// Call test () for functioning of the serial IOs \n\ntest ( ); \n\nSerialTxPin = HIGH; //stop further read, loop terminate \n\nreturn false;) \n\n} \n\nUsing I2C Serial Protocol \n\nI2C protocol is communication protocol for a serial-bus that communicates in synchronous mode. A device transfers data as a master or slave. Master means the device can address and communicate with a number of slaves. Master sends clock pulses to the slave devices for synchronisation. Maximum connected devices can be up to 127. \n\nAt one instance, one device functions as a master and another as slave, and functioning depends on the internal circuit for I2C functions at the device. \n\nAssume that a sensor has built-in ADC as well as I2C interface, and communicates the bytes over I2C SDA and SCL pins. Example 9.6 explains the usages of software serial library for communication of bytes on I2C bus using Arduino. For details, refer to author\u2019 book on embedded systems.10 \n\nExample 9.6 \n\nProblem Programming of Arduino for usages of synchronous serial-data read using I2C bus: \n\nHow will the data and coefficients be read from IC based sensor at Arduino serial port? Use the software serial library functions at IDE for reading I2C bus data. \n\nSolution \n\n10 Raj Kamal, \u2018Embedded Systems\u2014Architecture, Programming and Design, 3rd edition, McGraw-Hill Education, New Delhi, pp. 169\u2013170, 2014. \n\nPrototyping and Designing the Software for IoT Applications 347 \n\nThe serial pin A4 is for SDA bits and A5 for SCL bits. First connect the sensor IC with A4 and A5. Functions at software serial library enable uses of read and write for serial data. \n\nAssume Arduino functions as master device and an IC based sensor as a slave device. Assume that the sensor IC has addresses for control and data registers. The registers save at EEPROM memory in the IC. A measured 16-bit value saves at two memory addresses, which save the data registers. A programming of control register enables the working of the IC in several modes. The IC uses the data registers and communicates two bytes.  One is for higher and the other for lower bytes. Memory also saves and communicates the calibration coefficients for communication as I2C serial data from a set of addresses. Assume device calibration data has 22 addresses in memory for eleven values of 16-bit calibration coefficients. Following is the program for reading serial data for sensed value and stored 16-bit coefficients at the device. Step 1: Program codes for pre-processing declarations, data types and functions \n\n#include <Serial.h> /* Include functions between Arduino and Serial Monitor l*/ \n\n#include <Wire.h> /* include Wiring functions*/ \n\n#include <util.h> /*IO utility functions and include functions between Arduino and input-output devices*/ \n\n/*I2C protocol envelopes the data with header bits. First seven bits are for the address of destination device. Define the I2C serial device address for use for the sensor IC communication.  Assume that sensor uses address 0x08 for device address and Device Data 1 Address 0x16 and data 2 address 0x17 (Data sheet of a device specifies the actual addresses).*/ \n\n#define I2CDEVICE_ADDRESS 0x08 \n\n/*Assume control command is at address 0x02*/ \n\n#define char I2DEVICE_CONTROLDATA 0x02 \n\n/*Assume Data 1 address is at 0x06 and 2 at 0x0A. */ \n\n#define I2DEVICE_DATA1_ADDRESS 0x06 \n\n#define I2DEVICE_DATA2_ADDRESS 0x0A \n\n/*Declare two integers 16-bit variables, observedValue1 and observedValue2 */ \n\nint observedValue1, observedValue2 \n\n/*Declare two float (four bytes each) variables , value one for value1 after using calibration coefficients and another for value2 after using calibration coefficients */ \n\nfloat observedCValue1, observedCValue2 \n\n/*Declare unit of sensed parameter value, for example, degree Celsius*/ \n\n#define char [ ] unit \u201c\u2026\u2026\u2026..\u201d \n\n/*Declare internalLED digital IO pin number which shows status of the running Arduino*/ \n\nint internalLED = 13; \n\n/*Assume that IC based sensor uses addresses from 0x18 to 0x2C, two addresses per 16-bit integer coefficient. (Data sheet of the device specifies the actual address where calibration coefficients can store).*/ \n\n#define CALIBCOEFF_ADDRESS [ ] 0x18, 0x1A, 0x1C, 0x1E, 0x20, 0x22, 0x24, 0x26, 0x28, 0x2A, 0x2C \n\n/*Declare array for integer values of calibration coefficients stored at the \n\n348 Internet of Things: Architecture and Design Principles \n\nIC memory*/ \n\nint calibCoeff [11] \n\nvoid I2CDeviceCalibration ( ){ //read calibration coefficients \n\nint j=0; \n\n/* I2CSerialReadInt is a function to read two bytes, higher and lower bytes. The function returns a 16-bit integer value*/ \n\nfor (int j= CALIBCOEFF_ADDRESS [0], j <= CALIBCOEFF_ADDRESS [10], j = j +2) { calibCoeff [j] = I2CSerialReadInt (CALIBCOEFF_ADDRESS [j]); \n\n} \n\nfloat DeviceSensedResult (observedValue ) { \n\n//Write statements for using calibration coefficients \n\n. \n\nreturn observedCValue; . \n\n} \n\ntest ( ) { \n\n//Write statements for testing the result . \n\n. \n\nreturn observedCValue; . \n\n/*************************************************************************/ Step 2: Program codes for setup() \n\nvoid setup ( ) { \n\nint observedValue0, observedCValue0, \n\nSerial.begin (9600); //Let UART mode baud rate = 9600 for serial monitor \n\nSerial.println (\u201c Arduino Program for input for sensor device using I2C protocol\u201d \n\nSerial.println (\u201c Check that Arduino pin SDA bits at pin A4 and serial clock SCL pin A5. \u201d); \n\npinMode (internalLED, OUTPUT); \n\ndigitalWrite (internalLED, HIGH); \n\n//Set I2C serial standard clock rate 100 kHz. \n\n// Write data at I2DEVICE \n\nWire.begin (); \n\n/* Get the eleven calibration Coefficients from the IC*/ \n\nI2CDeviceCalibration ( ); //Read integers for 11 calibration coefficients \n\n/* Declare initial offset, for example, Sensor value when temperature is 0 degree Celsius or pressure is atmospheric pressure or photo-current when dark. */ \n\nobservedValue0 = 0; // Declare the initial value of the parameter \n\n/* Calculate sensed Offset value result using calibCoeffs. */ \n\nobservedCValue0 = DeviceSensedResult (observedValue0); \n\nPrototyping and Designing the Software for IoT Applications 349 \n\n} \n\n/*************************************************************************/ Step 3: Function loop() for the sensor readings and get the temperature values from read value using calibration coefficient \n\nvoid loop () { \n\n//Read Integer at data 1 address \n\n//Read Integrate at data 2 address \n\nobservedValue1 = I2CSerialReadInt (I2DEVICE_DATA1_ADDRESS); \n\nobservedValue2 = I2CSerialReadInt (I2DEVICE_DATA2_ADDRESS); \n\n//find the result for sensed data \n\nobservedCValue1 = DeviceSensedResult (observedValue1); \n\nobservedCValue2 = DeviceSensedResult (observedValue1); \n\n/* Statements for Serial Print of the result at Serial Monitor. */ \n\n. \n\n. \n\n/* Write Statements for delay as per intervals between successive data 1 and data 2 readings*/ \n\n. \n\n. \n\n/* Test function Statements for the test of status of running the program */ \n\ntest ( ); \n\n} \n\nUsing Cloud  Library at  Xively \n\nPaho, earlier known as Cosm, is now called Xively. Xively cloud platform is an application development platform. The cloud platform has library functions, which enable programming for web services, applications and APIs. The applications and APIs may be written in C/C++, Java, Python, dot Net, JavaScript, Perl, PHP or Ruby. \n\nUsing an OS \n\nOS is a system software for managing the processes, memory, IOs, network subsystems and devices management. The OS consists of system functions for priorities, multitasking or running a number of threads, and many system functions using given computing device hardware. \n\nLinux distribution libraries are for using Linux OS as a package or set of functions and modules bundled together for specific functions or for specific hardware and distributed for wider usages and applications. For example, in Arduino, mBed, microcontroller circuits and embedded device platforms. \n\n350 Internet of Things: Architecture and Design Principles \n\nArduino Yun board has loaded Linux-distribution for Arduino into it. Computer used for Arduino IDE downloads the Arduino Linux distribution for running at the Arduino, and then use it as the OS for developing Arduino application programs. Around 256 kB of RAM is required for this purpose. \n\nA code developer can use FreeRTOS or DuinOS for Arduino versions due to their smaller memory needs. \n\nMultitasking \n\nA multitasking environment consists of multiple processes, tasks or threads. A process, task or thread consists of a set of instructions that runs under OS control (supervision). An OS has multitasking (multithreading) functions and many other system functions. \n\nUsing Threads \n\nConsider four delay instructions in the program given in Example 9.2. During the period for delay, the system is just waiting for a preset period to elapse. Consider a  set of instructions before each delay as one thread, and other sets of instructions and other threads. When the OS is multitasking, then the delay period is utilised in running other in sequence or next to present one priority thread(s). The delay function is a system function and is called sleep() or OS_Delay() function of the OS. The sleep function makes a system call to OS to block that thread from running for the preset delay period. The sleep function argument specifies that period. \n\nThe OS threads can run in sequences when each thread has normal priority. OS can also be made to run such threads for a specified time slice in each cycle of thread run sequences. \n\nUsing Real-time Thread Scheduling Library \n\nAn RTOS consists of threads, each thread is assigned with a specific priority level, and when a higher priority thread activates, then the system pre-empts the lower priority thread. \n\nA set of built-in functions for real-time scheduling (switching) enable the threads scheduling. A real-time thread-scheduling library is provided in system software.  An example of the scheduling library is Atomthreads library which is downloadable online.11 \n\nUsing GNU C Library Version \n\nA version of GNU C library enables Linux OS platforms at the microcontroller (mC) in an embedded device. An example is uClib, which is downloadable from the university website.12 \n\nExample 9.7 shows the usage of OS multithreading functions with each thread assigned normal priority. \n\n11 http://www.atomthreads.com 12 http://www.uclibc.com \n\nPrototyping and Designing the Software for IoT Applications 351 \n\nExample 9.7 \n\nProblem Programming of Arduino controlled traffic-control lights using multi-threading OS functions: \n\nReconsider Example 9.2. How will the OS multithreading functions be programmed? \n\nSolution \n\nStep 1: Program codes for pre-processing declarations for inclusions and  declarations of data types and functions. \n\n/* include Posix Thread library functions in Linux distribution or include functions of OS being used */ \n\n# include <pthread.h> \n\n// declare thread delete request false to disable delete of the thread(s) \n\nbool delete_request false \n\n// Define class named LightsThread for Traffic Lights Project \n\n/*-------------------------------------------------------------------------*/ Step 2: Program codes for declaring class for a thread and creation of threads. \n\nclass SeqThread : public PThread { \n\n// Each SeqThread has an integer variable ID \n\npublic SeqThread (int threadID); \n\n// Declare loop ( ) either returns a Boolean variable: true or false \n\nprotected bool loop ( ); \n\n// threadID is an integer variable specific to a specific SeqThread object \n\nprivate int threadID; \n\n} \n\nSeqThread : : SeqThread (int threadID) { \n\nthis -> threadID = threadID; // Assign threadID number to this SeqThread \n\n} \n\n/*-------------------------------------------------------------------------*/ Step 3: Program codes for setup() for creating a main_thread_list  consisting of numseqthread sequentially executing threads and write statements in each thread. \n\nvoid setup () { \n\n/* Create specified number of seqthreads.  LightsThread class objects run at loop () and return true or false */ \n\n//Define nine Created seqThread (1), seqThread (2), \u2026\u2026seqThread (9) \n\n/* Each thread has ID from 1 to 9.*/ \n\nint numseqthread = 9; //declare number of sequential running threads \n\n/*Write statements for the eight SeqThread objects of class SeqThread  for the functions in Examples 9.1 and 9.2*/ \n\n/* SeqThread (1) waits of signal 1 and runs Function north_south_Green () and Function east_west_Red () */ \n\n. \n\n352 Internet of Things: Architecture and Design Principles \n\n/*SeqThread (2) runs Function delay (30000) and sends signal to enable start of next thread (3) */ \n\n. \n\n/*SeqThread (3) waits of signal 3 and runs Function north_south_Yellow () */ \n\n.. \n\n/*SeqThread (4) runs Function delay (10000) and send signals to enable start of next thread (5) */ \n\n. \n\n/* SeqThread (5) waits of signal 5, runs Function east_west_Green () and Function north_south_Red () */ \n\n. \n\n/*SeqThread (6) runs Function delay (30000) and sends signal to enable start of next thread (7)*/ \n\n. \n\n// SeqThread (7) waits for signal 7 and runs Function east_west_Yellow () \n\n. \n\n/*SeqThread (8) waits for signal 8, runs Function sleep (10000) and at the end sends signal to enable start of next thread (9) */ \n\n. \n\n/*SeqThread (9) waits for  signal 9, runs, calls Function test ( ) next and at the end send signal to enable start of thread (1) in next sequences cycle */ \n\n. \n\n/*Use a Boolean variable delete_request false to create the threads and run loop */ \n\nif (delete_request = = false ) { \n\nfor (int i = 1; i <= numseqthread; i++) { \n\nmain_thread_list -> add_thread (new SeqThread (i))}; \n\n} \n\n/*delete_request if returned true from the loop then delete the threads to free the memory */ \n\nif (delete_request = = true) { \n\nfor (int i = 1; i <= numseqthread; i++) { \n\npthread_delete (SeqThread (threadID)); } \n\n} \n\n} \n\n/*-------------------------------------------------------------------------*/ Step 4: Follows for loop() statements of the program running all nine threads at the  main_thread_list \n\nbool SeqThread :: loop () { \n\n/* OS runs all nine threads at the main_thread_list as long as loop return Boolean variable is true*/ \n\n// check for delete_request true \n\nif (delete_request) return false; \n\nPrototyping and Designing the Software for IoT Applications 353 \n\n/*loops keep running and show status until returns the loop ( ) returns false \n\ninternalLED keep flashing Low from High after the end of a sequence cycle \n\ndue to the test Seqthread (9) */ \n\n} \n\n/*-------------------------------------------------------------------------*/ \n\n9.2.3  Programming Embedded Galileo, Raspberry Pi, BeagleBone and mBed \n\nDevice Platforms \n\nDevelopment of programs is done using an IDE. The cycles of edit-test-debug are used until the simulated results show the successful test runs of the programs. Following are the details for popular device platforms. \n\nIntel Galileo IDE \n\nIntel Galileo IDE for Windows is downloadable from the Galileo website.13 Intel Galileo and Arduino combined features are: \n\n\u25cfSimilarity of IDE with Arduino: Galileo adds Arduino X86 board and new IDE also enables firmware upgrading the board. \n\n\u25cfCompatibility: Compatible with Arduino shields and similar ICSP header, serial port, 14 digital I/O pins and 6 analog inputs \n\n\u25cfEthernet Library: Compatible in usability with Arduino\u2019s Ethernet library and can connect with HTTP connection using standard WebClient example \n\n\u25cfPCI Express Mini Cards: Can connect to GSM, Bluetooth, WiFi cards using Arduino\u2019s WiFi library. \n\n\u25cfUSB Host Port: USB is a dedicated port and usable with Arduino USB Host library and keyboard or mouse connection to computers. \n\n\u25cfTWI/I2C, SPI Support, Serial Connectivity and MicroSD Support: Compatible with standard Arduino libraries. \n\n\u25cfLinux distribution running on board: Just 8 MB flash enables node.js (for web projects), sound tools: ALSA, video tools: V4L2, Python, SSH, computer vision openCV \n\nRaspberry Pi IDE \n\nRaspberry Pi (RPi) provides a smart-card-size computing system with media co-processors. A developer can work with the standard keyboard and display.  The Pi supports number of languages including Python. Readily available libraries PyPi are for RPi programming using Python. RPi supports OS Raspbian Ubuntu distribution of Linux (also known as Snappy) and has features of securely running the autonomous machines, M2M and IoT devices. \n\n13 https://downloadcenter.intel.com/download/24355/Intel-Arduino-IDE-1-6-0 \n\nRPi programming using \n\nAdafruit, BlueJIDE or \n\nNinjaIDE \n\n354 Internet of Things: Architecture and Design Principles \n\nNumber of IDEs is available for developing computing devices with media capabilities. Following are the popular ones: \n\nAdafruitIDE is a web-based IDE.14 The IDE provides a web-based development environment. RPi connects to LAN and coding can be done using Python, JavaScript or Ruby languages. Adafruit also provides a customised OS in place of Raspbian that functions with keyboard and displays monitor connected with RPi. A secure shell (SSH) for cryptographic network protocol for the application layer enables remote login and remote connections of the systems, keyboard and monitor. \n\nBlueJIDE is a Java-based IDE at BlueJIDE.15BlueJIDE runs with the help of Java Development Kit, and apart from this also runs the Java programs including Java 8 on RPi using PI4J library. \n\nNinja-IDE source16 is an IDE which stands for not-just-another IDE. Ninja enables the uses of file functions as well building of applications in Python. It runs in cross-platform environment, RPi as well as Linux, Windows and Mac OSX. Its features are: \n\n\u25cfAbility to create plugins, thus extend code editor functionalities, assistance for project development and load several plugins\u2019 widgets for multi-purposes. \n\n\u25cfCode editing with multiple languages, code assistant for code completion, code navigation, web navigation and imports from anywhere, contextual menu in tabs to perform quick actions, code jumps, breakpoints and bookmarks navigation implementation, profile manager, code error finder and static error files detection. \n\n\u25cfCode locator for fast and direct access to a class, function or file with pop up over the text fields. \n\n\u25cfSymbol exporter, files and file usages finder, web inspector and virtualenv have been added, which can be specified in the project creation from Ninja IDE or for an existing project in Project Properties. \n\n\u25cfSupports use of a console for embedded Python. Console manages Python project automatically. It allows the user to perform file management related task in the IDE itself and saves the description of the project files itself. Section 9.3 will describe Java coding using Eclipse Pi4J. Example 9.10 will explain how to program RPi board using eclipse Pi4J implementation. \n\nBeagleBone IDE \n\nRecapitulate Section 8.3.5 for details of BB board for development. BB capabilities extend using capes, just as Arduino by shields. BB extensions provide two 46-pin dual-row expansion headers, motor control, prototyping, battery power, Ethernet, MicroHDMI, VGA, LCD, USB host and USB client for power and communication and other functions. One can work with a standard keyboard. \n\nBB supports autonomous machines, M2M and IoT devices. BB has features of running \n\n14 https://learn.adafruit.com/webide/overview 15 http://www.bluej.org/raspberrypi/index.html 16 http://ninja-ide.org/ \n\nPrototyping and Designing the Software for IoT Applications 355 \n\ncloud-based IDE and Node.js web BoneScript library functions.17 The BB supports Ubuntu, Android and Debian. Node.js is a JavaScript platform for building scripts using rich libraries and networking and real-time capabilities. \n\nBeagleBone development supports usages C/C++ Toolchain with a gcc Cross Compiler from linaro.org and the Eclipse IDE in Windows. \n\nmBed IDE \n\nRecapitulate Section 8.3.6 mBed ARM\u00ae has online IDE, an open extensible source code which includes schematics, software, middleware and C/C++ software platform tools. A web browser is used on computer hosting the IDE that uses ARMCC C/C++ compiler at cloud. The tools enable use of MCU firmware core libraries, peripheral drivers, networking, RTOS runtime environment, build tools and test and debug scripts. The IDE enables a developer to develop the applications on mBed platform for the IoT/M2M. IDE latest version and appropriate OS are open source Eclipse and include GCC ARM embedded tools. \n\nThe mBed OS provides a C++ application framework with the ARM mBed community libraries to create device applications, component architecture and facilitation of automated power management. \n\n9.2.4 Programming Embedded Device Platforms for Internet Connectivity \n\nUsing the Ethernet and WiFi Libraries \n\nArduino Ethernet Library and header files in the library enable the usage of Serial IO functions between Arduino SPI port, IO utility, Ethernet shield, Ethernet client, Ethernet server, DNS, vDHCP and UDP protocol functions. \n\nUsing IP Library \n\nIP library is used when a set of built-in codes and the codes which enable use of the functions of the library for creating stack for the TCP/IP protocols based communication are needed. Examples of IP library functions are (i) lwIP (lightweight Internet Protocol) which enables TCP/IP communication with the little memory requirements (nearly 40 kB flash/ ROM and few tens of kB RAM). The library is downloadable from library website18 and (ii) \u03bcIP (micro Internet protocol library functions enable TCP/IP communication with very little memory requirements (few kB RAM) and for use when buffering of packets is not required. When a small amount of data communicates then buffering is not required. Usage of buffering in communication is for incoming packets and for outgoing unacknowledged packets. \n\n17 https://www.c9.io 18 http://www.savannah.nongnu.org/projrcts/lwip/ \n\n356 Internet of Things: Architecture and Design Principles \n\nUsing Cryptographic Library \n\nSecurity of data from embedded device platforms is of high importance in web applications and services. Assume that the device-end has a user ID, say A1 for authentication at another end. A cloud, web application or service end has an application ID, say A2 for authentication at the user\u2019s end. \n\nThe A1 needs to store at the application or service end database and A2 needs to store at the user-end database. A1 communicates for authentication at the other end. The application matches received A1 with the database stored A1. If a match is successful, then the user end stands authenticated. \n\nTwo security risks are\u2014one is during communication to the other end, some system in-between, such as, a switch or router or server S1 reads A1 or A2 received from another end and resends the same to the authentication end. Another security risk is that some system modifies A1. The application will authenticate the S1 authentication code in place of the user end. Similarly, the user end can wrongly authenticate the application or get a modified text. \n\nTwo basic requirements are thus authentication and encryption of data. Cryptographic library is used when a set of built-in codes and the codes which enable use of the cryptographic functions, like OAuth 1.0 protocol functions are needed. The OAuth 1.0 functions enable securing the data from modifications or replaying that by some other software. \n\nA library, called cryptosuite is downloadable online.19 Encryption key length can be 128, 192 or 256. Data encryption can use AES256 (Advanced Encryption Standard 256-bit encryption key length) or DES (Data Encryption Standard). Arduino AES 256 library is downloadable and used for Arduino boards. \n\nAdding Security and Authentication \n\nSecuring Communication of Authentication Code (Secret Key) \n\nSecurity adds in the authentication code A1 when hash of A1 H (A1) communicates to the application end and application matches the stored H(A1) with the received H(A1). \n\nSecurity adds by communicating hash of A1 or secret key (a text string) in place of communicating plain text string. A function, called hash function creates a fixed length string, called hash of the input string, for example of A1. The H(A1) uses the original string, say A1. User communicates H(A1) in place of original A1. \n\nThe application or service end stores the H(A1) for identifying string A1. A1 cannot be identified from stored H(A1) when that mismatches with the received H(A1) at that end. Assume H(A1) changes to H\u2019(A1) due to in-between modification. The received H\u2019(A1) \n\n19 http://code.google.com/p/cryptosuite \n\nLibrary functions for secure communication \n\nfor the IoT \n\nAuthentication using a secret key and a hash \n\nfunction in place of communicating a plain \n\ntext string \n\nPrototyping and Designing the Software for IoT Applications 357 \n\nwill not match with stored H(A1). Therefore, the authentication code of user A1 will not be identified. \n\nExamples of the usages of hash function are SHA1/SHA256 secured hash algorithms or MD5 message digest algorithm. Example 9.8 lists the steps involved in the method. \n\nExample 9.8 \n\nProblem Using Hash algorithm for secure communication of authentication codes: \n\nHow will the authentication code be created for communicating securely from an embedded device platform using SHA1 hash function? \n\nHow does the SHA1 used at the application? \n\nSolution \n\n(i) The statements for authentication code from an embedded device platform using a hash function are \n\nas follows: \n\nStep 1: Statements are preprocessor commands, declarations of data types and functions and include the required library files. \n\n/*Cryptographic library functions */ \n\n/*Include <sha1.h>, <sha256.h> or <md5.h> header files*/ \n\n#include <sha1.h> \n\n/*IO utility functions*/ \n\n#include <util.h> \n\n/* The authentication codes declares as set of unsigned integer of 8-bit each at a pointed address */ \n\nuint8_t *authcode \n\n/* The hash authentication codes declares as set of unsigned integer of 8-bit each at a pointed address*/ \n\nuint8_t *hashauthcode \n\n// Assign Values to authcode \n\n. \n\n. \n\n// Write other preprocessor statements \n\n. \n\n. \n\n} \n\n/*************************************************************************/ Step 2 is as follows for setup() statements for initialising SHA1, creating hash code and setup GPIO pin modes. \n\nvoid setup ( ) { \n\nsha1.init ( );// initializes SHA1 \n\nhashauthCode = sha1.result ( ); // creates hash of authentication code, authCode \n\n358 Internet of Things: Architecture and Design Principles \n\npinMode (internalLED, OUTPUT); \n\ndigitalWrite (internalLED, HIGH); \n\n//Write statement for display on Serial Monitor of authentication code \n\nSerial.begin (9600); \n\n. \n\n. \n\n/* Write Statements for display of hash of the authentication code a */ \n\n.. \n\n} \n\n/************************************************************************/ Step 3 is write loop() statements for communication of the code, and test. \n\nvoid loop () { \n\n/* Write Statements for communication of hash of the authentication code */ \n\n. \n\n. \n\ntest ( ); \n\n} \n\n/************************************************************************/ \n\n(ii) The application receives hashauthCodeNew in place of hashauthCode. Then, a Boolean variable mismatch \n\nwill be equal to true when the authentication fails. The preprocessor and loop() statements are: \n\n/* First include the functions from Cryptographic library using pre-processor statement */ \n\n#include <sha1.h>/* or #include <sha256.h> or <md5.h>*/ \n\n/*IO utility functions*/ \n\n#include <util.h> \n\n/* The hash of authentication code used to check the match and new hash received are sets of unsigned integer of 8-bit each at a pointed addresses*/ \n\nuint8_t *hashauthcode, *hashauthcodeNew \n\n/*-------------------------------------------------------------------------*/ \n\nloop ( ) { \n\n/* Write statements for receiving the hashauthCodeNew */ \n\n. \n\n/* Write statements for matching the hashauthCodeNew with stored hashauthcode*/ \n\n. \n\n/* Write statements for receiving the hashauthCode*/ \n\nIf (match_request = true) { \n\nif (hashauthCodeNew == hashauthCode) { \n\nmismatch = false; \n\nPrototyping and Designing the Software for IoT Applications 359 \n\nmatch_request = false; /* Matching is only once and thus cancel the match request */ \n\n} else \n\n{mismatch = true;} \n\n. } \n\nData Encryption and Decryption \n\nData needs protection from read and use by an in-between system. Encryption ensures the protection needs. Uses of standard algorithms, such as AES128, AES192, AES256 or DES enable the encryption and decryption. Example 9.9 explains the statements in C/C++ for using the AES256 encrypting and decrypting algorithms. \n\nExample 9.9 \n\nProblem Encryption of device end messages and decryption at application end: \n\n(i)  How is the encrypted message or sensed data created for secure communication from an embedded \n\ndevice platform? \n\n(ii) How does the message decrypt at the application end? \n\nSolution \n\n(i) The statements for authentication code from an embedded device platform using a hash function are: \n\nStep 1: Preprocessor commands, declarations of data types and functions and include the required library files. \n\n/* First include the functions from Cryptographic library using pre-processor statement */ \n\n#include <aes256.h> \n\n/*IO utility functions*/ \n\n#include <util.h> \n\n/* Contextual parameters Data type declaration */ \n\naes256_context context /* Number of contextual parameters required that enables AES algorithm execute. These save at the pointed address context*/ \n\n. \n\n. \n\n// Write other preprocessor declarations \n\n. \n\n. \n\n} \n\n/*************************************************************************/ \n\n360 Internet of Things: Architecture and Design Principles \n\nStep 2 is as follows for setup() statements for 256-bit key and message string. \n\nvoid setup ( ) { \n\nuint8_t key [ ] = {\u2026, \u2026., \u2026.., \u2026\u2026, \u2026\u2026}/* Curly bracket has key of thirty two 8-bit unsigned integer numbers, each number separates by a comma. */ \n\naes256.init (&context, key);// initializes AES256 \n\nchar *message = \u201c\u2026\u2026\u2026\u201d// Assign Message characters for communication \n\n/*Write statement for display on Serial Monitor of authentication code */ \n\naes256_encrypt_ecb (&context, (uint8_t) message); \n\nSerial.begin (9600); \n\n. \n\n. \n\n/* Write Statements for display of encrypted message */ \n\n.. \n\n} \n\n/*************************************************************************/ \n\nvoid loop () { \n\n/* Write Statements for communication of encrypted message */ \n\n. \n\n. \n\ntest ( ); \n\n} (ii) Assume that the application receives the encrypted message. The statements for decrypting can be: \n\n#include <aes256.h> /* First include the functions from Cryptographic library using pre-processor statement */ \n\n#include <util.h> /*IO utility functions*/ \n\naes256_context context /* Number of contextual parameters required during execution of AES algorithm. These save at the pointed address context*/ \n\nchar *message = \u201c\u2026\u2026\u2026\u201d// Assign Message characters for communication \n\n. \n\n// Write other preprocessor statements \n\n. \n\n. \n\n} \n\n/*************************************************************************/ Step 2 is as follows for setup() statements for 32 bit key. \n\nvoid setup ( ) { \n\nPrototyping and Designing the Software for IoT Applications 361 \n\nuint8_t key [ ] = {\u2026, \u2026., \u2026..}/* Curly bracket has key of thirty two 8-bit unsigned integer numbers, each number separated by comma. */ \n\naes256.init (&context, key) ;// initializes AES256 \n\nSerial.begin (9600); \n\n. \n\n. \n\n} \n\nloop ( ) { \n\n// Write statements for receiving the message for decryption \n\n. \n\n. \n\naes256_decrypt_ecb (&context, (uint8_t) message); \n\naes256_done (&context); /* It ends the initialized AES256*/ \n\n. \n\n/* Write Statements for display of decrypted message on serial monitor*/ \n\n.. \n\n// Write statements for test ( ). \n\n} \n\nReconfirm Your Understanding \n\n\u25cfIDE enables development of embedded device software. Arduino IDE has simplicity and is based on processing language and wiring library functions. \n\n\u25cfSimplicity of Arduino is clear from the fact that only two functions are necessary to define the executable program functions for the device, namely, setup() and loop(). A serial monitor at the IDE consisting computer enables the results from the serial port at a device platform. The developed software at the computer also downloads into the device using the port. \n\n\u25cfA traffic-lights monitoring program shows how to (i) program setup() and loop() functions using Arduino IDE C/C++ for programming the GPIO pins, (ii) control the intervals between three states of each pathway using delay() function, and (iii) test using serial monitor and testing of the program functions. \n\n\u25cfNumber of library functions provide ease in programming. Usages of timer and software serial libraries show how to program for (i) the timer functions, (ii) reading of RFID ID tag using UART functions, and (iii) I2C communication between sensor communicating sensed data using I2C and Arduino I2C port. \n\n\u25cfWhen multiple threads of a program execute on a device platform, an OS provides for system calls for these functions. Rewriting of Arduino controlled traffic control lights monitoring program shows how to program using multi-threading OS functions. \n\n\u25cfIntel-Arduino IDE functions enable development of embedded device software for Intel Galileo device platform. \n\n362 Internet of Things: Architecture and Design Principles \n\n\u25cfOS Raspbian Ubuntu distribution of\u00a0 Linux, Snappy enables programming for secure running of autonomous machines, M2M and IoT devices using RPi. \n\n\u25cfA web-based IDE Adafruit enables development of embedded device software for RPi as well as BB. \n\n\u25cfBlueJIDE is a Java based IDE for RPi. \n\n\u25cfNinja-IDE is IDE for RPi enabling development of embedded device software at Windows, Mac OX and Linux cross platform environments. The Ninja enables file functions as well for building applications in Python using an embedded Python console. \n\n\u25cfIDE and OS distributions for BB enable the embedded software development. \n\n\u25cfThings communicate to the Internet using functions at Ethernet, WiFi and IP. \n\n\u25cfThings communicate securely using crypto-library functions. \n\n\u25cfThe crypto-library functions enable the programming, secure communication of data for IoT. Two security risks are taken care by (i) using a secret key and its secure communication, (ii) using encryption and decryption functions, such as AES128, AES192, AES256 or DES). \n\nSelf-Assessment Exercise \n\n1. Why does prototyping embedded software become easy using an IDE for a \n\ndevice platform? 2. List the steps used in the traffic light program, function loop() in Example 9.1. 3. Write a program to read three digital inputs, viz. 1-bit for streetlight working \n\nstatus (Yes or No), 1-bit for ambient surrounding light status (insufficient or not insufficient) and three bits for traffic density level using Arduino IDE and device platform. 4. How will you use the library functions to call a function action1() after a preset \n\ninterval of 1s and another after 3s from the start? Use Example 9.4 as hint. 5. List the soft serial library functions for Arduino and write their usages. 6. When does a device platform use UART, I2C and SPI bus for communicating \n\nwith a sensor? 7. Using Example 9.7, write the advantages of using the threads functions of the \n\nOS. 8. List additional features in Intel Galileo device platform over Arduino. 9. Tabulate for comparing the usages and features of IDEs for Raspberry Pi. 10. Show the steps in software for communicating the data stores at the device \n\nplatform over the Internet using Ethernet library functions using Example 8.5. 11. List security risks when communicating a secret key over Internet. 12. List and write usages of the cryptolibrary functions for secure communication \n\nof the data over Internet. \n\n\u2605 \n\n\u2605\u2605 \u2605\u2605\u2605 \n\n\u2605 \n\n\u2605 \u2605\u2605 \n\n\u2605\u2605\u2605 \n\n\u2605\u2605 \u2605\u2605\u2605 \n\n\u2605 \n\n\u2605 \u2605\u2605\u2605 \n\nNote: \u2605 Level 1 & Level 2 category \u2605\u2605 Level 3 & Level 4 category \u2605\u2605\u2605 Level 5 & Level 6 category \n\n\n![Image](/src/assets/generated_images/iot2_p389_i0.png)\n\nPrototyping and Designing the Software for IoT Applications 363 \n\n9.3 DEVICES, GATEWAYS, INTERNET AND WEB/CLOUD SERVICES SOFTWARE- DEVELOPMENT \n\nRecall Chapter 3\u2014connected devices in IoT/M2M use the CoAP and LWM2M web-communication protocols and messaging-protocols, such as message-cache, Message Queue Telemetry Transport (MQTT), and Extensible Messaging and Presence (XMPP). MQTT is a publish/subscribe (Pub/Sub) protocol. The devices connect, network and communicate over the web. They use the communication gateway, SOAP, REST, RESTful HTTP and WebSockets. Figure 3.1 showed the connected devices, protocols and usages of the Internet in IoT/M2M applications and services. \n\nFigure 9.1 shows five levels for software development for applications and services in the IoT or M2M. The software needs are for the devices, local network, gateway, cloud/ web connectivity and web/cloud APIs. \n\n\u2026\u2026\u2026 \n\nDevice 1 \n\n\u2026\u2026.. \n\nDevice 2 \n\nDevice i \n\n10s of Bytes \n\n10s of Bytes \n\n10s of Bytes \n\n100s of Bytes \n\nServer \n\n1: Physical/Data Link and Adaptation Layers Software using IDE \n\nDTLS \n\nUDP \n\nDTLS \n\nIP TLS \n\nHTTP Server \n\nWeb Object Web Object \n\nClient \n\nServer \n\nTCP \n\nROLL \n\nhttp://....... \n\n. \n\nhttp://........ \n\nlwm2m:// or coap://........ \n\nMQTT, \n\nCoAP LWM2M 6LowPAN, ZigBee NAN \n\nBluetooth \n\nSmart IP ZigBee IP \n\nIP LPWAN \n\nHTTP Client \n\n3: Network and Transport Layers Software \n\n10s of Bytes \n\n1000s of Bytes \n\nUDP Client \n\nlwm2m:// or coap://........ \n\n4: Application Support Layer APIs/Software \n\n5: Application Layers APIs /Software \n\n2: IoT or M2M Area Local Network and Gateway Software \n\nWireless: Bluetooth LE, ZigBee, LPWAN, Wi-Fi or Wired: UART, USB, I2C, SPI, SDIO or Ethernet \n\nWeb Connectivity/ \n\nCloud Connectivity, \n\nAPIs, Web Applications, WebSockets, \n\nAnalytics, Visualisation \n\nKnowledge \n\nDiscovery \n\nSoftware \n\nFigure 9.1 Five levels for software development for applications and services for IoT or M2M \n\nSoftware, such as Eclipse IoT, enable the development of software for the first, second and third levels. The software enables the device gateways connectivity to the Internet and cloud server. Eclipse IoT enables open source implementations of IoT protocols. The implementable protocols include MQTT \n\nAnalyse and \n\nprogram the devices, gateways, Internet connectivity, \n\nweb and cloud applications using \n\nthe open-source implementations of \n\nEclipse IoT stack \n\nLO 9.2 \n\nEclipse IoT stack for five levels of software \n\ndevelopment for the \n\napplications and services in IoT/M2M \n\n364 Internet of Things: Architecture and Design Principles \n\nCoAP, OMA-DM and OMA LWM2M and Internet connectivity protocols (Sections 3.2, 3.4 and 4.2). \n\n9.3.1 Use of Software Stack for an Intended Complete Solution \n\nSection 9.2 discussed the first-level software. Now consider the software for higher levels. Each level has characteristic complexity and fragments. Recall Sections 3.3 to 3.5. The connected devices use a variety of protocols, such as LWM2M, CoAP, MQTT, and methods for connecting to the web. Web communication uses the Gateway, SOAP, REST, RESTful HTTP and WebSockets functions. \n\nA stack is a full set, consisting of frameworks, applications and services that are minimum needs for intended complete solution. Following sections describe Eclipse IoT (www.iot.eclipse.org) stack for end-to-end IoT/M2M solutions. \n\n9.3.2 End-to-End IoT Solutions with Java using Eclipse IoT Stack \n\nOpen Services Gateway Initiative (OSGi) (now OSGi Alliance) provides and maintains open standard specifications.  OSGi describes the specification of management of Java packages/classes in a modular system, which enables the implementation of a complete and dynamic component model.  A component means software which can reuse a core set of frameworks and services for provisioning the solutions. The components and applications deploy in the form of bundles and can be remotely installed, started, stopped, updated, and uninstalled without requiring system reboot.20 \n\nOSGi in addition gives specifications for service platforms in Java language. The component or application life-cycle management uses a set of APIs. When a service registers, then service bundles detect the deletion or addition of new services and get adapted. \n\nOSGi in addition to original focus, now has evolved specifications far beyond the gateways, such as eventing, configuration management, clock, crypto (aes, base64, sha-1), geolocation data, cloud and application servers and services for the connect and manage functions. \n\nOSGi thus find applications for the management of Java packages and classes. Examples of applications and services are fleet management, automobiles, automobiles, smart phones and now in IoT/M2M solutions. \n\nEclipse IDE is an application using OSGi specifications. Eclipse open IoT stack is a set of Java frameworks, protocols, development tools and OSGi services. The features of Eclipse IoT stack are: \n\n\u25cfProvides open source specifications which are as per open OSGi standard specifications \n\n20 https://en.wikipedia.org/wiki/OSGi \n\nOSGi service functions \n\nfor Clock, Crypto (AES, base64, SHA-1), \n\nGeolocation, Data and \n\nCloud Services \n\nPrototyping and Designing the Software for IoT Applications 365 \n\n\u25cfProvisions for simpler open source implementations, and programs, services and bundles development using the open source Java frameworks and services \n\n\u25cfConsists of the components and frameworks for IoT solutions. The stack takes care of the complexity of creating IoT solutions and enables fast development of the solutions \n\n\u25cfProvisions for open source technologies which enables easy programming in Java for the device platforms, and running the codes in JVM or Eclipse Concierge (a lightweight implementation of OSGi runtime) \n\n\u25cfEnables usages of protocol functions provided in lightweight M2M (OMA M2M standard), MQTT (OASIS IoT standard), CoAP (IETF IoT standard) and standard network protocols. The functions provide the connectivity and interoperability of the device gateways \n\n\u25cfProvisions the IoT gateway services for remote management and applications management \n\n\u25cfProvisions for new solutions for devices connectivity to the Internet and the remote management and application management functions and APIs for using server or cloud provided functions \n\n\u25cfSupport of large number of institutions including Cisco and IBM Eclipse IoT stack includes device platform for physical/data-link and adaptation layers. Table 9.1 gives the implementations and frameworks for (Gather + Consolidate) and local network and gateway software (connect) levels. \n\nTable 9.1 Eclipse implementations and frameworks included in Eclipse IoT stack \n\nEclipse Implementation/Framework Description \n\nEclipse Pi4J A framework based on WiringPi and PiFace, Gertboard and other shields, which support the I2C/SPI/GPIO interfaces in sensors, actuators and device platforms, for the RPi. Similar framework is for BB platform and capes used with BB. \n\nEclipse Koneki A set of functions for embedded Lua language based development of device applications. \n\nEclipse Mihini An embedded Lua runtime which provides provisions for hardware abstraction and other services. \n\nEclipse Krikkit Provisions a system of rules when programming edge devices. For example, when configuring the device platforms. \n\nIt is beyond the scope here to cover each Eclipse IoT component for device platforms. Following section describes the usages of Pi4J components. \n\n366 Internet of Things: Architecture and Design Principles \n\nEclipse.Pi4J \n\nRPi board has 8 \u00d7 GPIO plus the following, which can also be used as GPIO: UART, I2C bus, SPI bus with two chip selects, I2S audio, +3.3 V, +5 V and ground pins. Example 9.10 gives an Eclipse Pi4J implementation of GPIO/I2C/SPI protocols using RPi device platform. \n\nExample 9.10 \n\nProblem Programming of RPi board using the eclipses Pi4J implementation: \n\nAssume RPi board (Section 8.3.1) as embedded device platform. Assume that GEN0 to GEN6 are the GPIO dedicated pins in a given board. How are GPIO pins setup using Pi4J?  When a GPIO_01 pin connects status LED, how will the port GEN_1 LED be programmed? When a GPIO pin connects traffic red, yellow and green lights, how will the port GPIO_02, GPIO_03 and GPIO_04 be programmed? Solution \n\nExample of program codes which embeds onto RPi are as follows: \n\nStep 1 statements are constructors and methods. \n\nimport // Import Pi4J from www.eclipse.org \n\n/* A gpio object specified. */ \n\nGpioController gpio = GpioFactory.getInstance ( ); \n\n/* gpio object method for RPi pin GPIO_01 named status LED setting in state HIGH. */ \n\nGpioPinDigitalOutputPin pin01 = gpio.provisionDigitalOutputPin (RaspiPin, GPIO_01, \u201cstatusLED\u201d, PinState.HIGH); \n\n/* pin01 to be set LOW after 2000 ms) */ \n\nThread.sleep (2000); \n\npin01.low ( ); ; \n\n/* Return */ \n\ngpio.shutdown ( ); \n\n/*******************************************************************/ Step 2 statements are gpio object specifications using constructors, and methods of sleep, low and high. \n\n/* Four gpio pin objects, pin02, pin03 and pin04 specified. */ \n\nGpioController gpio = GpioFactory.getInstance ( ); \n\n/* gpio object initialization methods for RPi pin GPIO_02, named as REDLED setting in state HIGH and Other two in LOW states at the start. */ \n\nGpioPinDigitalOutputPin pin02 = gpio.provisionDigitalOutputPin (RaspiPin, GPIO_02, \u201cREDLED\u201d, PinState.HIGH); \n\nPrototyping and Designing the Software for IoT Applications 367 \n\nGpioPinDigitalOutputPin pin03 = gpio.provisionDigitalOutputPin (RaspiPin, GPIO_03, \u201cYELLOWLED\u201d, PinState.LOW); \n\nGpioPinDigitalOutputPin pin04 = gpio.provisionDigitalOutputPin (RaspiPin, GPIO_04, \u201cREDLED\u201d, PinState.LOW); \n\n/* pin02 to be set LOW after 30000 ms and pin03 to be set HIGH) */ \n\nThread.sleep (30000); \n\npin02.low ( ); \n\npin03.high ( ); \n\n/* pin03 to be set LOW after 5000 ms and pin04 to be set HIGH) */ \n\nThread.sleep (5000); \n\npin03.low ( ); \n\npin04.high ( ); \n\n/* One Cycle completes on one pathway */ \n\nEclipse IoT stack includes gateway, network, transport and application-support layers. Table 9.2 gives the implementations and frameworks for gateway software (connect) and network and transport layers software (Connect + Assemble + Manage). \n\nTable 9.2  Eclipse implementations and frameworks included in Eclipse IoT stack for gateway, network, \n\ntransport and Application-Support layers 21 \n\nEclipse Implementation/ Framework \n\nFunctions for IoT/M2M Description \n\nEclipse Wakkamma LWM2M clients with LWM2M server \n\nA set of library functions for LWM2M in a \u2018C\u2019 implementation. \n\nEclipse Californium CoAP clients. Secure DTLS and CoAP server \n\nAn implementation in Java of CoAP, including DTLS for IoT security.) A Californium-based sandbox server can register the CoAP clients. The server (CoAP://iot.eclipse.org:5683) also interacts with CoAP clients. \n\nEclipse Lehshan LWM2M clients. Secure DTLS and LWM2M sandbox server \n\nJava implementation of LWM2M for device management in Java and includes DTLS for IoT security. A Lehshan-based sandbox server can register the LWM2M clients. The server (coap:// iot.eclipse.org:5684) interacts with the client Web UI and REST API. The server interacts with registered LWM2M clients.21 \n\n21 http://www.iot.eclipse.org/lwm2m \n\n(Contd.) \n\n368 Internet of Things: Architecture and Design Principles \n\nEclipse Moquette C MQTT clients at devices and applications in pub/ sub mode using TCP and Sandbox server \n\nAn implementation in \u2018C\u2019 of the publish/subscribe protocol MQTT using TCP. A sandbox server (tcp:// m2m.eclipse.org:1883).at cloud/web interacts with MQTT clients at an application running at a computer/tablet/ mobile phone. \n\nEclipse Paho MQTT clients at devices and applications in pub/ sub mode using a MQTT Broker \n\nA Java implementation of the MQTT client and Moquette which uses a Java MQTT broker (m2m. eclipse.org/paho); Paho also uses the JavaScript, Lua, Python, dot Net, dot net compact, dot net micro, Windows Phone, Android. \n\nEclipse OM2M M2M TEST APIs network, gateway and sandbox server interactions \n\nAn implementation of the ETSI M2M standard. It provides a horizontal service capability layer (SCL) that can be deployed in an M2M network, gateway or device. M3DA sandbox server (http://iot. eclipse.org:44900) interacts with REST API (http:// iot.eclipse.org/m3da) \n\nEclipse Ponte M2M CoAP and MQTT gateways and MQTT- MQTT broker and MQTT- CoAP broker \n\nA framework based on Java and OSGi services for IoT and M2M Gateways. Ponte gateway includes bridge between the M2M/IoT protocols, for example, between MQTT and CoAP protocols using devices to the Web. Ponte broker functions connect the MQTT device platform applications network at one end with the CoAP device platform applications network at another end (Section 3.3). \n\nEclipse Jetty WebSockets bi-directional communication \n\nA set of Java methods and annotations for WebSocket objects creation and sessions (Sections 3.4.5 and 9.4)* \n\nEclipse Kura Gateways. Services, cloud connectivity, management of device, network configuration and application \n\nA set of OSGi based application framework and services for building IoT and M2M gateways. Services include (i) device abstraction, CAN bus for automotive embedded devices, configuration management, and integrated device cloud functions, and (ii) provides application portability, modularity and application management and provisions for built-in OSGi services for IoT apps. \n\n*English meaning of annotation is addition of notes to a page or diagram or picture or painting for better understanding. \n\nPrototyping and Designing the Software for IoT Applications 369 \n\nCovering all components of Eclipse IoT here is beyond the scope of this book. The following section describes the usages of Paho. \n\nEclipse.Paho \n\nRecall Section 3.3.1. A communication mode is request-response mode. An HTTP client makes a request to a server which sends a response. The client is said to pull the required messages (data) in response. When physical devices, such as streetlights exchange data between each other, or when other system, such as a central server or controller, controls them, then data exchanges are just 10s of bytes. The devices need a lightweight method in place of the HTTP. \n\nA communication mode is pub-sub mode. MQTT protocol provides for three objects: MQTT clients at the devices, MQTT broker and MQTT clients at the application(s). Assume that a device, such as a streetlight deploys MQTT client for sending the sensed data and receives commands from the application end through a broker (intermediate server). MQTT-client, unlike HTTP, does not have to pull the messages (commands) which the device needs for its control. An MQTT broker pushes the messages to the client, provided a client has subscribed to those. A broker functions like a dashboard, where the messages first reach from the sources and from there the messages then dispatch to the subscribers (ones who makes a request for the messages being dispatched). \n\nEach MQTT client may be required to use an always connected UDP (or TCP) connection with a broker. The MQTT broker uses buffers for all messages. This facilitates the dispatch when a client reconnects after an interruption. An interruption is always a possibility in ROLL environment. \n\nRecall the example of Internet of Streetlights (Example 1.2) and devices connectivity using five levels (Figure 9.1). Consider use of MQTT Pub/Sub protocol for the connectivity between devices and the application layers. Figure 9.2 shows the connected streetlights publishing the sensed data and subscribing for the control data, and using MQTT clients during communication with the application layer. The figure shows that MQTT clients communicate through an MQTT broker with other clients at the devices or at the applications and central controller. The figure also shows sequence 1, 2, 3 and 4 for message exchanges. \n\nExample 9.11 gives an Eclipse Paho Java implementation of MQTT clients broker architecture. \n\nProgram implementation in Pub/Sub mode for the MQTT clients and \n\nMQTT broker using \n\neclipse Paho \n\n370 Internet of Things: Architecture and Design Principles \n\nExample 9.11 \n\nProblem Communication of sensed data to the applications and central controller for the control of streetlights (Example 1.2) using the Eclipse Paho implementation of MQTT: \n\n(i) Import Java packages for MQTT clients, broker and applications and the Publisher and Subscriber \n\nclasses for constructing the objects for publishing sensed data of the devices, such as streetlights. \n\n(ii) Implement the codes for publisher class for control data from the central controller and sensed data \n\nfrom the devices. \n\n(iii) Implement the codes for subscriber class for subscribing of sensed data by the application/central \n\ncontroller. \n\n(iv) Implement the codes for subscriber class for subscribing of control data by the device clients \n\n(v) Implement the codes for observing \u2018Last Will and Testament\u2019 (LWT) message on disconnection/failure \n\nof communication of messages on topic sensed data and control data and communicating again on reconnection using MQTT broker. \n\n(vi) Implement the codes for threads for publishing the messages for the sensed data. For example, for \n\ntraffic presence and lighting needs in Internet of Streetlights. \n\nApplication Layer \n\nDevices using MQTT Clients \n\nStreetlight \n\nGroup 1 Device 1 \n\nStreetlight \n\nGroup m \n\nDevice i \n\n1:Published Sensed data 10s of Bytes \n\n4:Subscribed Control data 10s of Bytes \n\nPublished Sensed data 10s of Bytes \n\nSubscribed Control data 10s of Bytes \n\nPhysical/Data Link \n\nLayer \n\nAdaptation \n\nLayer \n\nNetwork and Transport Layers \n\nLayer \n\nApplication Support Layer \n\nIoT or M2M \n\nArea Local Network and \n\nGateway \n\nNetwork \n\nand Transport \n\nMQTT \n\nbroker (m2m. eclipse. \n\norg/ paho) \n\n3:Published Control Data \n\nfor the Devices \n\n2:Subscribed \n\nSensed data \n\nof Devices \n\nApplications \n\nand Central \n\nController \n\nApplications and \n\nServices Layer MQTT Clients \n\nFigure 9.2  Connected streetlights publishing the sensed data, subscribing for the control data and \n\nusing MQTT clients during communication with the application layer MQTT clients through an MQTT broker \n\nPrototyping and Designing the Software for IoT Applications 371 \n\n(vii) Implement the codes for publisher and subscriber threads at the devices and application in example \n\nof Internet of Streetlights \n\nSolution \n\nAssume that a Java package is used for \u2018Internet of Streetlights\u2019: Step 1: The program  implements in Paho that imports following packages. \n\nPackage org.eclipse.pahoIoTStreetLights; import org.eclipses.paho.client.mqttv3.MqttClient; import org.eclipses.paho.client.mqttv3.MqttException; \n\nimport org.eclipses.paho.client.mqttv3.MqttMessage; Following are the sets of coding required: \n\n(i) Publisher class for constructing the objects for publishing sensed data of the devices, such as \n\nstreetlights \n\n/*Let first step is that within the class Publisher, declare URL of the MQTT Broker and create instance of class MQTTClient. Use MAC Address as Client_ID for publisher ID and the initialization of the MqttClient instance is as per following code. Use -pubDevice as a suffix for the Client_Id. Following is the Java code for that.*/ \n\npublic class Publisher { \n\npublic static final String MQTT_BROKER_URL = \u201ctcp://broker.mqttdashboard. com:1883\u201d; \n\n/* client is the instance of MqttClient */ \n\nprivate MqttClient client; \n\npublic Publisher() \n\n{ \n\nString p1 = \u201c-pubDevice\u201d; \n\n/* Declare clientDevice_ID using method getMacAddress ( ). */ \n\nString clientDevice_Id = Utils.getMacAddress() + p1; \n\ntry { \n\nmqttClient = new MqttClient(MQTT_BROKER_URL, clientDevice_Id); \n\n} \n\ncatch (MqttException e) { \n\n/* Write codes for callback method */ \n\n/* On exeception, Assume that callback method is print the stack trace. */ \n\ne.printStackTrace(); \n\nSystem.exit(1); \n\n} \n\n} \n\n} \n\n/*********************************************************************/ \n\n372 Internet of Things: Architecture and Design Principles \n\n(ii) Publisher class for publishing control data at the application/central controller Let next step be use MAC Address as Application ID for subscriber ID and the initialisation of \n\nthe\u00a0MqttClient\u00a0instance is almost the same as above publisher above code, except that use-pubApp\u00a0as a suffix for the Client_Id. \n\n(iii) Subscriber class for subscribing of sensed data by the application/central controller Let next step be use MAC Address as Application ID for subscriber ID and the initialisation of \n\na\u00a0MqttClient\u00a0instance is as per publisher codes, except that use\u00a0-subApp\u00a0as a suffix for the Application_ Id. Following is the Java code for that. \n\npublic class Subscriber { \n\npublic static final String MQTT_BROKER_URL = \u201ctcp://broker.mqttdashboard. com:1883\u201d; \n\n/* client is the instance of MqttClient */ \n\nprivate MqttClient client; \n\npublic Subscriber () \n\n{ \n\nString s1 = \u201c-subApp\u201d; \n\n/* Declare client at the Application_ID using method getMacAddress ( ). */ \n\nString Application_ID = Utils.getMacAddress() + s1\u201d; \n\ntry { \n\nmqttClient = new MqttClient(MQTT_BROKER_URL, Application_Id); \n\n} \n\ncatch (MqttException e) { \n\n/* Write codes for callback method */ \n\n/* On exeception, Assume that callback method is print the stack trace. */ \n\ne.printStackTrace(); \n\nSystem.exit(1); \n\n} \n\n} \n\n} \n\n/*********************************************************************/ (iv) Subscriber class for subscribing of control data by the device clients Let the MAC Address be used as Client_ID for subscriber ID and the initialisation of the\u00a0MqttClient\u00a0instance \n\nis almost the same as above subscriber code, except use\u00a0-subDevice\u00a0as a suffix for the Client_Id. (v) Observing LWT message on disconnection/failure of communication of messages on topic sensed data \n\nand control data A disconnection is feasible. A broker needs to detect disconnection by a client. If the clientDevice \n\nhas set a subscription to a message for a topic (for example, SensedData), then when the device reconnects, the broker sends \u2018LWT\u2019 message string to the topic \u2018SensedData\u2019 on reconnection. Similarly, If the clientApplication has set a subscription to a message for a topic (for example, ControlData), then when application reconnects, the broker sends \u2018LWT\u2019 message string to the topic \u2018ControlData\u2019 on reconnection. \n\nPrototyping and Designing the Software for IoT Applications 373 \n\nThe following code implementation enables the client to get the LWT string and notify disconnection \n\nor required message to other clients, as per the requirement. LWT means Last Will and Testament; will means what is requested on connection death (failure). \n\nMqttConnectOptions options = new MqttConnectOptions(); \n\noptions.setCleanSession(false); \n\n/* Set a will (sought message on a connection death (failure) consisting of two bytes on the reconnection after the disconnection. Here SensedData denotes the topic and LWT is sent as the message on that topic. */ \n\n/* SensedData observes the SensedData/LWT message to detect disconnection of SensedData client.*/ \n\noptions.setWill(clientDevice.getTopic(\u201cSensedData/LWT\u201d), \n\n\u201c SensedData Lost\u201d.getBytes(), 2, true); \n\nclientDevice.connect(options); \n\n/* ControlData observes the ControlData/LWT message to detect disconnection of ControlData client message.*/ \n\noptions.setWill(clientApp.getTopic(\u201cControlData/LWT\u201d), \n\n\u201c ControlData Lost\u201d.getBytes(), 2, true); \n\nclientApp.connect(options); \n\n/***********************************************************************/ (vi) Declaring threads for publishing the messages on the topic sensed data \n\nA client publishes the sensed data. A step is declaring the threads for the topic and messages of each \n\nTOPIC which the client publishes from each streetlight device platform. A string for Topic/Message from each streetlight in each group of streetlights publishes the light need, working status and traffic presence values (Example 1.2 and Figure 9.2). Assume that light need value needs to communicate every 16 m, working status every day and traffic presence each minute. Following is the code for declaring the TOPIC strings, messages and threads. \n\n/* Set topics and message strings */ \n\npublic static final String TOPIC_LIGHTNEED = \u201cSensedData/deviceID, groupID, lightneed\u201d; \n\n/* Assume that LightNeed = true is the message which need to communicate every 16 minutes whenever the ambient light condition demands that streetlight should be switched ON.*/ \n\n/* Create a thread for publishing lightneed every 16 m */ \n\npublic class LightNeed extends Thread { \n\npublishLightNeed(); \n\nfor ( int i=1, i=9600, i++){sleep (1000); } /* Wait 16 m*/ \n\n} \n\npublic static final String TOPIC_WORKINGSTATUS = \u201cSensedData/deviceID, groupID, workingstatus\u201d; \n\n/* Create a thread for publishing working status every day */ \n\npublic class WorkingStatus extends Thread { \n\npublishWorkingStatus (); \n\n374 Internet of Things: Architecture and Design Principles \n\nfor ( int i=1, i=24800, i++){sleep (30000); } /* Wait 1 day*/ \n\n} \n\npublic static final String TOPIC_TRAFFICPRESENCE = \u201cSensedData/deviceid, groupid, trafficpresence \u201c; \n\n/* Create a thread for publishing TrafficPresence every 1m */ \n\npublic class TrafficPresence extends Thread { \n\npublishTrafficPresence (); \n\nsleep(30000); sleep(30000); /* Wait 1 m*/ . \n\n} \n\n/*************************************************************************/ \n\n(vii) (a) Publishing the messages by clients at each streetlight on the topic sensed data \n\n/*Next step is publishing of messages by the clients at each streetlight device platform. Message string publishes for lightneed, workingstatus and traffic-presence from each streetlight in each group of streetlights.*/ \n\nprivate void publishLightNeed() throws MqttException { \n\n/* Declare two numbers for creating a random number*/ \n\nfinal int n1= 100; final int n2=110; \n\nfinal MqttTopic lightneedTopic = client.getTopic(TOPIC_LIGHTNEED); \n\nfinal int lightneedNumber = Utils.createRandomNumberBetween(100, 110); \n\nfinal String lightneed = lightneedNumber + \u201cRequesting ON\u201d; \n\nlightneedTopic.publish(new MqttMessage(lightneed.getBytes())); \n\n} \n\nprivate void publishWorkingStatus() throws MqttException { \n\n/* Write code as above for workingstatus */ \n\n} \n\nprivate void publishTrafficPresence() throws MqttException { \n\n/* Write similar code for trafficpresence */ \n\n} \n\n/*****************************************************************/ (b) Publishing the messages by application/central controller on the topic \u2018control data\u2019 \n\n/*Next step is publishing of messages by the Application for each streetlight device platform. Message string publishes for control message for each streetlight in each group of streetlights.*/ \n\nprivate void publishControlMessage() throws MqttException { \n\n/* Specify codes for sending controlmessage */ \n\nPrototyping and Designing the Software for IoT Applications 375 \n\nfinal MqttTopiccontrolmessageTopic = client.getTopic(TOPIC_CONTROLDATA); \n\ncontrolmessageTopic.publish(new MqttMessage(controlmessage. getBytes())); \n\n} \n\n/****************************************************************/ (c) Client application subscription of the messages on the topic sensed data \n\nA coding step is codes for a client subscription, which is reading the values on the topic\u00a0SensedData. Each client device sends on the topic SensedData publishes three messages to the broker. \u201cSensedData /lightneed\u201d\u00a0, \n\n\u201cSensedData /workingstatus\u201d and \n\n\u201cSensedData/trafficpresence\u201d \n\nA\u00a0MqttCallback\u00a0interface has three abstract methods: \n\n1. messageArrived() implementation when runs then the Broker sends the new message to specific \n\nclient device in a group of devices 2. deliveryComplete() implementation runs when message with specified QoS = 1 or 2 at the \n\nBroker which sends to publisher on successful delivery to subscriber, and 3. connectionLost() implementation runs when  the connection is unexpectedly closed form the \n\nMQTT broker. \n\n(d)  Use a wildcard \u2018#\u2019 instead of subscription to 3 different topics, namely, TOPIC_LIGHTNEED, TOPIC_ \n\nWORKINGSTATUS, TOPIC_TRAFFICPRESENCE, \n\nmqttClient.setCallback(new SubscribeCallback()); \n\nmqttClient.connect(); mqttClient.subscribe(\u201cSensedData/#\u201d); \n\nmqttClient.subscribe(\u201cControlData/#\u201d); \n\npublic class SubscribeCallback implements MqttCallback { \n\n@Override \n\n[@Override means as follows: A compile will cause annotation checks of the method for the override. Override method means a method having the same name, same type and same number of arguments but has statements which use new arguments and override the earlier statements for that method. When annotated, a compile will cause an error if the method is not found in one of the parent classes or implemented interfaces.] \n\npublic void connectionLost(Throwable cause) {} \n\n@Override \n\npublic void messageArrived(MqttTopic SensedData, MqttMessage deviceID, groupID, lightneed) { \n\n/* Write Codes for actions on receiving the lightneed*/ \n\n. \n\n;} \n\n376 Internet of Things: Architecture and Design Principles \n\npublic void messageArrived(MqttTopic SensedData, MqttMessage deviceID, groupID, workingstatus) { /* Write Codes for actions on receiving the workingstatus */ . ;} public void messageArrived(MqttTopic SensedData, MqttMessage deviceID, groupID, trafficpresence) { /* Write Codes for actions on receiving the workingstatus */ . ;} @Override public void deliveryComplete(MqttDeliveryToken token) { /* Write Codes for actions on delivery completion */ . ; } \n\nClientApplication subscription of the messages on the topic ControlData \n\nmqttClient.setCallback(new SubscribeCallback()); mqttClient.connect(); mqttClient.subscribe(\u201cControlData/controlmessage\u201d); public void messageArrived(MqttTopic ControlData, MqttMessage deviceID, groupID, controlmessage); { /* Write Codes for actions on receiving the wcontrolmessage */ . ;} @Override public void deliveryComplete(MqttDeliveryToken token) { /* Write Codes for actions on delivery completion */ . ; } \n\nFigure 9.3 shows the connected sensor and actuator which are publishing the sensed data and subscribing for the control data using MQTT Android clients\u2019 communication with application layer MQTT clients through an MQTT broker. \n\nExample 9.12 gives application on Android MQTT client device platform using Paho. \n\nExample 9.12 \n\nProblem A programme implementation for  communication with an Android phone using Paho and ADT: \n\nConnected sensor and actuator, which are publishing the sensed data, and subscribing for control messages using MQTT Android clients \n\nPrototyping and Designing the Software for IoT Applications 377 \n\nImplement codes for Subscriber class for subscribing to the sensed data (for example, electric kettle temperature sensor) by the Android phone. Use Eclipse Moquette Paho implementation of MQTT using TCP? \n\nSolution \n\nAssume that Java JDK version 6 or higher package is used for implementation in Paho. Also Android Software Development Kit (SDK) is installed and Android Development Toolkit (ADT) is added as plugin to the Eclipse. \n\nPackage org.eclipse.pahoAndroidApplicationExample; \n\nimport org.eclipses.paho.client.mqttv3.MqttClient; import org.eclipses.paho.client.mqttv3.MqttException; \n\nimport org.eclipses.paho.client.mqttv3.MqttMessage; \n\nCoding is similar to Example 9.11. Following code shows the analogy. Implement the Subscriber class for subscribing to the sensed data (for example, electric kettle temperature sensor) by the Android phone as follows: \n\n/*Let first step is that within the class Subscriber, declare URL of the MQTT Broker and create instance of class MQTTClient. Use MAC Address as Client_ID for publisher ID and the initialization of the MqttClient instance is as per following code. Use -subAndroid as a suffix for the Client_Id. */ \n\npublic class Subscriber { \n\npublic static final String MQTT_BROKER_URL = \u201ctcp://broker.mqttdashboard. com:1883\u201d; \n\nDevices using MQTT Clients \n\nKettle Electric \n\nTemperature \n\nSensor and \n\nController \n\n1:Published Sensed data 10s of Bytes \n\n4:Subscribed Control Data \n\n10s of Bytes \n\nIoT or M2M \n\nArea Local Network and \n\nGateway \n\nNetwork \n\nand Transport \n\nMQTT Broker \n\n(m2m. eclipse. \n\norg/ paho \n\nAndroid Applications \n\nand Services Layer MQTT Clients \n\n2:Subscribed \n\nSensed Data \n\nof Devices \n\n3:Published Control Data \n\nfor the Devices \n\nAndroid \n\nApp for \n\nIntenet Control of \n\nHome Electric \n\nKettle \n\nPhysical/Data Link \n\nLayer \n\nAdaptation \n\nLayer \n\nNetwork and Transport Layers \n\nLayer \n\nApplication Support/Mobile Service Provider \n\nLayer \n\nApplication \n\nLayer \n\nFigure 9.3  Connected sensor and actuator, which are publishing the sensed data, and subscribing for \n\ndata control using MQTT Android clients\u2019 communication with the application layer MQTT clients through an MQTT broker \n\n378 Internet of Things: Architecture and Design Principles \n\n/* client is the instance of MqttClient */ \n\nprivate MqttClient client; \n\npublic Subscriber() \n\n{ \n\nString a1 = \u201c-subAndroid\u201d; \n\n/* Declare clientDevice_ID using method getPhoneNumber( ). */ \n\nString clientDevice_Id = Utils.getPhoneNumber () + a1; \n\ntry { \n\nmqttClient = new MqttClient(MQTT_BROKER_URL, clientDevice_Id); \n\n} \n\ncatch (MqttException e) { \n\n/* Write codes for callback method */ \n\n/* On exeception, Assume that callback method is print the stack trace. */ \n\ne.printStackTrace(); \n\nSystem.exit(1); \n\n} \n\n} \n\n} \n\nEclipse IoT Stack Applications for Projects \n\nThe Eclipse IoT stack includes application layer software (applications and services) for OM2M, smart home and SCADA projects. Table 9.3 gives Eclipse implementations and frameworks included in the Eclipse IoT stack for application layer software. \n\nTable 9.3  Eclipse implementations and frameworks included in the Eclipse IoT stack for application \n\nlayer software \n\nEclipse Implementation/ Framework \n\nDescription \n\nEclipse SmartHome A set of implementations for projects for smart homes using wireless and wired protocols and network protocols \n\nEclipse SCADA A set of SCADA (Supervisory Control and Data Acquisition) functions for usages, such as in factory automation, industrial processes buildings and health systems \n\nEclipse OM2M An open source implementation of SmartM2M and oneM2M standard that enables developing services on a horizontal M2M service platform, the implementation is independently of the underlying network and facilitates the deployment of vertical applications and heterogeneous devices. \n\nPrototyping and Designing the Software for IoT Applications 379 \n\nReconfirm Your Understanding \n\n\u25cfNeeds of developing the software at five levels: (i) Gather + Consolidate, (ii) Connect, (iii) Collect + Assemble, (iv) Manage and Analyse, and (v) applications and services in IoT/M2M applications and services. \n\n\u25cfEclipse open IoT stack is a set of Java frameworks, protocols, development tools and implementations including usages of OSGi services, such as Clock, Crypto (AES, base64, SHA-1), Geolocation, Data and Cloud Services for the connect and manage functions for IoT solutions. \n\n\u25cfEclipse IoT stack is for open source technologies for device platforms and running the codes in JVM or Eclipse Concierge (a lightweight implementation of OSGi runtime). \n\n\u25cfThe stack enables the usages of protocol functions for connectivity and interoperability of device gateways. \n\n\u25cfThe stack enables the usages of lightweight M2M (OMA M2M standard), MQTT (OASIS IoT standard), CoAP (IETF IoT standard) and standard network protocols for IoT gateway services for remote management and applications management. \n\n\u25cfEclipse Pi4J, Eclipse Koneki, Eclipse Mihini, Eclipse Krikkit provide physical cum data-link and adaptation layers software. \n\n\u25cfEclipse Moquette, Eclipse Paho, Eclipse Wakkamma, Eclipse Californium, Eclipse Lehshan, Eclipse OM2M, Eclipse Ponte and Eclipse Kura provide gateway, network, transport, application support layer software. \n\n\u25cfAn example showed the usages of Paho for streetlights IoT where streetlight devices publish the sensed data using Paho Java MQTT clients. Applications publish control data and subscribe to the sensed data. An Eclipse Paho MQTT broker provides a gateway between the devices and applications. \n\n\u25cfAn example showed the usages of Paho for Android MQTT clients for controlling an electric kettle. \n\n\u25cfApplication layer implementations for smart home and SCADA projects and for M2M can use Eclipse SmartHome, Eclipse SCADA and Eclipse OM2M for software development. \n\nSelf-Assessment Exercise \n\n1. List five levels of software which need to be developed. 2. Write the features of Eclipse IoT stack. 3. Which are the Eclipse stacks for implementations using LWM2M and CoAP \n\nclients and LWM2M and CoAP servers in client-server communication modes? 4. What are the software for functions implemented using Eclipse Pi4J, Eclipse \n\nKoneki, Eclipse Mihini and Eclipse Krikkit? 5. List the Eclipse stack implementations for devices and interactions with \n\napplication clients through a broker. 6. When is the LWM2M or CoAP client-server in communication mode? 7. List the features of Eclipse Kura. 8. What are for the OSGi service functions used in the implementation of Eclipse \n\nIoT stack? 9. Write the subscriber and publisher classes for IoT/M2M applications using \n\nthe pub/sub mode of communication. Use the MQTT device clients\u2013broker\u2013 application clients. \n\n\u2605 \u2605\u2605 \n\n\u2605 \n\n\u2605\u2605 \n\n\u2605\u2605 \n\n\u2605\u2605 \u2605\u2605 \u2605\u2605 \n\n\u2605\u2605\u2605 \n\n\n![Image](/src/assets/generated_images/iot2_p406_i0.png)\n\n380 Internet of Things: Architecture and Design Principles \n\n9.4 PROTOTYPING ONLINE COMPONENT APIs AND WEB APIs \n\nApplication Programming Interface (API) is a way of obtaining input from one face (user-end or a program) and sending the request or message or data to another face (an application program). An API initiates the message exchanges. The API initiates action when it receives inputs, it calls the execution of application codes (set of codes) on input events and initiate running of functions for actions [callback ( )] on them. The API initiates and enables desired actions using the computing system, and may also access a service which is local or remote on occurrence of event of input to the interface. The API can also initiate sessions between the user or client and the applications or service functions. \n\nA web application uses UI and web API. A web API accesses a service on the web using the Internet and web protocols. A UI of a web API gets input from the user or client and accesses a service, such as MSN weather service using MSN weather server. Figure 9.4 shows mobile phone weather-application UIs, APIs and web API interactions and ten message-exchange sequences. \n\n1:Touch Event \n\n2:Callback  () to New Location UI \n\n9: Publish City Weather Data for the Clients \n\n8: Subscribe City Weather Data \n\nMobile Phone \n\nWeather Application \n\n3:If  New City-name Name Event API for Location \n\nUI and Get Input \n\nSession \n\n5:Callback () to Weather \n\nWeb API \n\nMSN Weather \n\nServer \n\n4:Send New City Name \n\nWeather \n\nUI \n\n10: Send Service Messages for City Weather Web API \n\n6:Callback () Send Client Messages \n\nWeather Web API \n\nWiFi Interface \n\n7: Session between Weather APIs \n\nWeather \n\nService \n\nAPI \n\nIP Network \n\nand UDP Transport and DTLS \n\nFigure 9.4  The mobile phone weather-application UIs, APIs and web API interactions, and ten message- \n\nexchange sequences \n\n9.4.1 Using the Number of Mashed Up APIs in an Application or Service \n\nA number of APIs can be mashed to get the desired result. Figure 9.4 shows number of mashed up APIs in the weather application. \n\nDescribe prototyping methods of the online \n\ncomponents for IoT \n\napplication APIs \n\nLO 9.3 \n\nAPI enables implementation of an application or service \n\non the event of input \n\nfrom one end \n\nPrototyping and Designing the Software for IoT Applications 381 \n\nExample 9.13 clarifies the concept of API, web API and mashing of APIs. \n\nExample 9.13 \n\nProblem The concept of API, web API and mashing of APIs: \n\nHow does a weather-application access the weather-service in a mobile phone? \n\nSolution \n\nThe weather-application in a mobile  phone uses a UI (a screen API) which displays onto screen to seek user input. The phone screen shows up a touch-option with label \u2018weather\u2019. Following are the sequential actions: \n\n\u25cfWhen user touches \u2018weather\u2019, the touch messages transfer to another UI (User Interface) which appears on the screen next (sequences 1 and 2 in the Figure 9.4). \n\n\u25cfUI is user interface for location API. It displays a message \u201cWelcome! Please choose your default location\u201d. The screen also displays a text box with entry \u2018Search for a city\u2019. A cursor points at the beginning of the text box. The user enters the input into the textbox i.e. name of the city using a touch keypad, which also shows up at the bottom (Sequences 3 and 4 in the figure). \n\n\u25cfWhen the location API gets the name of the city and the user taps at the textbox, the UI display disappears, the phone communicates with the MSN weather site. Weather service gets the messages and sends for display onto the \u2018weather\u2019 (Sequences 5 to 10). \n\n\u25cfThe \u2018weather\u2019 is a UI for display and hourly refresh. The API displays, \u201cMon, sign for fully Sunny, 30\u00b0, 18\u00b0; Tue, sign for small part sunny, rest cloudy, 30\u00b0, 19\u00b0, \u2026\u201d, and the city name shows up at the bottom line. If the weather UI is touched, then callback function initiates another API. The called API UI is full screen, which shows full details of the weather at the selected city. When user touches the UI screen, then the weather messages refresh. \n\nThe weather web application at the phone is using a number of APIs and callback functions. \n\n\u25cfThe screen UI gets input (touch) from the user. The UI sends in output weather tile touch message to the location API. \n\n\u25cfThe location API for weather gets input for the name of the city. When input is given then it callbacks a back-end code for weather access. The code accesses to the MSN weather site using the Internet over WiFi network to which the phone is connected. The location API sends the city name. \n\n\u25cfWeather web-API callback functions interact with weather-API service for weather service messages. It subscribes to the MSN weather server. The server publishes weather messages for the subscribing clients (Sequences 5 to 7). \n\n\u25cfWeather service API sends service messages as a response which communicate over the Internet to the weather client of weather web API. The service also sends in response presence and next two days predications, and expected maximum and minimum temperatures (Sequence 8 to 10). \n\nEarlier Example 9.13 used mobile phones as the device platform. Refer to Example 1.1 of IoT. The example considered a smart umbrella as a device platform, which enables the umbrella, and behaves like living entity through computing. An embedded small device interacts with the weather web-service and mobile of the owner through the Internet. Figure 9.5 shows weather web-API for an umbrella, extreme weather-message web-API, mobile phone web-API, and weather-service API, and their interactions, and fourteen sequences of message exchanges. \n\n382 Internet of Things: Architecture and Design Principles \n\n9:Published City Weather Data for the Clients \n\n8:Subscribe Weather Data of City \n\nSmart and Alive Umbrella Application \n\n2: Request for Place and City- \n\nName \n\n6:Callback  () To  Weather \n\nService Web API \n\nMSN Weather Server 1:Each Day Event message \n\nIP Network, UDP Transport and DTLS \n\nUmbrella ID, date and time, and location stamps \n\n5:Callback () Send Client Messages \n\nWeather web API \n\nWiFi Interface \n\n7: Session between Weather APIs \n\nWeather Service API \n\nLocation Service API 3: Response  for Place and City-name \n\n4:Callback  () on  New Location Event \n\n10: Send Service Messages for City Weather \n\nWeb API \n\nAPI for Location and Get input Session Mobile API for Text Messaging 11: Umbrella Extreme Weather Event \n\n13: Send Data for Warning Messaging Service in Case of Extreme Weather \n\nUmbrella Mobile API \n\nNFC Interface \n\n12: Warning Messages by LED Flashes \n\n14: Receive Warning \n\nMessage Text from Smart and  Alive Umbrella \n\nFigure 9.5  Umbrella weather web API, location API, extreme weather warning message umbrella \n\nmobile API, mobile phone text messaging API, weather service API and their interactions and fourteen sequences of message exchanges \n\nExample 9.14 clarifies the concept of APIs and web APIs for Internet of Smart and Alive umbrella. \n\nExample 9.14 \n\nProblem The concept of APIs and web-APIs for Internet of Smart and Alive Umbrella: \n\nHow does a \u2018Weather\u2019 API at an umbrella access a weather service and communicate an expected  extreme weather event, such as rain or hot sunny day to a mobile phone API by a text message? \n\nSolution \n\nAssume that an umbrella consists of an embedded device for an IoT weather application. The device application uses a mash of APIs as follows: \n\n\u25cfWhen a start of the day event, say 8 a.m., ticks at the clock (Sequence 1 in Figure 9.5), a callback() function executes and sends a client-request to the location server (Sequence 2), and pulls the location data (sequence 3). Sequences 2 and 3 find the location and generate event message on location change. \n\n\u25cfLocation API sends message for new location in case of device-location change (Sequence 4). \n\n\u25cfThe messages communicate in JSON Object format (Section 3.2.3). The umbrella ID, date, time and location stamps communicate on the day-start event to the weather API. Sequences 5 to 10 are similar to that in Example 9.13 for mobile phone web APIs. \n\n\u25cfAn event, if generates an extreme weather warning, then a callback function executes. The warning can be by LED flashes at the device or by a text message on the mobile. \n\nPrototyping and Designing the Software for IoT Applications 383 \n\nThe weather web application at the umbrella is using number of APIs and callback functions. These are: \n\n\u25cfLocation API gets the name of the city from the location server. (Sequences 2 and 3). \n\n\u25cfThe weather web-API callback functions interact with the weather API for the weather service messages. The API subscribes to MSN or another weather Server. The server publishes weather messages for the subscribing clients (Sequence 5 to 8). \n\n\u25cfWeather service API sends service messages as a response which communicates over the Internet to the weather-client of the web API. The weather service also communicates in response the present and next two days predications, and expected maximum and minimum temperatures (Sequences 9 and 10). \n\n\u25cfUmbrella mobile web API sends message for owner on mobile using NFC protocol (Sequences 11 and 13 in the figure). \n\nImplementing the APIs in an Application or Service \n\nAn application or service consists of mashed APIs. Following are the steps for implementing the APIs: \n\n1. Make an implementation table for sequences of API actions. A session of message \n\nexchanges between two ends of API may consist of number of actions. \n\n\u25cfColumn 1 of each row has the actions in sequences which occur one by one. \n\n\u25cfColumn 2 may specify for each action, the authentication code or method (device platform ID, such as MAC address) for secured communication to and from other end (server or application). Column 2 has authentication method for use that may involve user/password communication. User in case of IoT device platform is device platform ID, such as MAC address. Password can be some code internally generated at device platform using some algorithm using a secret key as input (Example 9.8). \n\n\u25cfColumn 3 specifies the API inputs for initiating the action on event. \n\n\u25cfColumn 4 specifies the API outputs for the inputs. The outputs communicate to other end and initiate the execution of methods, callback functions, generate requests or send responses. 2. Use the secure communication protocols, such as DTLS/TLS. 3. Use the standard formats for object or message exchanges: JSON, TLV or XML or \n\nREST style of URIs or URLs for message format (Section 3.2). 4. Use for access to remote methods standard protocols, such as SOAP (for XML-RPC) \n\nor JSON-RPC. RPC stands for remote procedure call. Procedure also means function in C/C++ or method in Java (Sections 3.3 and 3.4). 5. Use the standard client-server protocols, such as MQTT when using publish/subscribe \n\nor such as XMPP models of message or object exchanges (Section 3.2). 6. Use the standard client and server protocol for client-server http, or CoAP or ws \n\nprotocol using client-response model of message or object exchanges (ws:// used in place of http:// for bi-directional message exchanges) (Section 3.4). 7. Use the standard methods for web object or message exchanges. For example, REST \n\nrequest-response model methods, such as HTTP GET/POST methods or WebSocket methods for bi-direction message exchanges (Section 3.4). \n\n384 Internet of Things: Architecture and Design Principles \n\n8. Use the scripts, for example, JavaScript or Node.js framework for creating set \n\nof codes in event model or codes for running at distributed computing systems (device platforms or services at web/cloud). Event model calls a callback() [onEventAction()] functions on inputs. The function may initiate sending a client data or sending a server response. Function runs once on each input-event. 9. Use the language or scripting language framework which provides wider support of \n\nlibraries, community and test tools. Example 9.15 explains the table for easy implementation of API. \n\nExample 9.15 \n\nProblem Drawing an implementation table for weather web APIs: \n\nHow does a table make it easy writing codes for weather web APIs? Use the sequences shown in Figure 9.4. \n\nSolution \n\nTable 9.4 gives the actions, inputs and outputs for weather APIs. \n\nTable 9.4 Implementation table for weather web APIs \n\nSequence Number and Action \n\nAuthentication Inputs Outputs \n\n1: New connection to weather service API \n\nMAC address or deviceID/ ApplicationID/ API_ID \n\nLocation (City Name) Message to weather web client to enable client connect to send request for weather messages \n\n2: New connection to weather Service \n\nMAC address or weather service API ID \n\nMessages (city name, ClientID, time stamp) \n\nSubscribe to the weather service, if a new city name (messaged from the location server) \n\n3: New connection to weather service \n\nMAC address or weather service API ID \n\nMessages of weather web-service API on new city name \n\nSubscription message(s) on new city to the weather service and messages (clientID, weather information with with time stamp from messaged data) \n\n3: New response of weather service \n\nMAC address or weather service ID \n\nWeather messages and warnings for this and predictions of next two days for the city from repository \n\nResponse message(s) \n\nPrototyping and Designing the Software for IoT Applications 385 \n\n9.4.2 APIs Implementation Using REST Methods \n\nWhen implementing a REST API or using REST methods in client or server, first making a table makes the coding easy. \n\n\u25cfColumn 1 of each row has the URL for communication for implementing an action. \n\n\u25cfColumn 2 may specify the action (REST methods), such as PUT/GET/POST/DELETE for implementation. \n\n\u25cfColumn 3 may specify for each action, the authentication code or method (device platform ID, such as MAC address) for secured communication to and from other end (server or Application). Column 3 has authentication method for use at server/ destination end that may involve user/password session. User in case of IoT device platform is device platform ID, such as MAC address. Password can be some code internally generated at device platform using some algorithm using a secret key as input (Example 9.8). \n\n\u25cfColumn 4 specifies the API inputs/parameters for initiating the action. \n\n\u25cfColumn 5 specifies the API outputs for the inputs. The outputs communicate to other end and initiate the execution of methods, callback functions, generate Cookie or response. \n\n9.4.3 API Implementation in WebSockets \n\nWebSocket enables bi-directional communication at the same instances between two ends. The WebSocket needs lesser header-size when compared to the HTTP header size (Figure 3.9)  HTTP client first pulls data from one end to another and later other end-clients in other direction (Section 3.4.5). \n\nEclipse Jetty is a WebSocket implementation in Java and is open source from a weblink https://www.eclipse.org/websocket. The implementation uses Jetty WebSocket (String). Maximum message size declares as WebSocket (maxTextMessageSize). WebSocket Client and server both use the callback listeners onOpen, onMessage, OnClose, onError. A Java implementation imports following: \n\nimport org.eclipse.jetty.websocket.client.WebSocketClient; import org.eclipse.jetty.websocket.api.Session; import org.eclipse.jetty.websocket.api.StatusCode; import org.eclipse.jetty.websocket.api.annotations.OnWebSocketOpen; import org.eclipse.jetty.websocket.api.annotations.OnWebSocketConnect; import org.eclipse.jetty.websocket.api.annotations.OnWebSocketMessage; import org.eclipse.jetty.websocket.api.annotations.OnWebSocketClose; import org.eclipse.jetty.websocket.api.annotations.OnWebSocketOnError; Packages, classes, methods, variables and parameters may be annotated in Java. An annotation in Java is a form of syntactic metadata that can be added to a Java source \n\n386 Internet of Things: Architecture and Design Principles \n\ncode. Syntactic metadata refers to the format instructions for storage of the values or class or method. \n\nFollowing are the callback WebSocket methods: \n\n\u25cfonWebSocketConnect() \n\n\u25cfonWebSocketMessage() \n\n\u25cfonWebSocketClose() Open source Paho Go Client at Eclipse Paho consists of added WebSocket (ws) clients to connect to an MQTT broker. Open source Eclipse Ponte consists of added MQTT-over-ws clients in JavaScript. \n\nOpen source client-server WebSocket methods for implementation on Arduino device platform can be used from the weblink https://github.com/krohling/ArduinoWebsocket and https://github.com/djsb/arduino-websocket. Krohling Arduino ws client and ws server (bi-directional) implementation is as follows: \n\n\u25cfDeclare MAC address as follows: byte mac48BitAddress (six bytes separated by comma) \n\n\u25cfDeclare WebSocket server URL as follows: char server [] = \u201cecho.websocket.org\u201d for initialization \n\n\u25cfDeclare serverSocket (8080) for using HTTP alternate web server for initial creation of WebSockets using echo. Echo means sending the message and receiving same message back when WebSockets successfully create.http web server port is 80. When a secondary or alternate web server hosted the port number 8080 is used. 8080 is commonly used for proxy and caching \n\n\u25cfDeclare object wsClient of class WebSocketClient \n\n\u25cfDeclare wsClientDA object of class dataArrivedWebSocketClient for web object of arrived data \n\n\u25cfDeclare callback method dataArrived (WebSocketClient wsClientDA, String message) on an end receiving string from WebSocket The HTTP client sends the request or messages to the HTTP server and waits for a response. The server sends response or messages. A WebSocket client is that which initiates the connection to peer. A WebSocket server is published and waits for the connections from the peers. \n\nFigure 9.6 shows the sequences of sessions for message exchanges when using WebSocket objects. \n\nFollowing are methods wsclient.available(), wsclient.connect(Server), wsClient. connection(), wsClient.connected(), wsClient.send(), wsClient.setDataArrived() and wsClient.setDataArrivedDelegate(String dataArrived) for communication after creating WebSocket clients for bi-directional exchange of messages. \n\nWhen implementing a WebSocket API or ws client or ws server, first making a table makes the coding easy. Following are the columns: \n\nPrototyping and Designing the Software for IoT Applications 387 \n\nEcho Session 1: EchoSocket sends a String 2: EchoSocket receives back echo HTTP Client HTTP Secondary web Server \n\nIf @onWebSocketConnect returns true then callback Sessions 3, 4, .... between webSocket APIs till @onWebSocketClose returns true \n\nClient new functioning: WebSocket Client object \n\nServer new functioning: WebSocketClient object \n\n3: Session for webSocketClient bi- directional send and receive messages 4: Session webSocketServer bi-directional sending and receiving the messages Sessions \n\nMethod for bi-directional sessions 3 and 4: session.getRemote (). sendStringwebObject (String) \n\nEcho Session \n\nFigure 9.6 Sequences of sessions for message exchanges when using WebSockets \n\n1. Column 1 of each row has the URI or URL of message destination end for \n\ncommunication for implementing an action. 2. Column 2 may specify the action such as following callback WebSocket \n\nmethod: onWebSocketOpen, OnWebSocketSession, onWebSocketConnect, onWebSocketMessage String Message, Session session), onWebSocketClose or following method WebSocket (maxTextMessageSize) when using Eclipse Jetty WebSocket implementations. 3. Column 3 may specify for each action, the authentication code or method (device \n\nplatform ID, such as MAC address) for secured communication from source end to destination end. Column 3 has authentication method for use at the destination-end (server or application/service) that may involve user/password communication. User in case of IoT device platform is device platform ID, such as MAC address. Password can be some code internally generated at device platform using some algorithm using a secret key as input (Example 9.8). 4. Column 4 specifies the API inputs/parameters for initiating the action. 5. Column 5 specifies the API outputs for the inputs. The outputs communicate to other \n\nend and initiate the execution of methods, callback functions, generate cookie or response. Example 9.16 explains a WebSocket APIs implementation table method. \n\nExample 9.16 \n\nProblem Implementation table for the weather and weather service APIs using Eclipse webSocketClient library: \n\nHow is implementation table drawn for ease of writing codes for weather and weather service APIs? Use the library at Eclipse website.22 \n\n22 http:// jetty.websocket.client.WebSocketClient.eclipse.org \n\n388 Internet of Things: Architecture and Design Principles \n\nSolution \n\nTable 9.5 gives the actions, inputs and outputs for weather and weather service APIs. \n\nTable 9.5 Implementation table drawn for ease of writing codes for a weather and weather service APIs \n\nSequence number and URL \n\nMethod Authentication Inputs Outputs \n\n1: URL of weather service API \n\nonWebSocketConnect() MAC address or deviceID/ ApplicationID/ API_ID \n\n\u2014 Creation of WebSockets \n\n2: URL weather service \n\nonWebSocketMessage() MAC address or weather service API ID \n\ncallback(), Messages (city name, ClientID, time stamp) \n\nRequest to weather service \n\n3: URL of weather service API \n\nonWebSocketMessage() MAC address or weather service ID \n\ncallback(), Messages of weather web- service \n\nResponse of service for messages (clientID, weather information with time stamp) \n\n4: URL of weather Web API \n\nonWebSocketMessage() MAC address or weather service API ID \n\nWeather messages and warnings for this and predictions of next two days for the city \n\nReconfirm Your Understanding \n\n\u25cfAn API is a way of obtaining input from one face and sending the request/message/data to another face (other set of codes). The API enables initiations of events, obtaining inputs, execution of application codes (set of codes) on input events and running the functions (callback functions) on input event. Web API is an API which uses web protocols for web applications. \n\n\u25cfExample of weather application in a mobile phone and the smart and alive umbrella shows the uses of APIs and web APIs. \n\n\u25cfExample of smart and alive umbrella shows the uses of APIs and web APIs. \n\n\u25cfAPIs implementation using standard message or object formats, protocols and models. \n\n\u25cfAPIs implementation using standard message format, protocols, language or script framework with wider library, community and test tools. \n\n\u25cfAPI implementation is easy when a table is made for each action of the sessions and interactions, specifying the authentication methods, inputs and outputs. \n\nPrototyping and Designing the Software for IoT Applications 389 \n\n\u25cfMessage exchanges between APIs, webAPIs, webService APIs, webClient and webServer use REST APIs and WebSockets. \n\n\u25cfEclipse Jetty, Paho and Ponte implementation provide the library functions for WebSockets and WebSocket APIs. \n\nSelf-Assessment Exercise \n\n1. Define the functions of API. 2. Why are APIs used for communicating with application/service at both server \n\nand client ends? 3. Draw a diagram showing sessions between location API and location service \n\nAPI. 4. Draw a table of actions and sessions for implementing the APIs in example of \n\nInternet of Smart and Alive Umbrella. \n\n\u2605 \u2605\u2605 \n\n\u2605 \n\n\u2605\u2605\u2605 \n\nKey Concepts \n\n\u25cfApplication \n\n\u25cfApplication programming interface \n\n\u25cfAuthentication \n\n\u25cfCallback functions \n\n\u25cfClient \n\n\u25cfCoAP \n\n\u25cfCrypto functions \n\n\u25cfDevelopment framework \n\n\u25cfDistribution \n\n\u25cfEclipse IoT stack \n\n\u25cfEmbedded devices \n\n\u25cfEncryption \n\n\u25cfEvent model \n\n\u25cfGateway methods \n\n\u25cfHash algorithm \n\n\u25cfIntegrated development environment \n\n\u25cfIoT stack \n\n\u25cfKura \n\n\u25cfLibrary functions \n\n\u25cfLWM2M \n\n\u25cfMAC address \n\n\u25cfMashed up APIs \n\n\u25cfMQTT broker \n\n\u25cfMQTT client \n\n\u25cfOM2M \n\n\u25cfOSGi services \n\n\u25cfPaho \n\n\u25cfPonte \n\n\u25cfREST methods \n\n\u25cfServer \n\n\u25cfSoftware serial library \n\n\u25cfService \n\n\u25cfTest functions \n\n\u25cfWebSockets \n\nLearning Outcomes \n\nLO 9.1 \n\n\u25cfA number of device platforms of IDEs, such as Arduino, Intel Galileo, RPi, BB and mBed, provide development tools, libraries and framework, and are used for the development of embedded Software. \n\n390 Internet of Things: Architecture and Design Principles \n\n\u25cfA number of programming examples explain the process of developing the codes and test codes. \n\n\u25cfArduino IDE is simpler and embedded software requires building upon just two functions: setup() and loop(). Bootloader enables simple multitasking by the usages of interrupt handlers. \n\n\u25cfA serial monitor at the IDE enables computer obtaining results from the serial port of device platform for display on monitor. \n\n\u25cfNumber of library functions provides the ease in programming. For example, usage of timer and software serial libraries. \n\n\u25cfExamples explained the usages of: (i) timer functions, (ii) reading of RFID tag using UART functions and (iii) I2C communication between sensor communicating sensed data using I2C and device I2C port. \n\n\u25cfAn example showed how the multiple threads of a program execute on a device platform. \n\n\u25cfThings communicate to the Internet using functions for Ethernet, WiFi and IP. \n\n\u25cfThings communicate data securely using cryptolibrary functions, such as AES128, AES192, AES256 or DES. \n\nLO 9.2 \n\n\u25cfEclipse IoT stack implementations enable the software components, development device, gateway, Internet and web/cloud application service. \n\n\u25cfThe development of software components takes place at five levels: (i) Gather + Consolidate, (ii) Connect, (iii) Collect + Assemble, (iv) Manage and Analyse, and (v) Applications and Services in IoT/M2M applications and services using Eclipse open IoT stack. \n\n\u25cfEclipse IoT stack of the device platforms is for open source technologies, usages of protocol functions, connectivity and interoperability of the device gateway, lightweight M2M (OMA M2M standard), MQTT (OASIS IoT standard), CoAP (IETF IoT standard), IoT gateway services, remote management and applications management. \n\n\u25cfEclipse IoT stack implementations use the Eclipse Pi4J, Eclipse Koneki, Eclipse Mihini, Eclipse Krikkit, Eclipse Moquette, Eclipse Paho, Eclipse Wakkamma, Eclipse Californium, Eclipse Lehshan, Eclipse OM2M, Eclipse Ponte and Eclipse Kura provide gateway, network, transport, application-support layers\u2019 software components. \n\n\u25cfA number of Java programming examples explain the process of usage of Paho MQTT clients publishing the messages and subscribing for the messages through an MQTT Broker. Eclipse Paho MQTT broker provides a gateway between the devices and applications. \n\n\u25cfPaho enables usage of Android MQTT clients for controlling the devices through the Android phone clients. \n\n\u25cfEclipse stack IoT and M2M solution frameworks for application layer implementations enable applications software components development for smart home, SCADA and OM2M projects. \n\nLO 9.3 \n\n\u25cfAPIs and web APIs enable message exchanges between embedded devices and applications/ services at the server/cloud. \n\n\u25cfAPI obtains input from one face and sends the request or message or data to another face (other set of codes). The API enables initiations, obtaining inputs, execution of application codes (set of codes) on input events and running functions (callback functions) on input event. Web API is an API which uses web protocols. \n\n\u25cfA number of examples explained the implementations using standard message or object formats, protocols and models. \n\nPrototyping and Designing the Software for IoT Applications 391 \n\n\u25cfWay of message exchanges between APIs, webAPIs, webService APIs, web client and web server explained with usages of the REST APIs and WebSockets. \n\n\u25cfEclipse Jetty, Paho and Ponte implementation provide the library functions for WebSockets and WebSocket APIs. \n\nExercises \n\nObjective Questions \n\nSelect one correct option out of the four in each question. \n\n1. The levels for developing the software are: (i) Gather + Consolidate, (ii) Connect, (iii) \n\nCompacting, (iv) Manage and Analyse, and (v) Querying databases of devices data by the applications and services in IoT/M2M applications and services. (a) (i) to (v) except (iii) (b) (i) to (v) \n\n(c) (i) to (iv) (d)  All except (iii) and (v) 2. The Arduino IDE includes: (i) C/C++ library, (ii) Java Library, (iii) JavaScript, \n\n(iv) Wiring library, (v) Processing language, (vi) setup() and loop() functions, (vii) Arduino device platform has bootloader embedded into that and usages of the OS is not a must and may add OS Linux distributions. (a) All except (ii) and (iii) (b) (i) to (vii) \n\n(c) (i) to (vi) (d)  (i) to (v) except (iii) 3. Which of the following statement is correct? (i) Pins, Tx or TxD (for serial transmission \n\nof header, data and other bits) and Rx or RxD (for serial reception of data) are used for I2C bus communication, (ii) Pins SDA and SCL are used for the UART bus communication, (iii) RFID tag communicates to the reader using UART, (iv) UART BAUD rate is always 9600, (v) I2C bus is asynchronous bus, (vi) Two Arduino boards can communicate with each other using I2C. (a) All except (ii) and (iii) (b) (i) to (vi) \n\n(c) (iii) and (vi) (d) (i) to (v) except (iii) 4. AdafruitIDE is for Raspberry Pi and can be updated for BeagleBone, (ii) RPi connects \n\nto LAN when coding, (iii) Coding can be using Python, JavaScript or Ruby languages, (iv) Adafruit also OS for functions of keyboard and display monitor, (v) Includes a secure shall (SSH) for cryptographic network protocol for the Application layer, (vi) enables remote login, and (vii) remote connections of the systems, keyboard and monitor. (a) All except (ii) and (iii) (b) (i) to (vii) \n\n\u2605 \n\n\u2605\u2605 \n\n\u2605\u2605\u2605 \n\n\u2605 \n\n392 Internet of Things: Architecture and Design Principles \n\n(c) All except (v) (d)  (i) to (vi) 5. IoT security risks are: (i) an in-between switch or router or server S reads messages \n\nbetween two ends and replays the same for authentication at a communicating end for obtaining access to communication between two ends, (ii) S modifies the data of one end and other end can wrongly authenticate the application or get the modified text, (iii) Two requirements for IoD data secure communication are authentication and encryption of data. AES128, AES192, AES256 or DES functions are used for (iv) encryption and (v) authentication. (a) (ii) to (iv) (b) (i) to (iii) \n\n(c) (i) to (iv) (d) All except (v) 6. The features of Eclipse IoT stack components and frameworks for the IoT solutions \n\nare: (i) Provides open source and specifications, (ii) Specifications as per OSGi, (iii) Simpler open source implementations and program development using the open source Java frameworks and services, (iv) C implementation in Paho and Californium, (v) Python and Java Script implementations. The stack enables usages of (v) LWM2M and MQTT, (vii) CoAP, (viii) TCP, (ix) UDP, (x) DTLS, and (xi) IoT gateway services for remote management and applications management. (a) (ii) to (xi) (b) (i) to (viii) \n\n(c) All except (iv) and (v) (d) All except (xi) 7. An application programming interface: (i) obtains from one end and sending the \n\nrequest or message or data to another end API, or (ii) application or service end or (iii) database server end, (iv) Broker end, (v) web server end, (vi) The API enables initiations on obtaining inputs, call for execution of application codes (set of codes) on input events and initiate running the functions (callback functions) on input event. (a) All (b) All except (ii) to (iv) \n\n(c) All except (ii) and (iv) (d) All except (iv) 8. The API (i) initiates and (ii) enables desired actions using the computing system, \n\n(iii) may also access a service which is local, or (iv) remote on the event of input to the interface. The API can have (v) initiate sessions between user or client, and (vi) the application functions, or (vii) service functions. (a) (ii) to (vi) (b) (i) to (viii) \n\n(c) All except (iv) (d) (i) to (v) 9. Which of the following statement is correct? (i) HTTP enables one-direction \n\ncommunication at an instance, client end to server end or server end to client end, (ii) HTTPS enables secure communication at an instance, (iii) WebSocket connection can create first by using an HTTP session, (iv) WebSockets are used for chat room \n\n\u2605 \n\n\u2605\u2605\u2605 \n\n\u2605 \n\n\u2605 \n\n\u2605\u2605\u2605 \n\nPrototyping and Designing the Software for IoT Applications 393 \n\nAPIs, (v) WebSocket communicate larger header than http, and (vi) WebSockets are real time communication only and cannot be used for pulling responses on requests. (a) (i) to (vi) (b) (i) to (iv) \n\n(c) All except (iv) and (v) (d) All except (iii) 10. Which of the following statement is correct? (i) REST methods are PUT/GET/POST/ \n\nDELETE implementation in API using REST style communication architecture, (ii) REST APIs use the URL for access to a resource, (iii) Callback(), (iv) object method() (v) C functions WebSocket methods are onWebSocketConnect(), onWebSocketMessage(), and onWebSocketClose(). (a) (i) to (iv) (b) (i), (ii), (iv) and (v) \n\n(c) (i) to (iii) (d) All except (iv) and (v) \n\nShort-Answer Questions \n\n1. What are the five levels in software development for IoT applications and services? \n\n[LO 9.1] 2. Why is it necessary to write the test functions? Why are debugger and emulators \n\nused? [LO 9.1] 3. List and write usages of library functions for sensing the ADC readings given in the \n\nautomobile embedded devices  Example 9.3. [LO 9.1] 4. What are the UART port library functions needed for communicating the IDs of \n\nRFIDs ? [LO 9.1] 5. When is UART and I2C communication used? [LO 9.1] 6. What are the IDEs for Raspberry Pi? [LO 9.1] 7. What are the security risks taken care of when: (i) using a secret key and its secure \n\ncommunication, (ii) using encryption and decryption functions, such as, AES128, AES192, AES256 or DES? [LO 9.1] 8. List the Ethernet and Wi-Fi functions for IoT systems. [LO 9.1] 9. When do you use CoAP, MQTT and HTTP client? [LO 9.2] 10. Why are the device_ID, deviceGroupID and Application_ID needed, and time \n\nstamped data-communication needed for sending data to an application or service? \n\n[LO 9.2] 11. When do you use MQTT clients and MQTT broker, and CoAP clients and servers for \n\ncommunicating the devices data? [LO 9.2] 12. What are the benefits obtained on using the Eclipse sandbox servers? [LO 9.2] 13. What are the differences in usages of Eclipse Paho and Ponte for IoT gateway message- \n\nexchanges between device clients and the application or service? [LO 9.2] 14. Why is MAC address usable for authenticating a device platform at the application/ \n\nservice APIs? [LO 9.3] 15. List the steps for message-exchanges using APIs. [LO 9.3] 16. Explain usages of HTTP client, HTTP server, HTTP secondary server, HTTPS client- \n\nserver, WebSocket Client and WebSocket server. [LO 9.3] \n\n\u2605 \n\n\u2605 \n\n\u2605\u2605 \n\n\u2605\u2605\u2605 \n\n\u2605 \n\n\u2605\u2605 \n\n\u2605 \u2605\u2605\u2605 \n\n\u2605\u2605 \n\n\u2605 \u2605\u2605 \n\n\u2605\u2605\u2605 \n\n\u2605 \u2605\u2605\u2605 \n\n\u2605 \n\n\u2605\u2605 \u2605\u2605\u2605 \n\n394 Internet of Things: Architecture and Design Principles \n\nReview Questions \n\n1. What are the features of Arduino IDE that enable the programming tasks simpler at \n\nArduino platform? [LO 9.1] 2. How are the pins programmed for digital IO and UART serial IOs at Arduino \n\nplatform? [LO 9.1] 3. What are the features of IDE for Intel Galileo devices in addition to compatibility \n\nwith Arduino? [LO9.1] 4. Describe the IDEs for Raspberry Pi and BeagleBone? [LO 9.1] 5. What are different software components of Eclipse IoT stack for developing software \n\nfor embedded devices? [LO9.2] 6. What are the different software components of Eclipse IoT stack for developing \n\nconnectivity software? Explain the uses and functions of LWM2M, CoAP and MQTT protocols with diagrams. [LO9.2] 7. What do you mean by IoT gateway services for remote applications management? \n\nWhat are the functions of Eclipse Kura? [LO9.2] 8. What are the different software frameworks of Eclipse IoT stack for developing IoT \n\nsolutions? [LO9.2] 9. Why are APIs used? Describe the ways of implementing APIs for device platform \n\nclients and a server for application/service ends. [LO 9.3] 10. When are the REST APIs used? When are WebSockets between the device platform \n\nand web APIs used? Describe differences in APIs for REST and WebSocket functions. \n\n[LO 9.3] \n\nPractice Exercises \n\n1. An embedded device platform is Arduino Uno.  Write a program to drive a moving \n\ndisplay of 24 LEDs, which are arranged in the shape of a garland. How will the four outputs at port pins be multiplexed and programmed? [LO9.1] 2. Sensor data readings are the input to an ADC. The ADC coverts the analog input of \n\nsensor to 10-bits output. The output converts to a serial input using a parallel to serial converter. The serial input is read by the Uno serial port, which receives data input at 0.8333 ms intervals. Write a program for reading of sensor data at a serial input in Arduino Uno. [LO9.1] 3. List the functions needed in a timer library. Show how will you use the library to call \n\na callback function after successive intervals of 2 s each. [LO9.1] 4. An Arduino board has SDA bits at pin A4 and SCL bits at pin A5. How will the \n\nsoftware serial library enable the serial readings from 8 temperature sensor circuits on an I2C bus? Each sensor has addresses starting from 0x10 to 0x17. [LO9.1]. 5. Write the sequences of bits and bytes when using an UART interface, when it \n\ncommunicates an ID of an RFID consisting of 10-characters. [LO 9.1] 6. List the steps for secure communication of an RFID tags ID. [LO 9.1] 7. Write a program for running four threads at successive intervals of 16.666 ms. Use the \n\nmultithreading functions  of an OS. [LO9.1] 8. Draw a diagram showing how the connected streetlights send the sensed data. \n\nThe clients at streetlights device platform are using CoAP protocol when they communicate with a CoAP server. The server sends data to applications at a central \n\n\u2605 \n\n\u2605 \n\n\u2605 \n\n\u2605\u2605 \u2605\u2605 \n\n\u2605\u2605\u2605 \n\n\u2605\u2605 \n\n\u2605\u2605 \n\n\u2605\u2605\u2605 \n\n\u2605\u2605\u2605 \n\n\u2605 \n\n\u2605\u2605 \n\n\u2605 \n\n\u2605\u2605\u2605 \n\n\u2605 \n\n\u2605\u2605 \u2605\u2605 \n\n\u2605\u2605\u2605 \n\nPrototyping and Designing the Software for IoT Applications 395 \n\ncontroller. Californium is a Java implementation of CoAP including DTLS. How can Eclipse Californium be used for IoT security using DTLS? [LO9.2] 9. Draw a diagram showing the sequence and functions for the devices data in \n\nautomobiles. The data communicates using the Internet to a central automotive service (Example 5.2). Use Eclipse IoT stack implementations. [LO 9.2] 10. Draw a functional diagram for streetlights using APIs for IoT sensors data and \n\nControl_ Application. Show the interactions between the two sets of APIs. Also show the sequences of message-exchanges. [LO 9.3] 11. How is a query sent and responded by an API at a database server? [LO9.3] 12. How is data of a group of sensors aggregated at a gateway and communicated using \n\nan HTTP client and HTTP server? The data is to be added with time stamps, groupIDs and sensorIDs. [LO9.3] \n\n\u2605 \n\n\u2605\u2605 \n\n\u2605 \u2605\u2605\u2605 \n\n",
  "createdAt": "2026-02-17"
}